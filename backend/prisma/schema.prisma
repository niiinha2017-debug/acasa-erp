generator client {
  provider = "prisma-client-js"
 }

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
 }

model usuarios {
  id            Int      @id @default(autoincrement())
  nome          String
  usuario       String   @unique
  email         String   @unique
  senha         String
  status        String
  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  recuperacoes recuperacao_senha[] // ‚úÖ lado oposto da rela√ß√£o
  permissoes   usuarios_permissoes[]

  @@map("usuarios")
 }

model recuperacao_senha {
  id           Int      @id @default(autoincrement())
  usuario_id   Int
  email        String
  senha_antiga String?
  senha_nova   String?
  token        String?
  utilizado    Boolean  @default(false)
  criado_em    DateTime @default(now())

  usuario usuarios @relation(fields: [usuario_id], references: [id], onDelete: Cascade)

  @@index([usuario_id])
  @@map("recuperacao_senha")
 }

model usuarios_permissoes {
  id Int @id @default(autoincrement())

  usuario_id   Int
  permissao_id Int

  usuario   usuarios   @relation(fields: [usuario_id], references: [id], onDelete: Cascade)
  permissao permissoes @relation(fields: [permissao_id], references: [id], onDelete: Cascade)

  @@unique([usuario_id, permissao_id])
  @@index([usuario_id])
  @@index([permissao_id])
  @@map("usuarios_permissoes")
 }

model permissoes {
  id        Int      @id @default(autoincrement())
  chave     String   @unique
  descricao String?
  criado_em DateTime @default(now())

  usuarios usuarios_permissoes[]

  @@map("permissoes")
 }

model Cliente {
  id Int @id @default(autoincrement())

  indicacao_id Int?
  indicacao    Cliente?  @relation("ClienteIndicacao", fields: [indicacao_id], references: [id])
  indicados    Cliente[] @relation("ClienteIndicacao")

  nome_completo   String
  razao_social    String?
  nome_fantasia   String?
  data_nascimento DateTime

  cpf  String?
  rg   String?
  cnpj String?
  ie   String?

  estado_civil String? // SOLTEIRO | CASADO
  nome_conjuge String?

  telefone String?
  whatsapp String?
  email    String?

  enviar_aniversario_email    Boolean @default(true)
  enviar_aniversario_whatsapp Boolean @default(false)

  cep         String?
  endereco    String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  estado      String?

  status String

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  contas_receber contas_receber[] @relation("contas_receber_cliente")

  orcamentos orcamentos[]
  vendas     vendas[]
  obras      obras[]

  @@unique([cpf])
  @@unique([cnpj])
  @@unique([email])
  @@index([indicacao_id])
  @@map("clientes")
 }

model orcamentos {
  id Int @id @default(autoincrement())

  cliente_id Int
  cliente    Cliente @relation(fields: [cliente_id], references: [id])

  cliente_nome_snapshot String
  cliente_cpf_snapshot  String
  qtd_ambientes         Int    @default(0)

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  itens    orcamento_itens[]
  arquivos orcamento_arquivos[]

  // ‚úÖ agora √© 0..1 venda por or√ßamento
  venda vendas?

  @@index([cliente_id])
  @@map("orcamentos")
 }

model orcamento_itens {
  id           Int        @id @default(autoincrement())
  orcamento_id Int
  orcamento    orcamentos @relation(fields: [orcamento_id], references: [id], onDelete: Cascade)

  nome_ambiente  String
  descricao      String
  valor_unitario Decimal @db.Decimal(10, 2)
  valor_total    Decimal @db.Decimal(10, 2)
  observacao     String

  criado_em DateTime @default(now())

  @@map("orcamento_itens")
 }

model orcamento_arquivos {
  id           Int        @id @default(autoincrement())
  orcamento_id Int
  orcamento    orcamentos @relation(fields: [orcamento_id], references: [id], onDelete: Cascade)

  nome_original String
  mime_type     String
  tamanho       Int
  caminho       String // ex: uploads/orcamentos/123/arquivo.pdf

  criado_em DateTime @default(now())

  @@map("orcamento_arquivos")
 }

model vendas {
  id Int @id @default(autoincrement())

  cliente_id Int
  cliente    Cliente @relation(fields: [cliente_id], references: [id])

  orcamento_id Int        @unique
  orcamento    orcamentos @relation(fields: [orcamento_id], references: [id], onDelete: Restrict)

  status String

  data_venda   DateTime  @default(now())

  // ‚úÖ NOVO: base real do p√≥s-venda (n√£o √© o or√ßado)
  valor_vendido Decimal @default(0.00) @db.Decimal(10, 2)

  // (mant√©m seus campos calculados)
  valor_bruto Decimal @default(0.00) @db.Decimal(10, 2)

  taxa_pagamento_percentual_aplicado Decimal? @db.Decimal(5, 2)
  valor_taxa_pagamento               Decimal  @default(0.00) @db.Decimal(10, 2)

  taxa_nota_fiscal_percentual_aplicado Decimal? @db.Decimal(5, 2)
  valor_nota_fiscal                    Decimal  @default(0.00) @db.Decimal(10, 2)

  valor_total Decimal @default(0.00) @db.Decimal(10, 2)

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  itens      vendas_itens[]
  comissoes  vendas_comissoes[]
  pagamentos vendas_pagamentos[] // ‚úÖ NOVO
  arquivos   vendas_arquivos[] // ‚úÖ NOVO

  compras compras[]

  @@index([cliente_id])
  @@index([status])
  @@map("vendas")
 }

model vendas_pagamentos {
  id Int @id @default(autoincrement())

  venda_id Int
  venda    vendas @relation(fields: [venda_id], references: [id], onDelete: Cascade)

  forma_pagamento_chave String // DINHEIRO | PIX | DEBITO | CREDITO | BOLETO | CHEQUE | TRANSFERENCIA
  valor                 Decimal @default(0.00) @db.Decimal(10, 2)

  // ‚úÖ datas para controle real
  data_prevista_recebimento DateTime? // ex: data que voc√™ vai receber (ou data entrega)
  data_recebimento          DateTime? // quando entrou de fato

  status_financeiro_chave String @default("EM_ABERTO") // STATUS_FINANCEIRO

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  @@index([venda_id])
  @@index([forma_pagamento_chave])
  @@index([status_financeiro_chave])
  @@map("vendas_pagamentos")
 }

model vendas_arquivos {
  id Int @id @default(autoincrement())

  venda_id Int
  venda    vendas @relation(fields: [venda_id], references: [id], onDelete: Cascade)

  nome_original String
  mime_type     String
  tamanho       Int
  caminho       String // uploads/vendas/123/arquivo.pdf

  criado_em DateTime @default(now())

  @@index([venda_id])
  @@map("vendas_arquivos")
 }

model vendas_itens {
  id Int @id @default(autoincrement())

  venda_id Int
  venda    vendas @relation(fields: [venda_id], references: [id], onDelete: Cascade)

  // item ‚Äúcongelado‚Äù na venda
  nome_ambiente String
  descricao     String
  observacao    String

  quantidade     Decimal @default(1.00) @db.Decimal(10, 2)
  valor_unitario Decimal @db.Decimal(10, 2)
  valor_total    Decimal @db.Decimal(10, 2)

  compras compras[] // ‚úÖ NOVO (oposto, se usar venda_item_id)

  criado_em DateTime @default(now())

  @@index([venda_id])
  @@map("vendas_itens")
 }

model vendas_comissoes {
  id Int @id @default(autoincrement())

  venda_id Int
  venda    vendas @relation(fields: [venda_id], references: [id], onDelete: Cascade)

  // chave da constante: VENDEDOR / ARQUITETO / PROJETISTA
  tipo_comissao_chave String

  // snapshot aplicado no dia (ex: 3 / 5 / 10)
  percentual_aplicado Decimal @db.Decimal(5, 2)

  // valor calculado
  valor_comissao Decimal @default(0.00) @db.Decimal(10, 2)

  // opcional: quem √© (nome, ou depois vira v√≠nculo com usuario/funcionario)
  responsavel_nome String?

  criado_em DateTime @default(now())

  @@index([venda_id])
  @@index([tipo_comissao_chave])
  @@map("vendas_comissoes")
 }

model Fornecedor {
  id              Int      @id @default(autoincrement())
  razao_social    String
  nome_fantasia   String
  cnpj            String   @unique
  ie              String?
  telefone        String?
  whatsapp        String?
  email           String?
  cep             String?
  endereco        String?
  numero          String?
  bairro          String?
  cidade          String?
  estado          String?
  forma_pagamento String?
  data_vencimento Int?
  criado_em       DateTime @default(now())
  atualizado_em   DateTime @updatedAt

  produtos         produtos[] // üëà LADO OPOSTO DA RELA√á√ÉO
  plano_corte      plano_corte[]
  plano_corte_item plano_corte_item[]

  // ===== Financeiro (Fornecedor) =====
  contas_pagar          contas_pagar[]   @relation("contas_pagar_fornecedor")
  contas_pagar_cobrador contas_pagar[]   @relation("contas_pagar_fornecedor_cobrador")
  contas_receber        contas_receber[] @relation("contas_receber_fornecedor")

  compensacoes_fornecedor fornecedor_compensacoes[]
  compras                 compras[]

  @@map("fornecedor")
 }

model produtos {
  id Int @id @default(autoincrement())

  fornecedor_id Int
  fornecedor    Fornecedor @relation(fields: [fornecedor_id], references: [id])

  nome_produto String
  marca        String? // ‚úÖ NOVO
  cor          String?
  medida       String?
  unidade      String?

  quantidade     Int?     @default(0)
  valor_unitario Decimal? @db.Decimal(10, 2)
  valor_total    Decimal? @db.Decimal(10, 2)

  status String @default("ATIVO")

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  plano_corte_consumo plano_corte_consumo[]
  compras_itens       compras_itens[]

  @@index([fornecedor_id])
  @@map("produtos")
 }

model plano_corte {
  id            Int      @id @default(autoincrement())
  fornecedor_id Int
  data_venda    DateTime

  valor_total Decimal @db.Decimal(10, 2)
  status      String

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  fornecedor Fornecedor @relation(fields: [fornecedor_id], references: [id])

  produtos plano_corte_produto[]
  consumos plano_corte_consumo[]

  @@map("plano_corte")
 }

model plano_corte_item {
  id            Int @id @default(autoincrement())
  fornecedor_id Int

  nome_produto String
  marca        String? // ‚úÖ NOVO
  cor          String?
  medida       String?
  unidade      String?

  quantidade     Int
  valor_unitario Decimal @db.Decimal(10, 2)
  valor_total    Decimal @db.Decimal(10, 2)

  status String

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  ultimo_valor_vendido Decimal   @default(0.00) @db.Decimal(10, 2)
  ultimo_vendido_em    DateTime?

  fornecedor Fornecedor @relation(fields: [fornecedor_id], references: [id])

  produtos plano_corte_produto[]

  @@index([fornecedor_id])
  @@map("plano_corte_item")
 }

model plano_corte_produto {
  id             Int @id @default(autoincrement())
  plano_corte_id Int
  item_id        Int

  quantidade     Decimal @db.Decimal(10, 2)
  valor_unitario Decimal @db.Decimal(10, 2)
  valor_total    Decimal @db.Decimal(10, 2)
  status         String

  plano_corte plano_corte      @relation(fields: [plano_corte_id], references: [id])
  item        plano_corte_item @relation(fields: [item_id], references: [id])

  @@unique([plano_corte_id, item_id]) // ‚úÖ n√£o duplica item no mesmo plano
  @@map("plano_corte_produto")
 }

model plano_corte_consumo {
  id             Int @id @default(autoincrement())
  plano_corte_id Int
  produto_id     Int

  quantidade Decimal @db.Decimal(10, 2)

  criado_em DateTime @default(now())

  plano_corte plano_corte @relation(fields: [plano_corte_id], references: [id])
  produto     produtos    @relation(fields: [produto_id], references: [id])

  @@unique([plano_corte_id, produto_id]) // ‚úÖ n√£o duplica consumo no mesmo plano
  @@map("plano_corte_consumo")
 }

model funcionarios {
  id Int @id @default(autoincrement())

  // ======================
  // DADOS PESSOAIS
  // ======================
  nome            String
  cpf             String    @unique
  rg              String?
  data_nascimento DateTime?
  telefone        String?
  whatsapp        String?
  email           String?
  estado_civil    String?
  escolaridade    String?

  // ======================
  // DADOS DA EMPRESA
  // ======================
  unidade String? // F√ÅBRICA | LOJA
  setor   String?
  cargo   String?
  funcao  String?

  // ======================
  // ENDERE√áO
  // ======================
  cep         String?
  endereco    String?
  numero      String?
  complemento String? // <--- ADICIONADO AQUI
  bairro      String?
  cidade      String?
  estado      String?

  // ======================
  // REGISTRO / V√çNCULO (Essencial para c√°lculo de F√©rias)
  // ======================
  registro String?
  admissao DateTime?
  demissao DateTime?

  // ======================
  // FINANCEIRO
  // ======================
  salario_base      Decimal? @db.Decimal(12, 2)
  salario_adicional Decimal? @db.Decimal(12, 2)
  custo_hora        Decimal? @db.Decimal(12, 2)

  tem_vale Boolean  @default(false)
  vale     Decimal? @db.Decimal(12, 2)

  tem_vale_transporte Boolean  @default(false)
  vale_transporte     Decimal? @db.Decimal(12, 2)

  // ======================
  // HOR√ÅRIOS (Armazenados como String: "08:00")
  // ======================
  horario_entrada_1 String?
  horario_saida_1   String?
  horario_entrada_2 String?
  horario_saida_2   String?

  // SABADO
  horario_sabado_entrada_1 String?
  horario_sabado_saida_1   String?

  // ======================
  // CARGA HOR√ÅRIA
  // ======================
  carga_horaria_dia    Decimal? @db.Decimal(5, 2)
  carga_horaria_semana Decimal? @db.Decimal(5, 2)

  // ======================
  // PAGAMENTO
  // ======================
  forma_pagamento String?
  dia_pagamento   Int?
  banco           String?
  agencia         String?
  conta           String?
  pix_tipo_chave  String?
  pix_chave       String?
  status          String  @default("ATIVO") @db.VarChar(20)

  // ======================
  // PRODU√á√ÉO / DESPESAS
  // ======================
  despesas         despesas[]
  producao_tarefas producao_tarefas[]

  // ======================
  // CONTROLE
  // ======================
  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  ponto_dispositivos    ponto_dispositivos[]
  ponto_registros       ponto_registros[]
  ponto_convites        ponto_convites[]
  ponto_justificativas  ponto_justificativas[]
  funcionarios_arquivos funcionarios_arquivos[]

  @@map("funcionarios")
 }

model funcionarios_arquivos {
  id             Int      @id @default(autoincrement())
  funcionario_id Int
  nome           String
  arquivo_nome   String // nome salvo no disco (uuid.ext)
  mime           String?
  tamanho        Int?
  url            String // url p√∫blica: /uploads/funcionarios/<arquivo_nome>
  criado_em      DateTime @default(now())

  funcionario funcionarios @relation(fields: [funcionario_id], references: [id], onDelete: Cascade)

  @@index([funcionario_id])
  @@map("funcionarios_arquivos")
 }

model despesas {
  id Int @id @default(autoincrement())

  tipo_movimento      String
  unidade             String
  categoria           String
  classificacao       String
  local               String
  valor_total         Decimal @db.Decimal(10, 2)
  forma_pagamento     String
  quantidade_parcelas Int

  data_registro   DateTime  @default(now())
  data_vencimento DateTime
  data_pagamento  DateTime?

  funcionario_id Int?
  funcionario    funcionarios? @relation(fields: [funcionario_id], references: [id])

  status String @default("EM_ABERTO")
  conta_pagar contas_pagar?

  recorrencia_id String? @db.VarChar(36)
  parcela_numero Int?

  // ‚úÖ PIX / Transfer√™ncia (constantes)
  conta_bancaria_key      String? @db.VarChar(50)
  conta_bancaria_tipo_key String? @db.VarChar(50)

  // ‚úÖ Cart√£o (constantes)
  cartao_credito_key      String? @db.VarChar(50)

  @@index([unidade])
  @@index([recorrencia_id])
  @@index([tipo_movimento])
  @@index([categoria])
  @@index([classificacao])
  @@index([local])
  @@index([status])
  @@index([data_vencimento])
  @@index([funcionario_id])

  @@index([conta_bancaria_key])
  @@index([conta_bancaria_tipo_key])
  @@index([cartao_credito_key])

  @@map("despesas")
}

model producao_projetos {
  id Int @id @default(autoincrement())

  origem_tipo String
  origem_id   Int

  status String @default("ABERTO")

  encaminhado_em DateTime? // <<< novo (data que foi enviado pra produ√ß√£o)

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  tarefas  producao_tarefas[]
  arquivos producao_arquivos[]

  @@unique([origem_tipo, origem_id])
  @@index([origem_tipo])
  @@index([origem_id])
  @@index([status])
  @@index([encaminhado_em])
  @@map("producao_projetos")
 }

model producao_tarefas {
  id Int @id @default(autoincrement())

  projeto_id Int
  projeto    producao_projetos @relation(fields: [projeto_id], references: [id], onDelete: Cascade)

  funcionario_id Int
  funcionario    funcionarios @relation(fields: [funcionario_id], references: [id])

  titulo     String
  status     String  @default("PENDENTE")
  observacao String?

  inicio_em DateTime
  fim_em    DateTime

  // CPV (snapshot)
  custo_hora_aplicado Decimal @default(0.00) @db.Decimal(12, 2)
  custo_total         Decimal @default(0.00) @db.Decimal(12, 2)

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  @@index([projeto_id])
  @@index([funcionario_id])
  @@index([status])
  @@index([inicio_em])
  @@index([fim_em])
  @@map("producao_tarefas")
 }

model producao_arquivos {
  id Int @id @default(autoincrement())

  projeto_id Int
  projeto    producao_projetos @relation(fields: [projeto_id], references: [id], onDelete: Cascade)

  tipo          String // PLANTA | PROJETO_TECNICO | PLANO_CORTE | OUTRO
  nome_original String
  nome_arquivo  String
  mime_type     String?
  tamanho_bytes Int?

  criado_em DateTime @default(now())

  @@index([projeto_id])
  @@index([tipo])
  @@map("producao_arquivos")
 }

model contas_pagar {
  id Int @id @default(autoincrement())

  // Fornecedor "centro" (ex: Cityfer)
  fornecedor_id Int
  fornecedor    Fornecedor @relation("contas_pagar_fornecedor", fields: [fornecedor_id], references: [id])

  // Fornecedor "cobrador" (ex: Rimad) - opcional
  fornecedor_cobrador_id Int?
  fornecedor_cobrador    Fornecedor? @relation("contas_pagar_fornecedor_cobrador", fields: [fornecedor_cobrador_id], references: [id])

  // Origem (opcional) para rastrear de onde veio (compra, etc.)
  origem_tipo String?
  origem_id   Int?

  mes_referencia Int
  ano_referencia Int

  descricao  String?
  observacao String?

  // valores
  valor_original   Decimal @default(0.00) @db.Decimal(12, 2)
  valor_compensado Decimal @default(0.00) @db.Decimal(12, 2)

  // status e forma de pagamento (vem das CONSTANTES)
  status                String
  forma_pagamento_chave String?

  // parcelamento (cart√£o/cheque em 6 meses)
  parcelas_total Int?
  parcela_numero Int?

  vencimento_em DateTime
  pago_em       DateTime?

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  cheques    cheques[]
  despesa_id Int?      @unique
  despesa    despesas? @relation(fields: [despesa_id], references: [id])

  compensacoes fornecedor_compensacoes[] @relation("compensacoes_pagar")

  @@index([fornecedor_id])
  @@index([fornecedor_cobrador_id])
  @@index([status])
  @@index([vencimento_em])
  @@index([origem_tipo])
  @@index([origem_id])
  @@map("contas_pagar")
 }

model contas_receber {
  id Int @id @default(autoincrement())

  // ‚úÖ AGORA pode ser fornecedor OU cliente (um dos dois)
  fornecedor_id Int?
  fornecedor    Fornecedor? @relation("contas_receber_fornecedor", fields: [fornecedor_id], references: [id])

  cliente_id Int?
  cliente    Cliente? @relation("contas_receber_cliente", fields: [cliente_id], references: [id])

  // Origem (ex: VENDA)
  origem_tipo String?
  origem_id   Int?

  descricao  String?
  observacao String?

  valor_original   Decimal @default(0.00) @db.Decimal(12, 2)
  valor_compensado Decimal @default(0.00) @db.Decimal(12, 2)

  status                  String
  forma_recebimento_chave String?

  vencimento_em DateTime?
  recebido_em   DateTime?

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  compensacoes fornecedor_compensacoes[] @relation("compensacoes_receber")

  @@index([fornecedor_id])
  @@index([cliente_id])
  @@index([status])
  @@index([vencimento_em])
  @@index([origem_tipo])
  @@index([origem_id])
  @@map("contas_receber")
 }

model fornecedor_compensacoes {
  id Int @id @default(autoincrement())

  fornecedor_id Int
  fornecedor    Fornecedor @relation(fields: [fornecedor_id], references: [id])

  conta_pagar_id Int
  conta_pagar    contas_pagar @relation("compensacoes_pagar", fields: [conta_pagar_id], references: [id], onDelete: Cascade)

  conta_receber_id Int
  conta_receber    contas_receber @relation("compensacoes_receber", fields: [conta_receber_id], references: [id], onDelete: Cascade)

  valor            Decimal  @default(0.00) @db.Decimal(12, 2)
  data_compensacao DateTime @default(now())
  observacao       String?

  @@index([fornecedor_id])
  @@index([conta_pagar_id])
  @@index([conta_receber_id])
  @@map("fornecedor_compensacoes")
 }

model compras {
  id Int @id @default(autoincrement())

  tipo_compra String

  venda_id Int?
  venda    vendas? @relation(fields: [venda_id], references: [id], onDelete: Cascade)

  fornecedor_id Int
  fornecedor    Fornecedor @relation(fields: [fornecedor_id], references: [id])

  venda_item_id Int?
  venda_item    vendas_itens? @relation(fields: [venda_item_id], references: [id], onDelete: SetNull)

  // ‚úÖ agora √© status financeiro (EM_ABERTO / VENCIDO / PAGO...)
  status String @default("EM_ABERTO")

  data_compra DateTime @default(now())

  // ‚úÖ vencimento para virar VENCIDO automaticamente
  vencimento_em DateTime?

  valor_total Decimal @default(0.00) @db.Decimal(10, 2)

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  itens   compras_itens[]
  rateios compras_rateio[]

  @@index([tipo_compra])
  @@index([venda_id])
  @@index([fornecedor_id])
  @@index([status])
  @@index([vencimento_em])
  @@map("compras")
 }

model compras_itens {
  id        Int     @id @default(autoincrement())
  compra_id Int
  compra    compras @relation(fields: [compra_id], references: [id], onDelete: Cascade)

  produto_id Int?
  produto    produtos? @relation(fields: [produto_id], references: [id], onDelete: SetNull)

  // ‚úÖ CAMPOS REPLICADOS PARA HIST√ìRICO E RELAT√ìRIO DETALHADO
  nome_produto String
  marca        String?
  cor          String?
  medida       String?
  unidade      String

  quantidade     Decimal @default(1.00) @db.Decimal(10, 2)
  valor_unitario Decimal @default(0.00) @db.Decimal(10, 2)
  valor_total    Decimal @default(0.00) @db.Decimal(10, 2)

  criado_em DateTime @default(now())

  @@index([compra_id])
  @@index([produto_id])
  @@map("compras_itens")
 }

model compras_rateio {
  id Int @id @default(autoincrement())

  compra_id Int
  compra    compras @relation(fields: [compra_id], references: [id], onDelete: Cascade)

  // ambiente por snapshot (texto igual ao vendas_itens.nome_ambiente)
  nome_ambiente String

  // quanto desse total foi alocado nesse ambiente
  valor_alocado Decimal @default(0.00) @db.Decimal(10, 2)

  criado_em DateTime @default(now())

  @@unique([compra_id, nome_ambiente]) // ‚úÖ impede duplicar o mesmo ambiente na mesma compra
  @@index([compra_id])
  @@index([nome_ambiente])
  @@map("compras_rateio")
 }

model cheques {
  id              Int      @id @default(autoincrement())
  numero          String   @unique
  banco           String
  valor           Decimal  @db.Decimal(12, 2)
  data_emissao    DateTime @default(now())
  data_vencimento DateTime // O "Bom para"
  status          String   @default("EM_MAO") // EM_MAO, COMPENSADO, DEVOLVIDO, REPASSADO

  // Se for cheque de cliente, guardamos o nome aqui
  emitente_nome String?

  // V√≠nculo com a parcela que ele est√° pagando
  conta_pagar_id Int?
  conta_pagar    contas_pagar? @relation(fields: [conta_pagar_id], references: [id])

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  @@map("cheques")
 }

model Empresa {
  id            Int      @id @default(1) // For√ßamos o ID 1
  razao_social  String?
  nome_fantasia String?
  cnpj          String?  @unique
  ie            String?
  logradouro    String?
  numero        String?
  bairro        String?
  cidade        String?
  uf            String?  @db.VarChar(2)
  cep           String?
  email         String?
  telefone      String?
  logo_url      String?  @db.Text // Para salvar o caminho da imagem ou base64
  updated_at    DateTime @updatedAt

  @@map("empresa") // Nome da tabela no banco de dados
 }

model obras {
  id Int @id @default(autoincrement())

  cliente_id Int
  cliente    Cliente @relation(fields: [cliente_id], references: [id], onDelete: Cascade)

  status_processo String

  data_medida      DateTime?
  data_orcamento   DateTime?
  data_medida_fina DateTime?
  data_producao    DateTime?
  data_montagem    DateTime?

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  @@index([cliente_id])
  @@map("obras")
 }

enum PontoTipoRegistro {
  ENTRADA
  SAIDA
 }

enum PontoOrigem {
  PWA
  WEB
  ADMIN
 }

model ponto_dispositivos {
  id Int @id @default(autoincrement())

  funcionario_id Int
  funcionario    funcionarios @relation(fields: [funcionario_id], references: [id], onDelete: Cascade)

  device_uuid String  @unique @db.VarChar(80)
  device_nome String? @db.VarChar(120)
  plataforma  String? @db.VarChar(20)

  // ‚úÖ NOVOS (registro do dispositivo)
  user_agent  String?  @db.VarChar(255)
  language    String?  @db.VarChar(20)
  timezone    String?  @db.VarChar(80)
  screen      String?  @db.VarChar(20)
  pixel_ratio Float?
  standalone  Boolean? @default(false)

  token_hash String @unique @db.VarChar(255)

  status        String    @default("ATIVO") @db.VarChar(20)
  ultimo_uso_em DateTime?

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  ponto_registros ponto_registros[]

  @@index([funcionario_id])
  @@index([status])
  @@map("ponto_dispositivos")
 }

model ponto_registros {
  id Int @id @default(autoincrement())

  funcionario_id Int
  funcionario    funcionarios @relation(fields: [funcionario_id], references: [id], onDelete: Cascade)

  dispositivo_id Int?
  dispositivo    ponto_dispositivos? @relation(fields: [dispositivo_id], references: [id], onDelete: SetNull)

  tipo   PontoTipoRegistro
  origem PontoOrigem       @default(PWA)

  data_hora DateTime @default(now())

  latitude        Decimal? @db.Decimal(10, 7)
  longitude       Decimal? @db.Decimal(10, 7)
  precisao_metros Int?

  // ‚úÖ endere√ßo resolvido no BACKEND
  cep    String? @db.VarChar(10)
  rua    String? @db.VarChar(150)
  bairro String? @db.VarChar(120)
  cidade String? @db.VarChar(120)
  estado String? @db.VarChar(2) // UF

  ip         String? @db.VarChar(45)
  user_agent String? @db.VarChar(255)

  status     String  @default("ATIVO") @db.VarChar(20)
  observacao String? @db.VarChar(255)

  criado_em DateTime @default(now())

  @@index([funcionario_id, data_hora])
  @@index([data_hora])
  @@index([tipo])
  @@index([dispositivo_id])
  @@map("ponto_registros")
 }

model ponto_convites {
  id Int @id @default(autoincrement())

  funcionario_id Int
  funcionario    funcionarios @relation(fields: [funcionario_id], references: [id], onDelete: Cascade)

  code      String    @unique
  expira_em DateTime
  usado_em  DateTime?

  criado_em DateTime @default(now())

  @@index([funcionario_id])
  @@map("ponto_convites")
 }

model ponto_justificativas {
  id Int @id @default(autoincrement())

  funcionario_id Int
  funcionario    funcionarios @relation(fields: [funcionario_id], references: [id], onDelete: Cascade)

  // dia da justificativa (sempre 00:00:00)
  data DateTime

  // chave da constante (ex: ATESTADO, FALTA_JUSTIFICADA...)
  tipo String @db.VarChar(40)

  descricao String? @db.VarChar(255)

  criado_em     DateTime @default(now())
  atualizado_em DateTime @updatedAt

  arquivos ponto_justificativas_arquivos[]

  @@unique([funcionario_id, data])
  @@index([funcionario_id])
  @@index([data])
  @@index([tipo])
  @@map("ponto_justificativas")
 }

model ponto_justificativas_arquivos {
  id Int @id @default(autoincrement())

  justificativa_id Int
  justificativa    ponto_justificativas @relation(fields: [justificativa_id], references: [id], onDelete: Cascade)

  arquivo_nome String  @db.VarChar(180)
  mime_type    String? @db.VarChar(80)
  tamanho      Int?

  arquivo_path String @db.VarChar(255)

  criado_em DateTime @default(now())

  @@index([justificativa_id])
  @@map("ponto_justificativas_arquivos")
 }
