import{_ as H,y as J,f as u,g as A,i as K,s as p,r as Q,c as n,o as l,b as t,k as W,e as X,A as U,d as C,t as m,T as Y,w as Z,v as ee,F as b,n as S,p as v,E as se,u as te,l as N,$ as ae,a0 as h,q as B}from"./index-CH22lQIC.js";import{u as re}from"./useauth-BQLIh4i2.js";const oe={class:"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in"},le={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 p-2"},ie={key:0,class:"flex items-center gap-2 bg-brand-primary/5 px-3 py-1.5 rounded-lg border border-brand-primary/10"},ne={class:"text-[10px] font-black uppercase text-brand-primary tracking-widest"},ce={class:"bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden min-h-[650px] flex flex-col lg:flex-row"},de={class:"w-full lg:w-80 border-b lg:border-b-0 lg:border-r border-slate-100 flex flex-col bg-slate-50/30"},ue={class:"p-4 border-b border-slate-100 bg-white"},pe={class:"relative group"},fe={class:"flex-1 overflow-y-auto p-3 space-y-1 custom-scroll"},me=["onClick"],ve={class:"flex flex-col"},xe={class:"flex items-center gap-2 mt-1"},ge={class:"text-[9px] font-bold uppercase text-slate-400 tracking-tighter"},be={class:"flex-1 flex flex-col bg-white"},he={key:0,class:"flex-1 flex flex-col items-center justify-center p-12 text-center"},ye={class:"p-6 border-b border-slate-100 flex items-center justify-between bg-white sticky top-0 z-10"},_e={class:"flex-1 overflow-y-auto p-8 space-y-12 custom-scroll bg-white"},we={class:"flex items-center justify-between border-b border-slate-50 pb-2"},ke={class:"text-[11px] font-black uppercase tracking-[0.15em] text-slate-400 flex items-center gap-2"},Ae={class:"flex gap-3"},Ce=["onClick"],Se=["onClick"],Pe={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3"},Ee={class:"relative flex items-center justify-center h-4 w-4 mr-3"},Me=["checked","onChange"],je={key:0,class:"pi pi-check text-[8px] text-white font-black"},De={class:"flex flex-col min-w-0"},Ue={class:"text-[8px] font-bold text-slate-300 uppercase tracking-tighter"},Ne={__name:"permissoes",setup(Be){const T=J(),{temAcesso:x,usuarioLogado:L}=re(),y=u([]),_=u(""),c=u(null),d=u([]),w=u(!1),P=u(!1),E=u(!1),k=u([]),O=A(()=>{const s={};for(const e of k.value)e!=null&&e.chave&&(s[e.chave]=e.id);return s}),M=A(()=>{const s={};for(const e of k.value){const r=String((e==null?void 0:e.chave)||"");if(!r)continue;const a=r.includes(".")?r.split(".")[0]:"geral";s[a]||(s[a]=[]),s[a].push({id:e.id,chave:e.chave,nome:e.descricao||e.chave})}for(const e of Object.keys(s))s[e].sort((r,a)=>String(r.chave).localeCompare(String(a.chave)));return s}),R=A(()=>{const s=String(_.value||"").toLowerCase().trim();return s?y.value.filter(e=>String((e==null?void 0:e.nome)||"").toLowerCase().includes(s)||String((e==null?void 0:e.usuario)||"").toLowerCase().includes(s)):y.value}),V=async()=>{try{const{data:s}=await h.listar();k.value=Array.isArray(s)?s:[]}catch{p.error("Catálogo de permissões indisponível")}},$=async()=>{P.value=!0;try{const{data:s}=await ae.listar();y.value=Array.isArray(s)?s:[]}finally{P.value=!1}},j=s=>Array.isArray(s)?s.length>0&&typeof s[0]=="object"?s.map(e=>{var r;return e.chave||((r=e.permission)==null?void 0:r.chave)}).filter(Boolean):s:[],I=async s=>{c.value=s,E.value=!0;try{const{data:e}=await h.listarDoUsuario(s.id);d.value=j(e)}catch{p.error("Erro ao carregar permissões do usuário")}finally{E.value=!1}},g=s=>d.value.includes(s),z=s=>{const e=d.value.indexOf(s);e>=0?d.value.splice(e,1):d.value.push(s)},F=(s,e)=>{var o;const a=(((o=M.value)==null?void 0:o[s])||[]).map(f=>f.chave),i=new Set(d.value);a.forEach(f=>e?i.add(f):i.delete(f)),d.value=Array.from(i)};async function q(){var e;if(!x("permissoes.gerenciar"))return p.error("Acesso negado.");if(!((e=c.value)!=null&&e.id))return;await B.show("Salvar",`Deseja salvar as permissões de ${c.value.nome}?`)&&await G()}async function D(s,e){if(!x("permissoes.gerenciar"))return p.error("Acesso negado.");await B.show(e?"Marcar":"Limpar",`Deseja alterar o módulo ${s}?`)&&F(s,e)}const G=async()=>{if(!x("permissoes.gerenciar"))return p.error("Acesso negado.");w.value=!0;try{const s=d.value.map(r=>Number(O.value[r])).filter(r=>Number.isFinite(r));console.log("[PERMS] chaves:",d.value),console.log("[PERMS] ids:",s),await h.definirParaUsuario(c.value.id,s);const{data:e}=await h.listarDoUsuario(c.value.id);d.value=j(e),p.success("Permissões atualizadas!")}catch(s){console.error(s),p.error("Erro ao salvar")}finally{w.value=!1}};return K(async()=>{const s=L.value;if(!(Array.isArray(s==null?void 0:s.permissoes)?s.permissoes:Array.isArray(s==null?void 0:s.permissões)?s.permissões:[]).includes("ADMIN")&&!x("permissoes.ver")){p.error("Acesso negado."),T.push("/");return}await Promise.all([$(),V()])}),(s,e)=>{const r=Q("Button");return l(),n("div",oe,[t("div",le,[e[2]||(e[2]=W('<div class="flex items-center gap-3" data-v-67adcfd6><div class="w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center" data-v-67adcfd6><i class="pi pi-lock text-lg" data-v-67adcfd6></i></div><div data-v-67adcfd6><h1 class="text-lg font-black text-slate-800 uppercase tracking-tight" data-v-67adcfd6>Permissões de Acesso</h1><p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider" data-v-67adcfd6>Controle de níveis e segurança por usuário</p></div></div>',1)),X(Y,{name:"fade"},{default:U(()=>[c.value?(l(),n("div",ie,[e[1]||(e[1]=t("span",{class:"w-1.5 h-1.5 rounded-full bg-brand-primary animate-pulse"},null,-1)),t("span",ne," Editando: "+m(c.value.nome),1)])):C("",!0)]),_:1})]),t("div",ce,[t("aside",de,[t("div",ue,[t("div",pe,[e[3]||(e[3]=t("i",{class:"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-[10px]"},null,-1)),Z(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),type:"text",placeholder:"BUSCAR COLABORADOR...",class:"w-full pl-9 pr-3 h-10 bg-slate-50 border border-slate-200 rounded-xl text-[10px] font-bold uppercase focus:bg-white focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all"},null,512),[[ee,_.value]])])]),t("div",fe,[(l(!0),n(b,null,S(R.value,a=>{var i,o;return l(),n("button",{key:a.id,onClick:f=>I(a),class:v(["w-full p-3 rounded-xl transition-all text-left group border",((i=c.value)==null?void 0:i.id)===a.id?"bg-white border-brand-primary/20 shadow-sm ring-1 ring-brand-primary/10":"bg-transparent border-transparent hover:bg-white hover:border-slate-200"])},[t("div",ve,[t("span",{class:v(["text-[11px] font-black uppercase tracking-tight",((o=c.value)==null?void 0:o.id)===a.id?"text-brand-primary":"text-slate-700"])},m(a.nome),3),t("div",xe,[t("span",ge,m(a.setor||"Geral"),1),t("span",{class:v(["w-1 h-1 rounded-full",String(a.status||"").toUpperCase()==="ATIVO"?"bg-emerald-400":String(a.status||"").toUpperCase()==="PENDENTE"?"bg-amber-400":"bg-rose-400"])},null,2)])])],10,me)}),128))])]),t("main",be,[c.value?(l(),n(b,{key:1},[t("div",ye,[e[6]||(e[6]=t("div",{class:"flex items-center gap-3"},[t("div",{class:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-500"},[t("i",{class:"pi pi-shield text-xs"})]),t("h3",{class:"text-xs font-black text-slate-800 uppercase tracking-widest"},"Mapa de Acessos")],-1)),te(x)("permissoes.gerenciar")?(l(),se(r,{key:0,variant:"primary",loading:w.value,onClick:q,class:"!h-10 !px-6 !rounded-xl font-black text-[10px] uppercase tracking-widest shadow-sm"},{default:U(()=>[...e[5]||(e[5]=[N(" Salvar Alterações ",-1)])]),_:1},8,["loading"])):C("",!0)]),t("div",_e,[(l(!0),n(b,null,S(M.value,(a,i)=>(l(),n("div",{key:i,class:"space-y-4"},[t("div",we,[t("h4",ke,[e[7]||(e[7]=t("span",{class:"w-1 h-3 bg-brand-primary rounded-full"},null,-1)),N(" "+m(i),1)]),t("div",Ae,[t("button",{onClick:o=>D(i,!0),class:"text-[9px] font-black uppercase text-brand-primary/60 hover:text-brand-primary transition-colors"},"Marcar Todos",8,Ce),t("button",{onClick:o=>D(i,!1),class:"text-[9px] font-black uppercase text-slate-300 hover:text-rose-500 transition-colors"},"Limpar",8,Se)])]),t("div",Pe,[(l(!0),n(b,null,S(a,o=>(l(),n("label",{key:o.chave,class:v(["flex items-center p-3 rounded-xl border transition-all cursor-pointer group select-none",g(o.chave)?"bg-brand-primary/5 border-brand-primary/10 shadow-sm shadow-brand-primary/5":"bg-white border-slate-100 hover:border-slate-200"])},[t("div",Ee,[t("input",{type:"checkbox",class:"peer opacity-0 absolute inset-0 cursor-pointer z-10",checked:g(o.chave),onChange:f=>z(o.chave)},null,40,Me),t("div",{class:v(["h-4 w-4 rounded-md border flex items-center justify-center transition-all",g(o.chave)?"bg-brand-primary border-brand-primary":"bg-slate-50 border-slate-200"])},[g(o.chave)?(l(),n("i",je)):C("",!0)],2)]),t("div",De,[t("span",{class:v(["text-[10px] font-black uppercase tracking-tight truncate transition-colors",g(o.chave)?"text-brand-primary":"text-slate-600"])},m(o.nome),3),t("span",Ue,"ID: "+m(o.chave),1)])],2))),128))])]))),128))])],64)):(l(),n("div",he,[...e[4]||(e[4]=[t("div",{class:"w-16 h-16 rounded-2xl bg-slate-50 flex items-center justify-center mb-4 border border-slate-100 text-slate-300"},[t("i",{class:"pi pi-user-plus text-xl"})],-1),t("h4",{class:"text-[11px] font-black text-slate-800 uppercase tracking-widest"},"Aguardando Seleção",-1),t("p",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-tight mt-1"},"Escolha um colaborador para gerenciar os acessos.",-1)])]))])])])}}},Oe=H(Ne,[["__scopeId","data-v-67adcfd6"]]);export{Oe as default};
//# sourceMappingURL=permissoes-C1p9qy8J.js.map
