import{f as S,h as N,g as O,i as tt,a2 as et,c as u,d as R,b as e,t as g,p as C,w as v,a4 as $,F as j,n as M,v as y,s as m,ag as F,y as at,ah as P,ai as st,o as p,q as ot}from"./index-CH22lQIC.js";import{c as lt}from"./utils-haS6CNYB.js";function it(h){return h.toISOString().slice(0,10)}function V(h){const[f,x,b]=h.split("-").map(Number);return new Date(Date.UTC(f,x-1,b))}function nt(h,f){const x=V(h),b=V(f),k=[];for(let w=new Date(x);w<=b;w.setUTCDate(w.getUTCDate()+1))k.push(it(w));return k}function rt(h=[]){const f=new Map;for(const x of h){const b=new Date(x.data_hora).toISOString().slice(0,10);f.has(b)||f.set(b,[]),f.get(b).push(x)}return f}const dt={class:"w-full max-w-[1400px] mx-auto space-y-6 animate-in fade-in duration-500"},ct={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ut={class:"bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-4"},pt={class:"text-2xl font-black text-slate-800 tracking-tighter"},ft={class:"bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-4"},xt={class:"text-2xl font-black text-slate-800 tracking-tighter"},bt={class:"bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center gap-4"},gt={class:"bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-100 overflow-hidden"},mt={class:"p-6 bg-slate-50/50 border-b border-slate-100 grid grid-cols-12 gap-4 items-end"},vt={class:"col-span-12 md:col-span-4"},ht=["value"],_t={class:"col-span-5 md:col-span-3"},yt={class:"col-span-5 md:col-span-3"},wt={class:"col-span-12 md:col-span-2 grid grid-cols-2 gap-2"},kt=["disabled"],Dt={key:0,class:"pi pi-search"},St={key:1,class:"pi pi-spin pi-spinner"},Ot=["disabled"],At={key:0,class:"pi pi-file-pdf"},Tt={key:1,class:"pi pi-spin pi-spinner"},Et={class:"overflow-x-auto p-2"},Nt={class:"w-full border-separate border-spacing-y-2"},Rt={class:"px-6 py-4 rounded-l-3xl border-y border-l border-slate-50"},Ct={class:"flex flex-col"},jt={class:"text-sm font-black text-slate-800 uppercase italic leading-none"},Mt={class:"text-[9px] font-bold text-slate-400 uppercase mt-1 italic"},Pt={class:"flex items-center justify-center gap-2 group/btn"},It={key:0,class:"flex items-center opacity-0 group-hover/btn:opacity-100 transition-opacity"},Ut=["onClick"],$t=["onClick"],Ft=["onClick"],Vt={class:"px-6 py-4 rounded-r-3xl border-y border-r border-slate-50 text-right"},Ht=["onClick"],Jt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md"},zt={class:"bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl overflow-hidden animate-in zoom-in-95"},Bt={class:"p-8 border-b flex justify-between items-center bg-slate-50/50"},Lt={class:"font-black text-slate-800 uppercase italic"},qt={class:"p-8 space-y-4"},Qt={class:"space-y-1"},Wt={class:"space-y-1"},Gt={class:"space-y-1"},Yt={class:"p-6 bg-slate-50 flex gap-3"},Kt=["disabled"],Xt={key:2,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md"},Zt={class:"bg-white w-full max-w-2xl rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col max-h-[90vh]"},te={class:"p-8 border-b flex justify-between items-center bg-slate-50/50"},ee={class:"text-[10px] font-bold text-slate-400 uppercase mt-2 tracking-widest italic"},ae={class:"p-8 space-y-6 overflow-y-auto"},se={class:"grid grid-cols-2 gap-4"},oe={class:"space-y-1"},le={class:"space-y-1"},ie={class:"space-y-1"},ne={class:"p-6 bg-slate-50 border-t flex gap-3"},re=["disabled"],ue={__name:"index",setup(h){const f=S(!1),x=S([]),b=S([]),k=S([]),w=at(),A=S(!1);async function H(){var l,s,d,_;if(!n.funcionario_id)return m.warn("Selecione um funcionário");const{mes:o,ano:t}=B(),a=Number(String(n.funcionario_id).replace(/\D/g,""));try{A.value=!0;const{data:i}=await F.pdfMensalSalvar({funcionario_id:a,mes:o,ano:t});w.push(`/arquivos/${i.arquivoId}?name=RELATORIO_PONTO_${String(o).padStart(2,"0")}_${t}&type=application/pdf`)}catch(i){console.log("[PONTO] ERRO PDF:",(l=i==null?void 0:i.response)==null?void 0:l.status,(s=i==null?void 0:i.response)==null?void 0:s.data),m.error(((_=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:_.message)||"Erro ao gerar PDF")}finally{A.value=!1}}const n=N({funcionario_id:"",data_ini:"",data_fim:""}),I=O(()=>(x.value||[]).filter(o=>new Date(o.data_hora).getDay()!==0)),J=O(()=>rt(I.value)),D=O(()=>lt({registros:I.value})),r=N({open:!1,saving:!1,id:null,form:{funcionario_id:null,data_hora_local:"",tipo:"ENTRADA",observacao:""}}),c=N({open:!1,saving:!1,dia:"",lista:[],form:{funcionario_id:null,data:"",tipo:"",descricao:""}}),U=o=>o?o.split("-").reverse().join("/"):"-",z=o=>{const t=["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"],a=new Date(o+"T12:00:00");return t[a.getDay()]};function B(){const o=n.data_ini||new Date().toISOString().slice(0,10),[t,a]=String(o).split("-").map(l=>Number(l));return{mes:a,ano:t}}const L=(o,t)=>{if(!t)return!1;const a=new Date(o+"T12:00:00"),[l,s]=t.split(":").map(Number);return a.getDay()===6&&(l>12||l===12&&s>0)},q=O(()=>{const o=Number(n.funcionario_id||0);return k.value.find(t=>Number(t.id)===o)||null}),Q=O(()=>{if(!n.data_ini||!n.data_fim)return[];const o=nt(n.data_ini,n.data_fim).filter(a=>new Date(a+"T12:00:00").getDay()!==0),t=J.value;return o.map(a=>{const s=(t.get(a)||[]).filter(i=>i.status==="ATIVO").slice().sort((i,E)=>new Date(i.data_hora)-new Date(E.data_hora)).map(i=>({id:i.id,hora:i.data_hora.split("T")[1].substring(0,5),tipo:i.tipo,data_hora:i.data_hora,observacao:i.observacao})),d=s.filter(i=>i.tipo==="ENTRADA"),_=s.filter(i=>i.tipo==="SAIDA");return{data:a,funcionario_id:n.funcionario_id,ent1:d[0],sai1:_[0],ent2:d[1],sai2:_[1]}}).sort((a,l)=>l.data.localeCompare(a.data))});async function T(){var o,t,a,l;if(!n.funcionario_id)return m.warn("Selecione um funcionário");try{f.value=!0;const{data:s}=await F.listarRegistros({...n});x.value=s||[]}catch(s){console.log("[PONTO] ERRO buscar:",(o=s==null?void 0:s.response)==null?void 0:o.status,(t=s==null?void 0:s.response)==null?void 0:t.data),m.error(((l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.message)||"Erro ao buscar")}finally{f.value=!1}}async function W(o){var t,a,l,s;if(await ot.show("Excluir","Deseja apagar este registro?"))try{await P.remover(o),m.success("Apagado!"),await T()}catch(d){console.log("[PONTO] ERRO excluir:",(t=d==null?void 0:d.response)==null?void 0:t.status,(a=d==null?void 0:d.response)==null?void 0:a.data),m.error(((s=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:s.message)||"Erro ao excluir")}}function G(o,t){const a=q.value,l={ent1:(a==null?void 0:a.horario_entrada_1)||"07:30",sai1:(a==null?void 0:a.horario_saida_1)||"12:00",ent2:(a==null?void 0:a.horario_entrada_2)||"13:30",sai2:(a==null?void 0:a.horario_saida_2)||"17:30"};Object.assign(r,{open:!0,id:null,form:{funcionario_id:n.funcionario_id,data_hora_local:`${o.data}T${l[t]}`,tipo:t.startsWith("ent")?"ENTRADA":"SAIDA",observacao:"AJUSTE MANUAL"}})}function Y(o){Object.assign(r,{open:!0,id:o.id,form:{funcionario_id:n.funcionario_id,data_hora_local:o.data_hora.slice(0,16).replace(" ","T"),tipo:o.tipo,observacao:o.observacao||""}})}async function K(){var o,t,a,l;try{r.saving=!0;const s={funcionario_id:Number(r.form.funcionario_id),tipo:r.form.tipo,observacao:r.form.observacao||null,data_hora:`${r.form.data_hora_local}:00`};r.id?await P.atualizar(r.id,s):await P.salvar(s),m.success("Sucesso!"),r.open=!1,await T()}catch(s){console.log("[PONTO] ERRO salvar/editar:",(o=s==null?void 0:s.response)==null?void 0:o.status,(t=s==null?void 0:s.response)==null?void 0:t.data),m.error(((l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.message)||"Erro ao salvar")}finally{r.saving=!1}}async function X(o){Object.assign(c,{open:!0,dia:o.data,form:{funcionario_id:n.funcionario_id,data:o.data,tipo:"",descricao:""}})}async function Z(){var o,t,a,l;try{c.saving=!0,await st.salvar(c.form),m.success("Justificativa salva!"),c.open=!1,await T()}catch(s){console.log("[PONTO] ERRO justificar:",(o=s==null?void 0:s.response)==null?void 0:o.status,(t=s==null?void 0:s.response)==null?void 0:t.data),m.error(((l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.message)||"Erro ao salvar")}finally{c.saving=!1}}return tt(async()=>{const{data:o}=await et.listar(),t=((o==null?void 0:o.data)||o||[]).filter(l=>l.status==="ATIVO");k.value=t,b.value=t.map(l=>({label:l.nome,value:l.id}));const a=new Date;n.data_ini=new Date(a.getFullYear(),a.getMonth(),1).toISOString().slice(0,10),n.data_fim=a.toISOString().slice(0,10)}),(o,t)=>(p(),u("div",dt,[x.value.length?(p(),u("div",ct,[e("div",ut,[t[14]||(t[14]=e("div",{class:"w-12 h-12 rounded-2xl bg-slate-900 text-white flex items-center justify-center shadow-lg"},[e("i",{class:"pi pi-calendar text-xl"})],-1)),e("div",null,[t[13]||(t[13]=e("p",{class:"text-[10px] font-black uppercase text-slate-400"},"Meta Diária",-1)),e("p",pt,g(D.value.metaDia.toFixed(2))+"h",1)])]),e("div",ft,[t[16]||(t[16]=e("div",{class:"w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center shadow-inner font-black italic"},"HH",-1)),e("div",null,[t[15]||(t[15]=e("p",{class:"text-[10px] font-black uppercase text-slate-400"},"Trabalhado",-1)),e("p",xt,g(D.value.totalHorasHHMM),1)])]),e("div",bt,[e("div",{class:C([D.value.totalSaldo>=0?"bg-emerald-500":"bg-rose-500","w-12 h-12 rounded-2xl text-white flex items-center justify-center shadow-lg transition-colors"])},[...t[17]||(t[17]=[e("i",{class:"pi pi-chart-bar text-xl"},null,-1)])],2),e("div",null,[t[18]||(t[18]=e("p",{class:"text-[10px] font-black uppercase text-slate-400"},"Saldo Período",-1)),e("p",{class:C([D.value.totalSaldo>=0?"text-emerald-600":"text-rose-600","text-2xl font-black tracking-tighter italic"])},g(D.value.totalSaldoHHMM),3)])])])):R("",!0),e("div",gt,[e("header",mt,[e("div",vt,[t[20]||(t[20]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block italic"},"Funcionário",-1)),v(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.funcionario_id=a),class:"w-full h-11 bg-white border border-slate-200 rounded-2xl px-4 text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-slate-900 transition-all"},[t[19]||(t[19]=e("option",{value:""},"Selecione...",-1)),(p(!0),u(j,null,M(b.value,a=>(p(),u("option",{key:a.value,value:a.value},g(a.label),9,ht))),128))],512),[[$,n.funcionario_id]])]),e("div",_t,[t[21]||(t[21]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block italic"},"Início",-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>n.data_ini=a),type:"date",class:"w-full h-11 bg-white border border-slate-200 rounded-2xl px-4 text-xs font-bold outline-none focus:ring-2 focus:ring-slate-900"},null,512),[[y,n.data_ini]])]),e("div",yt,[t[22]||(t[22]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase ml-2 mb-1 block italic"},"Fim",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>n.data_fim=a),type:"date",class:"w-full h-11 bg-white border border-slate-200 rounded-2xl px-4 text-xs font-bold outline-none focus:ring-2 focus:ring-slate-900"},null,512),[[y,n.data_fim]])]),e("div",wt,[e("button",{onClick:T,disabled:f.value,class:"w-full h-11 bg-slate-900 text-white rounded-2xl font-black text-[10px] uppercase italic tracking-widest hover:bg-slate-800 transition-all flex items-center justify-center gap-2"},[f.value?(p(),u("i",St)):(p(),u("i",Dt)),t[23]||(t[23]=e("span",{class:"hidden md:block"},"Buscar",-1))],8,kt),e("button",{onClick:H,disabled:A.value||!n.funcionario_id||!n.data_ini,class:"w-full h-11 bg-white border border-slate-200 text-slate-700 rounded-2xl font-black text-[10px] uppercase italic tracking-widest hover:bg-slate-900 hover:text-white transition-all flex items-center justify-center gap-2"},[A.value?(p(),u("i",Tt)):(p(),u("i",At)),t[24]||(t[24]=e("span",{class:"hidden md:block"},"PDF",-1))],8,Ot)])]),e("div",Et,[e("table",Nt,[t[28]||(t[28]=e("thead",null,[e("tr",{class:"text-[10px] font-black text-slate-400 uppercase italic tracking-widest"},[e("th",{class:"px-6 py-2 text-left"},"Data"),e("th",{class:"px-2 py-2"},"Ent 1"),e("th",{class:"px-2 py-2"},"Sai 1"),e("th",{class:"px-2 py-2"},"Ent 2"),e("th",{class:"px-2 py-2"},"Sai 2"),e("th",{class:"px-6 py-2 text-right"},"Ações")])],-1)),e("tbody",null,[(p(!0),u(j,null,M(Q.value,a=>(p(),u("tr",{key:a.data,class:"group bg-white hover:bg-slate-50 transition-all shadow-sm"},[e("td",Rt,[e("div",Ct,[e("span",jt,g(U(a.data)),1),e("span",Mt,g(z(a.data)),1)])]),(p(),u(j,null,M(["ent1","sai1","ent2","sai2"],l=>{var s,d,_,i;return e("td",{key:l,class:"px-2 py-4 border-y border-slate-50 text-center"},[e("div",Pt,[e("span",{class:C(["tabular-nums font-black text-sm",[(s=a[l])!=null&&s.hora?l.startsWith("ent")?"text-blue-600":"text-slate-600":"text-slate-200",L(a.data,(d=a[l])==null?void 0:d.hora)?"text-rose-500":""]])},g(((_=a[l])==null?void 0:_.hora)||"--:--"),3),(i=a[l])!=null&&i.id?(p(),u("div",It,[e("button",{onClick:E=>Y(a[l]),class:"text-slate-300 hover:text-blue-500 p-1"},[...t[25]||(t[25]=[e("i",{class:"pi pi-pencil text-[9px]"},null,-1)])],8,Ut),e("button",{onClick:E=>W(a[l].id),class:"text-slate-300 hover:text-rose-500 p-1"},[...t[26]||(t[26]=[e("i",{class:"pi pi-trash text-[9px]"},null,-1)])],8,$t)])):(p(),u("button",{key:1,onClick:E=>G(a,l),class:"opacity-0 group-hover/btn:opacity-100 text-slate-200 hover:text-slate-900 transition-opacity p-1"},[...t[27]||(t[27]=[e("i",{class:"pi pi-plus text-[9px]"},null,-1)])],8,Ft))])])}),64)),e("td",Vt,[e("button",{onClick:l=>X(a),class:"px-3 py-1.5 rounded-xl bg-slate-100 text-slate-500 text-[9px] font-black uppercase hover:bg-slate-900 hover:text-white transition-all"},"Justificar",8,Ht)])]))),128))])])])]),r.open?(p(),u("div",Jt,[e("div",zt,[e("div",Bt,[e("h3",Lt,g(r.id?"Ajustar Horário":"Novo Horário"),1),e("button",{onClick:t[3]||(t[3]=a=>r.open=!1),class:"text-slate-400 hover:text-rose-500"},[...t[29]||(t[29]=[e("i",{class:"pi pi-times"},null,-1)])])]),e("div",qt,[e("div",Qt,[t[30]||(t[30]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase italic"},"Data e Hora",-1)),v(e("input",{type:"datetime-local","onUpdate:modelValue":t[4]||(t[4]=a=>r.form.data_hora_local=a),class:"w-full h-12 bg-slate-50 border border-slate-100 rounded-2xl px-4 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-slate-900"},null,512),[[y,r.form.data_hora_local]])]),e("div",Wt,[t[32]||(t[32]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase italic"},"Tipo",-1)),v(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.form.tipo=a),class:"w-full h-12 bg-slate-50 border border-slate-100 rounded-2xl px-4 font-bold text-slate-700 outline-none"},[...t[31]||(t[31]=[e("option",{value:"ENTRADA"},"ENTRADA",-1),e("option",{value:"SAIDA"},"SAÍDA",-1)])],512),[[$,r.form.tipo]])]),e("div",Gt,[t[33]||(t[33]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase italic"},"Observação",-1)),v(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.form.observacao=a),class:"w-full h-12 bg-slate-50 border border-slate-100 rounded-2xl px-4 font-bold text-slate-700 outline-none",placeholder:"Motivo do ajuste..."},null,512),[[y,r.form.observacao]])])]),e("div",Yt,[e("button",{onClick:t[7]||(t[7]=a=>r.open=!1),class:"flex-1 h-12 rounded-2xl font-black text-[10px] uppercase bg-white border border-slate-200 text-slate-400"},"Cancelar"),e("button",{onClick:K,disabled:r.saving,class:"flex-1 h-12 rounded-2xl font-black text-[10px] uppercase bg-slate-900 text-white shadow-lg shadow-slate-200"},g(r.saving?"Gravando...":"Salvar"),9,Kt)])])])):R("",!0),c.open?(p(),u("div",Xt,[e("div",Zt,[e("div",te,[e("div",null,[t[34]||(t[34]=e("h3",{class:"font-black text-slate-800 uppercase italic text-xl leading-none"},"Justificativa",-1)),e("p",ee,"Data: "+g(U(c.dia)),1)]),e("button",{onClick:t[8]||(t[8]=a=>c.open=!1),class:"text-slate-400 hover:text-rose-500"},[...t[35]||(t[35]=[e("i",{class:"pi pi-times"},null,-1)])])]),e("div",ae,[e("div",se,[e("div",oe,[t[36]||(t[36]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase italic"},"Tipo (Ex: Atestado)",-1)),v(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>c.form.tipo=a),class:"w-full h-12 bg-slate-50 border border-slate-100 rounded-2xl px-4 font-bold outline-none"},null,512),[[y,c.form.tipo]])]),e("div",le,[t[37]||(t[37]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase italic"},"Data",-1)),v(e("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=a=>c.form.data=a),class:"w-full h-12 bg-slate-50 border border-slate-100 rounded-2xl px-4 font-bold outline-none"},null,512),[[y,c.form.data]])])]),e("div",ie,[t[38]||(t[38]=e("label",{class:"text-[10px] font-black text-slate-400 uppercase italic"},"Descrição",-1)),v(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=a=>c.form.descricao=a),class:"w-full h-24 bg-slate-50 border border-slate-100 rounded-2xl p-4 font-bold outline-none resize-none"},null,512),[[y,c.form.descricao]])])]),e("div",ne,[e("button",{onClick:t[12]||(t[12]=a=>c.open=!1),class:"flex-1 h-12 rounded-2xl font-black text-[10px] uppercase bg-white border border-slate-200 text-slate-400"},"Fechar"),e("button",{onClick:Z,disabled:c.saving,class:"flex-1 h-12 rounded-2xl font-black text-[10px] uppercase bg-slate-900 text-white shadow-lg"},"Lançar Justificativa",8,re)])])])):R("",!0)]))}};export{ue as default};
//# sourceMappingURL=index-DAr-NCKF.js.map
