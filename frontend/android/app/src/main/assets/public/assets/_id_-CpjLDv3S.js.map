{"version":3,"file":"_id_-CpjLDv3S.js","sources":["../../../backend/shared/constantes/taxas-cartao.ts","../../../backend/shared/constantes/taxa-nota-fiscal.ts","../../../backend/shared/constantes/comissoes.ts","../../src/pages/vendas/[id].vue"],"sourcesContent":["// src/constantes/taxas-cartao.js\r\n\r\nexport const TAXAS_CARTAO = {\r\n  DEBITO: {\r\n    label: 'Débito',\r\n    taxa: 1.99, // %\r\n  },\r\n\r\n  CREDITO: {\r\n    label: 'Crédito',\r\n    parcelas: {\r\n      1: 3.49,\r\n      2: 4.19,\r\n      3: 4.99,\r\n      4: 5.99,\r\n      5: 6.99,\r\n      6: 7.99,\r\n      7: 8.99,\r\n      8: 9.99,\r\n      9: 10.99,\r\n      10: 11.99,\r\n      11: 12.99,\r\n      12: 13.99,\r\n    },\r\n  },\r\n}\r\n","// src/constantes/taxa-nota-fiscal.js\r\nexport const TAXA_NOTA_FISCAL = {\r\n  label: 'Nota Fiscal',\r\n  taxa: 4.5, // number\r\n}\r\n","// src/constantes/comissoes.js\r\nexport const COMISSOES = {\r\n  ARQUITETO: { label: 'Arquiteto', percentual: 3 },\r\n  VENDEDOR: { label: 'Vendedor', percentual: 10 },\r\n  PROJETISTA: { label: 'Projetista', percentual: 5 },\r\n}\r\n","<template>\r\n  <Card :shadow=\"true\" class=\"overflow-hidden border-none\">\r\n    <PageHeader\r\n      :title=\"isEdit ? `Venda #${vendaId}` : 'Nova Venda'\"\r\n      subtitle=\"Pós-venda: venda líquida, rateio, taxas e comissões.\"\r\n      icon=\"pi pi-shopping-cart\"\r\n      :backTo=\"'/vendas'\"\r\n      class=\"bg-slate-50/50 border-b border-slate-100\"\r\n    />\r\n\r\n    <div class=\"p-6 relative\">\r\n      <Loading v-if=\"loading\" />\r\n\r\n      <div v-else class=\"space-y-8\">\r\n        <!-- ===================== -->\r\n        <!-- DADOS GERAIS -->\r\n        <!-- ===================== -->\r\n        <section class=\"space-y-4\">\r\n          <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400\">\r\n            Dados Gerais\r\n          </div>\r\n\r\n          <div class=\"grid grid-cols-12 gap-4 items-end\">\r\n            <div class=\"col-span-12 md:col-span-4\">\r\n              <SearchInput\r\n                v-model=\"clienteFiltroId\"\r\n                mode=\"select\"\r\n                label=\"Cliente *\"\r\n                placeholder=\"Selecione o cliente...\"\r\n                :options=\"clientesOptions\"\r\n                required\r\n                :readonly=\"isEdit\"\r\n              />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-4\">\r\n              <SearchInput\r\n                v-model=\"form.orcamento_id\"\r\n                mode=\"select\"\r\n                label=\"Orçamento *\"\r\n                placeholder=\"Selecione o orçamento...\"\r\n                :options=\"orcamentosOptions\"\r\n                :readonly=\"!clienteFiltroId || isEdit\"\r\n                required\r\n              />\r\n              <p\r\n                v-if=\"isEdit\"\r\n                class=\"mt-1 text-[10px] font-black uppercase tracking-widest text-slate-400\"\r\n              >\r\n                * Orçamento não altera após salvar a venda.\r\n              </p>\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-2\">\r\n              <Input :modelValue=\"'VENDA FECHADA'\" label=\"Status\" readonly />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-2\">\r\n              <Input v-model=\"form.data_venda\" type=\"date\" label=\"Data da venda\" :forceUpper=\"false\" />\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        <div class=\"h-px bg-slate-100\" />\r\n\r\n        <!-- ===================== -->\r\n        <!-- ITENS -->\r\n        <!-- ===================== -->\r\n        <section class=\"space-y-4\">\r\n          <div class=\"flex items-center justify-between gap-4\">\r\n            <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400\">\r\n              Itens da Venda\r\n            </div>\r\n\r\n            <Button\r\n              v-if=\"isEdit && can('vendas.editar')\"\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n              type=\"button\"\r\n              @click=\"abrirModalNovoItem\"\r\n            >\r\n              + Novo item\r\n            </Button>\r\n          </div>\r\n\r\n          <div v-if=\"rowsItens.length > 0\">\r\n            <Table :columns=\"columnsItens\" :rows=\"rowsItens\" :boxed=\"true\" emptyText=\"Nenhum item.\">\r\n              <template #cell-descricao=\"{ row }\">\r\n                <div class=\"whitespace-pre-line\">{{ row.descricao || '-' }}</div>\r\n              </template>\r\n\r\n              <template #cell-observacao=\"{ row }\">\r\n                <div class=\"whitespace-pre-line font-bold\">{{ row.observacao || '-' }}</div>\r\n              </template>\r\n\r\n              <template #cell-quantidade=\"{ row }\">\r\n                <Input\r\n                  v-if=\"isEdit && can('vendas.editar')\"\r\n                  v-model.number=\"form.itens[row.__idx].quantidade\"\r\n                  type=\"number\"\r\n                  min=\"1\"\r\n                  :forceUpper=\"false\"\r\n                />\r\n                <span v-else class=\"font-bold\">{{ row.quantidade }}</span>\r\n              </template>\r\n\r\n              <template #cell-valor_unitario=\"{ row }\">\r\n                <span class=\"font-bold\">{{ format.currency(row.valor_unitario) }}</span>\r\n              </template>\r\n\r\n              <template #cell-valor_total=\"{ row }\">\r\n                <span class=\"font-bold\">{{ format.currency(totalItem(row)) }}</span>\r\n              </template>\r\n\r\n              <template #cell-acoes=\"{ row }\">\r\n                <div v-if=\"isEdit && can('vendas.editar')\" class=\"flex justify-end gap-2\">\r\n                  <Button\r\n                    variant=\"secondary\"\r\n                    size=\"sm\"\r\n                    type=\"button\"\r\n                    @click=\"row.id ? iniciarEdicaoItem(row) : editarItemLocal(row)\"\r\n                  >\r\n                    Editar\r\n                  </Button>\r\n\r\n                  <Button\r\n                    variant=\"danger\"\r\n                    size=\"sm\"\r\n                    type=\"button\"\r\n                    @click=\"confirmarRemoverItemVenda(row)\"\r\n                  >\r\n                    Remover\r\n                  </Button>\r\n                </div>\r\n\r\n                <span v-else class=\"text-[10px] font-black uppercase tracking-widest text-slate-300\">\r\n                  —\r\n                </span>\r\n              </template>\r\n            </Table>\r\n          </div>\r\n\r\n          <div v-else class=\"text-[10px] font-black uppercase tracking-widest text-slate-400 italic\">\r\n            Selecione um orçamento para carregar os itens.\r\n          </div>\r\n\r\n          <div class=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n            * Itens são clonados do orçamento ao salvar. Em edição, as alterações afetam apenas a venda.\r\n          </div>\r\n        </section>\r\n\r\n        <div class=\"h-px bg-slate-100\" />\r\n\r\n        <!-- ===================== -->\r\n        <!-- PAGAMENTOS / RATEIO -->\r\n        <!-- ===================== -->\r\n        <section class=\"space-y-4\">\r\n          <div class=\"flex items-center justify-between gap-4\">\r\n            <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400\">\r\n              Pagamentos (Rateio)\r\n            </div>\r\n\r\n            <Button\r\n              v-if=\"can(permSalvarVenda())\"\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n              type=\"button\"\r\n              @click=\"addPagamento\"\r\n            >\r\n              + Adicionar pagamento\r\n            </Button>\r\n          </div>\r\n\r\n          <div class=\"grid grid-cols-12 gap-4 items-end\">\r\n            <div class=\"col-span-12 md:col-span-4\">\r\n              <Input\r\n                v-model.number=\"form.valor_vendido\"\r\n                type=\"number\"\r\n                label=\"Valor total vendido (cobrado) *\"\r\n                :forceUpper=\"false\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <Table :columns=\"columnsPagamentos\" :rows=\"rowsPagamentos\" :boxed=\"true\" emptyText=\"Nenhum pagamento.\">\r\n            <template #cell-forma=\"{ row }\">\r\n              <SearchInput\r\n                v-model=\"form.pagamentos[row.__idx].forma_pagamento_chave\"\r\n                mode=\"select\"\r\n                placeholder=\"Selecione...\"\r\n                :options=\"FORMAS_PAGAMENTO_OPTIONS\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </template>\r\n\r\n            <template #cell-data_prevista=\"{ row }\">\r\n              <Input\r\n                v-model=\"form.pagamentos[row.__idx].data_prevista_recebimento\"\r\n                type=\"date\"\r\n                :forceUpper=\"false\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </template>\r\n\r\n            <template #cell-data_recebimento=\"{ row }\">\r\n              <Input\r\n                v-model=\"form.pagamentos[row.__idx].data_recebimento\"\r\n                type=\"date\"\r\n                :forceUpper=\"false\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </template>\r\n\r\n            <template #cell-parcelas=\"{ row }\">\r\n              <Input\r\n                v-if=\"form.pagamentos[row.__idx].forma_pagamento_chave === 'CREDITO'\"\r\n                v-model.number=\"form.pagamentos[row.__idx].parcelas\"\r\n                type=\"number\"\r\n                min=\"1\"\r\n                max=\"12\"\r\n                :forceUpper=\"false\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n              <span v-else class=\"text-slate-300\">—</span>\r\n            </template>\r\n\r\n            <template #cell-valor=\"{ row }\">\r\n              <Input\r\n                v-model.number=\"form.pagamentos[row.__idx].valor\"\r\n                type=\"number\"\r\n                :forceUpper=\"false\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </template>\r\n\r\n            <template #cell-acoes=\"{ row }\">\r\n              <div class=\"flex justify-end\">\r\n                <Button\r\n                  v-if=\"can(permSalvarVenda())\"\r\n                  variant=\"danger\"\r\n                  size=\"sm\"\r\n                  type=\"button\"\r\n                  :disabled=\"form.pagamentos.length === 1\"\r\n                  @click=\"confirmarRemoverPagamento(row.__idx)\"\r\n                >\r\n                  Remover\r\n                </Button>\r\n                <span\r\n                  v-else\r\n                  class=\"text-[10px] font-black uppercase tracking-widest text-slate-300\"\r\n                >\r\n                  —\r\n                </span>\r\n              </div>\r\n            </template>\r\n          </Table>\r\n\r\n          <div class=\"flex items-center justify-end gap-6 pt-2\">\r\n            <div class=\"text-sm font-black uppercase tracking-tight\">\r\n              Total rateado:\r\n              <span class=\"text-brand-primary\">{{ format.currency(somaPagamentos) }}</span>\r\n            </div>\r\n\r\n            <div class=\"text-sm font-black uppercase tracking-tight\">\r\n              Diferença:\r\n              <span :class=\"pagamentosBatendo ? 'text-emerald-600' : 'text-rose-600'\">\r\n                {{ format.currency(diferencaRateio) }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        <div class=\"h-px bg-slate-100\" />\r\n\r\n        <!-- ===================== -->\r\n        <!-- COMISSÕES -->\r\n        <!-- ===================== -->\r\n        <section class=\"space-y-4\">\r\n          <div class=\"flex items-center justify-between gap-4\">\r\n            <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400\">\r\n              Comissões\r\n            </div>\r\n\r\n            <Button\r\n              v-if=\"can(permSalvarVenda())\"\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n              type=\"button\"\r\n              @click=\"addComissao\"\r\n            >\r\n              + Adicionar comissão\r\n            </Button>\r\n          </div>\r\n\r\n          <Table :columns=\"columnsComissoes\" :rows=\"rowsComissoes\" :boxed=\"true\" emptyText=\"Nenhuma comissão.\">\r\n            <template #cell-tipo=\"{ row }\">\r\n              <SearchInput\r\n                v-model=\"form.comissoes[row.__idx].tipo_comissao_chave\"\r\n                mode=\"select\"\r\n                :options=\"COMISSOES_OPTIONS\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </template>\r\n\r\n            <template #cell-responsavel=\"{ row }\">\r\n              <Input\r\n                v-model=\"form.comissoes[row.__idx].responsavel_nome\"\r\n                placeholder=\"Nome do responsável\"\r\n                :forceUpper=\"false\"\r\n                :readonly=\"!can(permSalvarVenda())\"\r\n              />\r\n            </template>\r\n\r\n            <template #cell-percentual=\"{ row }\">\r\n              <Input :modelValue=\"pctComissao(row.tipo_comissao_chave)\" type=\"number\" readonly :forceUpper=\"false\" />\r\n            </template>\r\n\r\n            <template #cell-valor=\"{ row }\">\r\n              <span class=\"font-black text-slate-900\">{{ format.currency(valorComissao(row)) }}</span>\r\n            </template>\r\n\r\n            <template #cell-acoes=\"{ row }\">\r\n              <div class=\"flex justify-end\">\r\n                <Button\r\n                  v-if=\"can(permSalvarVenda())\"\r\n                  variant=\"danger\"\r\n                  size=\"sm\"\r\n                  type=\"button\"\r\n                  @click=\"confirmarRemoverComissao(row.__idx)\"\r\n                >\r\n                  Remover\r\n                </Button>\r\n                <span\r\n                  v-else\r\n                  class=\"text-[10px] font-black uppercase tracking-widest text-slate-300\"\r\n                >\r\n                  —\r\n                </span>\r\n              </div>\r\n            </template>\r\n          </Table>\r\n\r\n          <div class=\"text-[10px] font-black uppercase tracking-widest text-slate-400 italic\">\r\n            * O percentual de comissão é fixo conforme configurações do sistema.\r\n          </div>\r\n        </section>\r\n\r\n        <div class=\"h-px bg-slate-100\" />\r\n\r\n        <!-- ===================== -->\r\n        <!-- RESUMO -->\r\n        <!-- ===================== -->\r\n        <section class=\"space-y-4\">\r\n          <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400\">\r\n            Taxas e Resumo Líquido\r\n          </div>\r\n\r\n          <div class=\"grid grid-cols-12 gap-4 items-end\">\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <Input :modelValue=\"format.currency(valor_bruto)\" label=\"Total vendido (base)\" readonly />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <Input :modelValue=\"format.currency(valor_taxa_pagamento)\" label=\"Taxa Cartão/Meio\" readonly />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <CustomCheckbox\r\n                v-model=\"form.tem_nota_fiscal\"\r\n                label=\"Emitir Nota Fiscal\"\r\n                :disabled=\"!can(permSalvarVenda())\"\r\n              />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <Input\r\n                :modelValue=\"`${form.tem_nota_fiscal ? form.taxa_nota_fiscal_percentual_aplicado : 0}%`\"\r\n                label=\"Alíquota NF\"\r\n                readonly\r\n              />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <Input :modelValue=\"format.currency(valor_taxa_nf)\" label=\"Valor Imposto NF\" readonly />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <Input :modelValue=\"format.currency(total_taxas)\" label=\"Total de Impostos/Taxas\" readonly />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <Input :modelValue=\"format.currency(valor_comissoes)\" label=\"Total Comissões\" readonly />\r\n            </div>\r\n\r\n            <div class=\"col-span-12 md:col-span-3\">\r\n              <div class=\"rounded-2xl border border-slate-100 bg-slate-50/60 p-3\">\r\n                <Input :modelValue=\"format.currency(lucro_bruto)\" label=\"Resultado Líquido\" readonly />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        <div class=\"h-px bg-slate-100\" />\r\n\r\n        <!-- ===================== -->\r\n        <!-- ARQUIVOS (PWA) -->\r\n        <!-- ===================== -->\r\n        <section class=\"space-y-4\">\r\n          <div class=\"flex items-center justify-between gap-4\">\r\n            <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400\">\r\n              Arquivos e Comprovantes\r\n            </div>\r\n\r\n            <Button\r\n              v-if=\"isEdit && can('vendas.editar')\"\r\n              variant=\"secondary\"\r\n              size=\"sm\"\r\n              type=\"button\"\r\n              @click=\"arquivosOpen = true\"\r\n            >\r\n              Abrir Arquivos\r\n            </Button>\r\n          </div>\r\n\r\n          <div class=\"p-6 rounded-3xl border border-slate-100 bg-slate-50/50\">\r\n            <div class=\"text-[10px] font-black uppercase tracking-widest text-slate-400 text-center py-2\">\r\n              Use “Abrir Arquivos” para anexar / visualizar dentro do PWA.\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n            * O upload fica disponível apenas após a criação da venda no sistema.\r\n          </div>\r\n        </section>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- ===================== -->\r\n    <!-- FOOTER AÇÕES -->\r\n    <!-- ===================== -->\r\n    <footer class=\"flex items-center justify-end gap-3 p-6 border-t border-slate-100 bg-slate-50/30\">\r\n      <Button\r\n        v-if=\"isEdit && can('vendas.editar')\"\r\n        variant=\"secondary\"\r\n        size=\"md\"\r\n        type=\"button\"\r\n        :disabled=\"saving\"\r\n        @click=\"confirmarEnviarParaProducao\"\r\n      >\r\n        Enviar para produção\r\n      </Button>\r\n\r\n      <Button\r\n        v-if=\"can(permSalvarVenda())\"\r\n        variant=\"primary\"\r\n        size=\"md\"\r\n        type=\"button\"\r\n        :loading=\"saving\"\r\n        :disabled=\"saving\"\r\n        @click=\"confirmarSalvarVenda\"\r\n      >\r\n        Salvar Venda\r\n      </Button>\r\n    </footer>\r\n\r\n    <!-- ===================== -->\r\n    <!-- MODAL ITEM EXTRA -->\r\n    <!-- ===================== -->\r\n    <div\r\n      v-if=\"modalItemOpen\"\r\n      class=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm\"\r\n      @click.self=\"fecharModalItem\"\r\n    >\r\n      <Card :shadow=\"true\" class=\"w-full max-w-[780px] overflow-hidden border-none\">\r\n        <div class=\"p-5 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between\">\r\n          <div class=\"text-[11px] font-black uppercase tracking-[0.18em] text-slate-500\">\r\n            {{ modalItemEditando ? 'Editar item' : 'Novo item (extra na venda)' }}\r\n          </div>\r\n\r\n          <Button variant=\"secondary\" size=\"sm\" type=\"button\" @click=\"fecharModalItem\">\r\n            Fechar\r\n          </Button>\r\n        </div>\r\n\r\n        <div class=\"p-6 space-y-5\">\r\n          <div class=\"grid grid-cols-12 gap-4 items-end\">\r\n            <Input\r\n              class=\"col-span-12 md:col-span-6\"\r\n              v-model=\"itemDraft.nome_ambiente\"\r\n              label=\"Item/Ambiente *\"\r\n              placeholder=\"Ex: COZINHA / ARMÁRIO / FRETE\"\r\n              :forceUpper=\"false\"\r\n            />\r\n\r\n            <Input\r\n              class=\"col-span-12 md:col-span-6\"\r\n              v-model=\"itemDraft.descricao\"\r\n              label=\"Acabamento\"\r\n              placeholder=\"Ex: MDF BRANCO / RIPADO / VIDRO\"\r\n              :forceUpper=\"false\"\r\n            />\r\n\r\n            <Input\r\n              class=\"col-span-12\"\r\n              v-model=\"itemDraft.observacao\"\r\n              label=\"Observações\"\r\n              placeholder=\"Texto livre\"\r\n              :forceUpper=\"false\"\r\n            />\r\n\r\n            <Input\r\n              class=\"col-span-12 md:col-span-4\"\r\n              v-model.number=\"itemDraft.quantidade\"\r\n              type=\"number\"\r\n              min=\"1\"\r\n              label=\"Quantidade\"\r\n              :forceUpper=\"false\"\r\n            />\r\n\r\n            <Input\r\n              class=\"col-span-12 md:col-span-4\"\r\n              v-model.number=\"itemDraft.valor_unitario\"\r\n              type=\"number\"\r\n              min=\"0\"\r\n              step=\"0.01\"\r\n              label=\"Valor unitário\"\r\n              :forceUpper=\"false\"\r\n            />\r\n\r\n            <Input\r\n              class=\"col-span-12 md:col-span-4\"\r\n              :modelValue=\"format.currency(totalItem(itemDraft))\"\r\n              label=\"Total\"\r\n              readonly\r\n            />\r\n          </div>\r\n\r\n          <div class=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">\r\n            * Esse item é extra na venda (não altera o orçamento).\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"p-5 border-t border-slate-100 bg-slate-50/50 flex justify-end gap-3\">\r\n          <Button variant=\"secondary\" type=\"button\" @click=\"fecharModalItem\">\r\n            Cancelar\r\n          </Button>\r\n          <Button variant=\"primary\" type=\"button\" @click=\"salvarItemDoModal\">\r\n            Salvar item\r\n          </Button>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  </Card>\r\n\r\n  <!-- ARQUIVOS MODAL GLOBAL (PWA) -->\r\n  <ArquivosModal\r\n    v-if=\"arquivosOpen && vendaId\"\r\n    :open=\"arquivosOpen\"\r\n    owner-type=\"VENDA\"\r\n    :owner-id=\"vendaId\"\r\n    categoria=\"ANEXO\"\r\n    :can-manage=\"can('vendas.editar')\"\r\n    view-perm=\"vendas.ver\"\r\n    @close=\"arquivosOpen = false\"\r\n  />\r\n</template>\r\n\r\n\r\n<script setup>\r\nimport { reactive, ref, computed, watch, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { confirm } from '@/services/confirm'\r\nimport { notify } from '@/services/notify'\r\nimport { ClienteService, OrcamentosService, VendaService, ProducaoService } from '@/services/index'\r\nimport { format } from '@/utils/format'\r\nimport { FORMAS_PAGAMENTO, COMISSOES, TAXAS_CARTAO, TAXA_NOTA_FISCAL, PIPELINE_CLIENTE } from '@/constantes'\r\nimport { can } from '@/services/permissions'\r\n\r\ndefinePage({ meta: { perm: 'vendas.ver' } })\r\n\r\n// =======================\r\n// ROUTE\r\n// =======================\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nconst arquivosOpen = ref(false)\r\n\r\nconst vendaId = computed(() => {\r\n  const n = Number(String(route.params.id || '').replace(/\\D/g, ''))\r\n  return Number.isFinite(n) && n > 0 ? n : null\r\n})\r\nconst isEdit = computed(() => !!vendaId.value)\r\n\r\n// ✅ perm salvar (criar/editar)\r\nconst permSalvarVenda = () => (isEdit.value ? 'vendas.editar' : 'vendas.criar')\r\n\r\n// =======================\r\n// UI STATE\r\n// =======================\r\nconst loading = ref(false)\r\nconst saving = ref(false)\r\n\r\nconst clientesOptions = ref([])\r\nconst orcamentosOptions = ref([])\r\nconst clienteFiltroId = ref('')\r\n\r\n// =======================\r\n// CONSTANTS / OPTIONS\r\n// =======================\r\nconst FORMAS_PAGAMENTO_OPTIONS = (FORMAS_PAGAMENTO || []).map((x) => ({ label: x.label, value: x.key }))\r\nconst COMISSOES_OPTIONS = Object.entries(COMISSOES || {}).map(([key, v]) => ({ label: v.label, value: key }))\r\n\r\n// =======================\r\n// HELPERS\r\n// =======================\r\nfunction num(v) {\r\n  const n = Number(String(v ?? '').replace(',', '.'))\r\n  return Number.isFinite(n) ? n : 0\r\n}\r\nfunction round2(n) {\r\n  return Math.round((Number(n) + Number.EPSILON) * 100) / 100\r\n}\r\nfunction totalItem(row) {\r\n  const q = Number(row?.quantidade || 0)\r\n  const u = Number(row?.valor_unitario || 0)\r\n  return round2(q * u)\r\n}\r\nfunction pctComissao(tipo) {\r\n  return Number(COMISSOES?.[String(tipo || '')]?.percentual || 0)\r\n}\r\nfunction taxaPctPorForma(forma, parcelas) {\r\n  const f = String(forma || '')\r\n  if (f === 'DEBITO') return Number(TAXAS_CARTAO?.DEBITO?.taxa || 0)\r\n  if (f === 'CREDITO') {\r\n    const p = Math.min(12, Math.max(1, Number(parcelas || 1)))\r\n    return Number(TAXAS_CARTAO?.CREDITO?.parcelas?.[p] || 0)\r\n  }\r\n  return 0\r\n}\r\nfunction pipelineKey(key) {\r\n  const k = PIPELINE_CLIENTE.find((p) => p.key === key)?.key\r\n  if (!k) throw new Error(`PIPELINE_CLIENTE key não encontrada: ${key}`)\r\n  return k\r\n}\r\n\r\n// =======================\r\n// FORM\r\n// =======================\r\nconst form = reactive({\r\n  orcamento_id: '',\r\n  status: pipelineKey('VENDA_FECHADA'),\r\n  data_venda: new Date().toISOString().slice(0, 10),\r\n\r\n  valor_vendido: 0,\r\n\r\n  itens: [],\r\n\r\n  pagamentos: [\r\n    {\r\n      forma_pagamento_chave: '',\r\n      valor: 0,\r\n      parcelas: 1,\r\n      data_prevista_recebimento: '',\r\n      data_recebimento: '',\r\n      status_financeiro_chave: 'EM_ABERTO',\r\n    },\r\n  ],\r\n\r\n  comissoes: [],\r\n\r\n  taxa_pagamento_percentual_aplicado: 0,\r\n  tem_nota_fiscal: false,\r\n  taxa_nota_fiscal_percentual_aplicado: Number(TAXA_NOTA_FISCAL?.taxa || 0),\r\n})\r\n\r\n// =======================\r\n// ROWS (somente p/ render)\r\n// =======================\r\nconst rowsItens = computed(() => (form.itens || []).map((it, idx) => ({ ...it, __idx: idx })))\r\nconst rowsPagamentos = computed(() => (form.pagamentos || []).map((p, idx) => ({ ...p, __idx: idx })))\r\nconst rowsComissoes = computed(() => (form.comissoes || []).map((c, idx) => ({ ...c, __idx: idx })))\r\n\r\n// =======================\r\n// MODAL ITEM EXTRA (LOCAL)\r\n// =======================\r\nconst modalItemOpen = ref(false)\r\nconst modalItemEditando = ref(false)\r\nconst itemEditIdx = ref(null)\r\n\r\nconst itemDraft = reactive({\r\n  nome_ambiente: '',\r\n  descricao: '',\r\n  observacao: '',\r\n  quantidade: 1,\r\n  valor_unitario: 0,\r\n})\r\n\r\nfunction resetItemDraft() {\r\n  itemDraft.nome_ambiente = ''\r\n  itemDraft.descricao = ''\r\n  itemDraft.observacao = ''\r\n  itemDraft.quantidade = 1\r\n  itemDraft.valor_unitario = 0\r\n  itemEditIdx.value = null\r\n  modalItemEditando.value = false\r\n}\r\n\r\nfunction abrirModalNovoItem() {\r\n  if (!isEdit.value || !can('vendas.editar')) return notify.error('Acesso negado.')\r\n  resetItemDraft()\r\n  modalItemOpen.value = true\r\n}\r\n\r\nfunction fecharModalItem() {\r\n  modalItemOpen.value = false\r\n}\r\n\r\nfunction editarItemLocal(row) {\r\n  if (!isEdit.value || !can('vendas.editar')) return notify.error('Acesso negado.')\r\n  if (!row) return\r\n  const base = form.itens?.[row.__idx]\r\n  if (!base) return\r\n\r\n  modalItemEditando.value = true\r\n  itemEditIdx.value = row.__idx\r\n\r\n  itemDraft.nome_ambiente = base.nome_ambiente || ''\r\n  itemDraft.descricao = base.descricao || ''\r\n  itemDraft.observacao = base.observacao || ''\r\n  itemDraft.quantidade = Number(base.quantidade || 1)\r\n  itemDraft.valor_unitario = Number(base.valor_unitario || 0)\r\n\r\n  modalItemOpen.value = true\r\n}\r\n\r\nfunction salvarItemDoModal() {\r\n  if (!isEdit.value || !can('vendas.editar')) return notify.error('Acesso negado.')\r\n\r\n  if (!String(itemDraft.nome_ambiente || '').trim()) {\r\n    notify.warn('Preencha Item/Ambiente')\r\n    return\r\n  }\r\n\r\n  const payload = {\r\n    nome_ambiente: String(itemDraft.nome_ambiente || '').trim(),\r\n    descricao: String(itemDraft.descricao || ''),\r\n    observacao: String(itemDraft.observacao || ''),\r\n    quantidade: Math.max(1, Number(itemDraft.quantidade || 1)),\r\n    valor_unitario: round2(num(itemDraft.valor_unitario || 0)),\r\n  }\r\n\r\n  if (modalItemEditando.value && itemEditIdx.value !== null) {\r\n    Object.assign(form.itens[itemEditIdx.value], payload)\r\n    fecharModalItem()\r\n    return\r\n  }\r\n\r\n  form.itens.push(payload)\r\n  fecharModalItem()\r\n}\r\n\r\nfunction removerItem(row) {\r\n  if (!isEdit.value || !can('vendas.editar')) return notify.error('Acesso negado.')\r\n  if (row?.id) {\r\n    notify.warn('Remoção de item do orçamento não disponível (sem endpoint).')\r\n    return\r\n  }\r\n  const idx = row?.__idx\r\n  if (idx === undefined || idx === null) return\r\n  form.itens.splice(idx, 1)\r\n}\r\n\r\n// =======================\r\n// CONFIRMS\r\n// =======================\r\nasync function confirmarSalvarVenda() {\r\n  const perm = permSalvarVenda()\r\n  if (!can(perm)) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show(\r\n    isEdit.value ? 'Salvar Venda' : 'Criar Venda',\r\n    isEdit.value\r\n      ? `Deseja salvar as alterações da Venda #${vendaId.value}?`\r\n      : 'Deseja criar esta venda agora?',\r\n  )\r\n  if (!ok) return\r\n  await salvar()\r\n}\r\n\r\nasync function confirmarEnviarParaProducao() {\r\n  if (!isEdit.value) return\r\n  if (!can('vendas.editar')) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show(\r\n    'Enviar para Produção',\r\n    `Deseja enviar a Venda #${vendaId.value} para Produção?`,\r\n  )\r\n  if (!ok) return\r\n  await enviarParaProducao()\r\n}\r\n\r\nasync function confirmarRemoverItemVenda(row) {\r\n  if (!isEdit.value || !can('vendas.editar')) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show(\r\n    'Remover Item',\r\n    `Deseja remover \"${row?.nome_ambiente || 'ITEM'}\" desta venda?`,\r\n  )\r\n  if (!ok) return\r\n  removerItem(row)\r\n}\r\n\r\nasync function confirmarRemoverPagamento(idx) {\r\n  if (!can(permSalvarVenda())) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show('Remover Pagamento', 'Deseja remover este pagamento do rateio?')\r\n  if (!ok) return\r\n  removerPagamento(idx)\r\n}\r\n\r\nasync function confirmarRemoverComissao(idx) {\r\n  if (!can(permSalvarVenda())) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show('Remover Comissão', 'Deseja remover esta comissão?')\r\n  if (!ok) return\r\n  removerComissao(idx)\r\n}\r\n\r\n// =======================\r\n// TABLE DEFINITIONS\r\n// =======================\r\nconst columnsItens = [\r\n  { key: 'nome_ambiente', label: 'Item/Ambiente' },\r\n  { key: 'descricao', label: 'Acabamento' },\r\n  { key: 'observacao', label: 'Observações' },\r\n  { key: 'quantidade', label: 'Qtd', align: 'right', width: '110px' },\r\n  { key: 'valor_unitario', label: 'Valor', align: 'right', width: '160px' },\r\n  { key: 'valor_total', label: 'Total', align: 'right', width: '160px' },\r\n  { key: 'acoes', label: '', align: 'right', width: '140px' },\r\n]\r\n\r\nconst columnsPagamentos = [\r\n  { key: 'forma', label: 'Forma', width: '220px' },\r\n  { key: 'parcelas', label: 'Parcelas', width: '120px', align: 'right' },\r\n  { key: 'valor', label: 'Valor', width: '160px', align: 'right' },\r\n  { key: 'data_prevista', label: 'Previsto', width: '150px' },\r\n  { key: 'data_recebimento', label: 'Recebido', width: '150px' },\r\n  { key: 'acoes', label: 'Ações', width: '140px', align: 'right' },\r\n]\r\n\r\nconst columnsComissoes = [\r\n  { key: 'tipo', label: 'Tipo', width: '220px' },\r\n  { key: 'responsavel', label: 'Responsável' },\r\n  { key: 'percentual', label: '%', width: '120px', align: 'right' },\r\n  { key: 'valor', label: 'Valor', width: '160px', align: 'right' },\r\n  { key: 'acoes', label: 'Ações', width: '140px', align: 'right' },\r\n]\r\n\r\n// =======================\r\n// PAGAMENTOS / RATEIO\r\n// =======================\r\nfunction addPagamento() {\r\n  if (!can(permSalvarVenda())) return notify.error('Acesso negado.')\r\n  form.pagamentos.push({\r\n    forma_pagamento_chave: '',\r\n    valor: 0,\r\n    parcelas: 1,\r\n    data_prevista_recebimento: '',\r\n    data_recebimento: '',\r\n    status_financeiro_chave: 'EM_ABERTO',\r\n  })\r\n}\r\n\r\nfunction removerPagamento(idx) {\r\n  if (!can(permSalvarVenda())) return notify.error('Acesso negado.')\r\n  if (form.pagamentos.length === 1) return\r\n  form.pagamentos.splice(idx, 1)\r\n}\r\n\r\nconst somaPagamentos = computed(() =>\r\n  round2((form.pagamentos || []).reduce((acc, p) => acc + num(p?.valor || 0), 0)),\r\n)\r\nconst diferencaRateio = computed(() => round2(somaPagamentos.value - num(form.valor_vendido || 0)))\r\nconst pagamentosBatendo = computed(() => diferencaRateio.value === 0)\r\n\r\n// =======================\r\n// COMISSÕES\r\n// =======================\r\nfunction addComissao() {\r\n  if (!can(permSalvarVenda())) return notify.error('Acesso negado.')\r\n  form.comissoes.push({ tipo_comissao_chave: 'VENDEDOR', responsavel_nome: '' })\r\n}\r\nfunction removerComissao(idx) {\r\n  if (!can(permSalvarVenda())) return notify.error('Acesso negado.')\r\n  form.comissoes.splice(idx, 1)\r\n}\r\n\r\nconst valor_bruto = computed(() => round2(num(form.valor_vendido || 0)))\r\n\r\nconst valorComissao = (row) => {\r\n  const pct = pctComissao(row?.tipo_comissao_chave)\r\n  return round2(valor_bruto.value * (pct / 100))\r\n}\r\nconst valor_comissoes = computed(() =>\r\n  round2((form.comissoes || []).reduce((acc, c) => acc + valorComissao(c), 0)),\r\n)\r\n\r\n// =======================\r\n// TAXAS\r\n// =======================\r\nconst valor_taxa_pagamento = computed(() =>\r\n  round2(\r\n    (form.pagamentos || []).reduce((acc, p) => {\r\n      const v = num(p?.valor || 0)\r\n      const pct = taxaPctPorForma(p?.forma_pagamento_chave, p?.parcelas)\r\n      return acc + round2(v * (pct / 100))\r\n    }, 0),\r\n  ),\r\n)\r\n\r\nconst taxa_pagamento_percentual_calc = computed(() => {\r\n  const base = num(form.valor_vendido || 0)\r\n  if (base <= 0) return 0\r\n  return round2((valor_taxa_pagamento.value / base) * 100)\r\n})\r\n\r\nwatch(\r\n  [() => form.pagamentos, () => form.valor_vendido],\r\n  () => {\r\n    form.taxa_pagamento_percentual_aplicado = taxa_pagamento_percentual_calc.value\r\n  },\r\n  { deep: true },\r\n)\r\n\r\nwatch(() => form.tem_nota_fiscal, (v) => {\r\n  form.taxa_nota_fiscal_percentual_aplicado = v ? Number(TAXA_NOTA_FISCAL?.taxa || 0) : 0\r\n})\r\n\r\nconst valor_taxa_nf = computed(() => {\r\n  if (!form.tem_nota_fiscal) return 0\r\n  return round2(valor_bruto.value * (num(form.taxa_nota_fiscal_percentual_aplicado || 0) / 100))\r\n})\r\n\r\nconst total_taxas = computed(() => round2(valor_taxa_pagamento.value + valor_taxa_nf.value))\r\nconst lucro_bruto = computed(() => round2(valor_bruto.value - total_taxas.value - valor_comissoes.value))\r\n\r\n// =======================\r\n// LOADERS\r\n// =======================\r\nasync function carregarClientesOptions() {\r\n  const { data } = await ClienteService.listar()\r\n  const rows = Array.isArray(data) ? data : (data?.rows || data?.data || [])\r\n  clientesOptions.value = rows.map((c) => ({\r\n    label: c.nome_completo || c.razao_social || c.nome_fantasia || c.nome || `CLIENTE #${c.id}`,\r\n    value: c.id,\r\n  }))\r\n}\r\n\r\nasync function carregarOrcamentosOptions(clienteId) {\r\n  const { data } = await OrcamentosService.listar()\r\n  const rows = Array.isArray(data) ? data : (data?.rows || data?.data || [])\r\n  orcamentosOptions.value = rows\r\n    .filter((o) => Number(o?.cliente_id) === Number(clienteId))\r\n    .map((o) => ({ label: `Orçamento #${o.id}`, value: o.id }))\r\n}\r\n\r\nasync function carregarOrcamentoNaVenda(orcamentoId) {\r\n  loading.value = true\r\n  try {\r\n    const { data } = await OrcamentosService.detalhar(orcamentoId)\r\n\r\n    form.itens = (data?.itens || []).map((it) => ({\r\n      nome_ambiente: it.nome_ambiente,\r\n      descricao: it.descricao,\r\n      observacao: '',\r\n      quantidade: 1,\r\n      valor_unitario: Number(it.valor_unitario || 0),\r\n    }))\r\n\r\n    const soma = round2((form.itens || []).reduce((acc, it) => acc + totalItem(it), 0))\r\n    form.valor_vendido = round2(soma)\r\n\r\n    if (form.pagamentos.length === 1 && num(form.pagamentos[0].valor) === 0 && form.valor_vendido > 0) {\r\n      form.pagamentos[0].valor = round2(form.valor_vendido)\r\n    }\r\n  } catch (e) {\r\n    console.error(e)\r\n    notify.error('Erro ao carregar orçamento')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nasync function carregarVenda() {\r\n  if (!isEdit.value) return\r\n  loading.value = true\r\n  try {\r\n    const { data } = await VendaService.buscar(vendaId.value)\r\n\r\n    clienteFiltroId.value = data?.cliente_id ? String(data.cliente_id) : ''\r\n    await carregarOrcamentosOptions(clienteFiltroId.value)\r\n\r\n    form.orcamento_id = data?.orcamento_id ?? ''\r\n    form.data_venda = data?.data_venda ? String(data.data_venda).slice(0, 10) : form.data_venda\r\n    form.valor_vendido = round2(num(data?.valor_vendido || 0))\r\n\r\n    form.taxa_pagamento_percentual_aplicado = round2(num(data?.taxa_pagamento_percentual_aplicado || 0))\r\n    form.taxa_nota_fiscal_percentual_aplicado = round2(num(data?.taxa_nota_fiscal_percentual_aplicado || 0))\r\n    form.tem_nota_fiscal = num(form.taxa_nota_fiscal_percentual_aplicado) > 0\r\n\r\n    form.itens = (data?.itens || []).map((it) => ({\r\n      id: it.id,\r\n      nome_ambiente: it.nome_ambiente,\r\n      descricao: it.descricao,\r\n      observacao: it.observacao || '',\r\n      quantidade: Number(it.quantidade || 1),\r\n      valor_unitario: Number(it.valor_unitario || 0),\r\n    }))\r\n\r\n    form.pagamentos = (data?.pagamentos || []).map((p) => ({\r\n      id: p.id,\r\n      forma_pagamento_chave: p.forma_pagamento_chave || '',\r\n      valor: round2(num(p.valor || 0)),\r\n      parcelas: 1,\r\n      data_prevista_recebimento: p.data_prevista_recebimento ? String(p.data_prevista_recebimento).slice(0, 10) : '',\r\n      data_recebimento: p.data_recebimento ? String(p.data_recebimento).slice(0, 10) : '',\r\n      status_financeiro_chave: p.status_financeiro_chave || 'EM_ABERTO',\r\n    }))\r\n\r\n    if (!form.pagamentos.length) {\r\n      form.pagamentos = [{\r\n        forma_pagamento_chave: '',\r\n        valor: round2(form.valor_vendido),\r\n        parcelas: 1,\r\n        data_prevista_recebimento: '',\r\n        data_recebimento: '',\r\n        status_financeiro_chave: 'EM_ABERTO',\r\n      }]\r\n    }\r\n\r\n    form.comissoes = (data?.comissoes || []).map((c) => ({\r\n      id: c.id,\r\n      tipo_comissao_chave: c.tipo_comissao_chave || 'VENDEDOR',\r\n      responsavel_nome: c.responsavel_nome || '',\r\n    }))\r\n  } catch (e) {\r\n    console.error(e)\r\n    notify.error('Erro ao carregar venda')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// =======================\r\n// ITENS (EDIT): endpoint PUT item\r\n// =======================\r\nasync function iniciarEdicaoItem(row) {\r\n  if (!isEdit.value || !row?.id) return\r\n  if (!can('vendas.editar')) return notify.error('Acesso negado.')\r\n\r\n  try {\r\n    await VendaService.atualizarItem(vendaId.value, row.id, {\r\n      nome_ambiente: row.nome_ambiente,\r\n      descricao: row.descricao,\r\n      observacao: row.observacao || '',\r\n      quantidade: Number(row.quantidade || 1),\r\n      valor_unitario: round2(num(row.valor_unitario || 0)),\r\n    })\r\n    await carregarVenda()\r\n  } catch (e) {\r\n    console.error(e)\r\n    notify.error('Erro ao salvar item')\r\n  }\r\n}\r\n\r\n// =======================\r\n// PAYLOAD\r\n// =======================\r\nfunction montarPayload() {\r\n  return {\r\n    orcamento_id: Number(form.orcamento_id),\r\n    status: pipelineKey('VENDA_FECHADA'),\r\n    data_venda: form.data_venda ? String(form.data_venda) : undefined,\r\n    valor_vendido: round2(num(form.valor_vendido || 0)),\r\n\r\n    taxa_pagamento_percentual_aplicado: round2(num(form.taxa_pagamento_percentual_aplicado || 0)),\r\n    tem_nota_fiscal: Boolean(form.tem_nota_fiscal),\r\n    taxa_nota_fiscal_percentual_aplicado: round2(num(form.taxa_nota_fiscal_percentual_aplicado || 0)),\r\n\r\n    pagamentos: (form.pagamentos || []).map((p) => ({\r\n      forma_pagamento_chave: String(p.forma_pagamento_chave || ''),\r\n      valor: round2(num(p.valor || 0)),\r\n      data_prevista_recebimento: p.data_prevista_recebimento || null,\r\n      data_recebimento: p.data_recebimento || null,\r\n      status_financeiro_chave: p.status_financeiro_chave || 'EM_ABERTO',\r\n    })),\r\n\r\n    comissoes: (form.comissoes || []).map((c) => ({\r\n      tipo_comissao_chave: String(c.tipo_comissao_chave || ''),\r\n      percentual_aplicado: round2(pctComissao(c.tipo_comissao_chave)),\r\n      responsavel_nome: c.responsavel_nome || null,\r\n    })),\r\n  }\r\n}\r\n\r\n// =======================\r\n// ACTIONS\r\n// =======================\r\nasync function salvar() {\r\n  const perm = permSalvarVenda()\r\n  if (!can(perm)) return notify.error('Acesso negado.')\r\n  if (saving.value) return\r\n\r\n  saving.value = true\r\n  try {\r\n    const payload = montarPayload()\r\n\r\n    if (isEdit.value) {\r\n      await VendaService.salvar(vendaId.value, payload)\r\n      notify.success('Salvo!')\r\n      router.push('/vendas')\r\n      return\r\n    }\r\n\r\n    await VendaService.salvar(null, payload)\r\n    notify.success('Criado!')\r\n    router.push('/vendas')\r\n  } catch (e) {\r\n    console.error(e)\r\n    notify.error('Erro ao salvar venda')\r\n  } finally {\r\n    saving.value = false\r\n  }\r\n}\r\n\r\nasync function enviarParaProducao() {\r\n  if (!isEdit.value) return\r\n  if (!can('vendas.editar')) return notify.error('Acesso negado.')\r\n\r\n  try {\r\n    await ProducaoService.encaminhar({\r\n      origem_tipo: 'VENDA_CLIENTE',\r\n      origem_id: vendaId.value,\r\n      status: pipelineKey('EM_PRODUCAO'),\r\n    })\r\n    notify.success('Enviado para produção!')\r\n    await carregarVenda()\r\n  } catch (e) {\r\n    console.error(e)\r\n    notify.error('Erro ao enviar para produção')\r\n  }\r\n}\r\n\r\n// =======================\r\n// WATCHERS\r\n// =======================\r\nwatch(\r\n  () => clienteFiltroId.value,\r\n  async (val) => {\r\n    if (isEdit.value) return\r\n    form.orcamento_id = ''\r\n    orcamentosOptions.value = []\r\n    form.itens = []\r\n    if (!val) return\r\n\r\n    try {\r\n      await carregarOrcamentosOptions(val)\r\n    } catch (e) {\r\n      console.error(e)\r\n      notify.error('Erro ao carregar orçamentos')\r\n    }\r\n  },\r\n)\r\n\r\nwatch(\r\n  () => form.orcamento_id,\r\n  async (val) => {\r\n    if (!val) return\r\n    if (isEdit.value) return\r\n    await carregarOrcamentoNaVenda(val)\r\n  },\r\n)\r\n\r\nwatch(\r\n  () => form.valor_vendido,\r\n  (v) => {\r\n    if (form.pagamentos.length === 1 && num(form.pagamentos[0].valor) === 0 && num(v) > 0) {\r\n      form.pagamentos[0].valor = round2(num(v))\r\n    }\r\n  },\r\n)\r\n\r\n// =======================\r\n// INIT\r\n// =======================\r\nonMounted(async () => {\r\n  // ✅ bloqueio base: ver\r\n  if (!can('vendas.ver')) {\r\n    notify.error('Acesso negado.')\r\n    router.push('/vendas')\r\n    return\r\n  }\r\n\r\n  // ✅ se for edição, precisa poder editar\r\n  if (isEdit.value && !can('vendas.editar')) {\r\n    notify.error('Acesso negado.')\r\n    router.push('/vendas')\r\n    return\r\n  }\r\n\r\n  // ✅ se for novo, precisa poder criar\r\n  if (!isEdit.value && !can('vendas.criar')) {\r\n    notify.error('Acesso negado.')\r\n    router.push('/vendas')\r\n    return\r\n  }\r\n\r\n  loading.value = true\r\n  try {\r\n    await carregarClientesOptions()\r\n    if (isEdit.value) await carregarVenda()\r\n  } catch (e) {\r\n    console.error(e)\r\n    notify.error('Erro ao inicializar')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n})\r\n</script>\r\n\r\n\r\n"],"names":["TAXAS_CARTAO","TAXA_NOTA_FISCAL","COMISSOES","route","useRoute","router","useRouter","arquivosOpen","ref","vendaId","computed","n","isEdit","permSalvarVenda","loading","saving","clientesOptions","orcamentosOptions","clienteFiltroId","FORMAS_PAGAMENTO_OPTIONS","FORMAS_PAGAMENTO","x","COMISSOES_OPTIONS","key","v","num","round2","totalItem","row","q","u","pctComissao","tipo","_a","taxaPctPorForma","forma","parcelas","f","p","_c","_b","pipelineKey","k","PIPELINE_CLIENTE","form","reactive","rowsItens","it","idx","rowsPagamentos","rowsComissoes","c","modalItemOpen","modalItemEditando","itemEditIdx","itemDraft","resetItemDraft","abrirModalNovoItem","can","notify","fecharModalItem","editarItemLocal","base","salvarItemDoModal","payload","removerItem","confirmarSalvarVenda","perm","confirm","salvar","confirmarEnviarParaProducao","enviarParaProducao","confirmarRemoverItemVenda","confirmarRemoverPagamento","removerPagamento","confirmarRemoverComissao","removerComissao","columnsItens","columnsPagamentos","columnsComissoes","addPagamento","somaPagamentos","acc","diferencaRateio","pagamentosBatendo","addComissao","valor_bruto","valorComissao","pct","valor_comissoes","valor_taxa_pagamento","taxa_pagamento_percentual_calc","watch","valor_taxa_nf","total_taxas","lucro_bruto","carregarClientesOptions","data","ClienteService","rows","carregarOrcamentosOptions","clienteId","OrcamentosService","o","carregarOrcamentoNaVenda","orcamentoId","soma","carregarVenda","VendaService","e","iniciarEdicaoItem","montarPayload","ProducaoService","val","onMounted","_createVNode","_component_Card","_component_PageHeader","_createElementVNode","_hoisted_1","_createBlock","_component_Loading","_openBlock","_createElementBlock","_hoisted_2","_hoisted_3","_cache","_hoisted_4","_hoisted_5","_component_SearchInput","$event","_hoisted_6","_hoisted_7","_hoisted_8","_component_Input","_hoisted_9","_hoisted_10","_hoisted_11","_unref","_component_Button","_hoisted_12","_component_Table","_withCtx","_hoisted_13","_toDisplayString","_hoisted_14","_hoisted_15","_hoisted_16","format","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_component_CustomCheckbox","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_component_ArquivosModal"],"mappings":"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"}