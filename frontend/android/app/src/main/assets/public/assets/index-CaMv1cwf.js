import{y as z,f as x,g as k,i as D,r as E,c as h,o as m,b as l,k as P,E as U,d as _,w as N,v as V,u as b,m as c,A as u,l as w,t as n,e as $,p as A,G as F,C as S,s as p,q as G}from"./index-CH22lQIC.js";const J={class:"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in"},q={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-2"},W={class:"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto"},Z={class:"relative w-full sm:w-56"},H={class:"grid grid-cols-2 lg:grid-cols-3 gap-3"},K={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},Q={class:"text-xl font-black text-slate-800"},X={class:"p-4 rounded-xl bg-white border border-emerald-200 shadow-sm"},Y={class:"text-xl font-black text-emerald-700"},ee={class:"p-4 rounded-xl bg-white border border-blue-200 shadow-sm"},te={class:"text-xl font-black text-blue-700"},se={class:"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm"},le={class:"flex items-center gap-3 py-1"},ae={class:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-black text-slate-400 text-xs"},oe={class:"flex flex-col min-w-0"},ne={class:"text-sm font-bold text-slate-800 truncate"},re={class:"text-[10px] font-medium text-slate-500 truncate"},ie={class:"flex flex-col"},de={class:"text-sm font-medium text-slate-700"},ce={class:"text-[10px] font-bold text-slate-400 uppercase"},ue={class:"flex justify-end gap-1"},pe=["onClick"],xe=["onClick"],me={class:"flex flex-col sm:flex-row items-center justify-between gap-2 p-4 border-t border-slate-200 text-[11px]"},be={class:"text-slate-500 font-medium"},fe={class:"flex items-center gap-3"},ge={class:"flex items-center gap-1.5 cursor-pointer"},we={__name:"index",setup(ve){const C=z(),d=x(""),f=x(!1),y=x(!1),r=x([]),g=k(()=>{let a=r.value;if(d.value){const e=d.value.toLowerCase().trim();a=a.filter(t=>t.nome_completo&&t.nome_completo.toLowerCase().includes(e)||t.razao_social&&t.razao_social.toLowerCase().includes(e)||t.cpf&&t.cpf.includes(e)||t.cnpj&&t.cnpj.includes(e)||t.email&&t.email.toLowerCase().includes(e)||t.whatsapp&&t.whatsapp.includes(e)||t.cidade&&t.cidade.toLowerCase().includes(e)||t.estado&&t.estado.toLowerCase().includes(e))}return a}),T=k(()=>new Set(r.value.map(a=>a.cidade).filter(Boolean)).size),L=a=>a?String(a).replaceAll("_"," "):"SEM OBRA",j=a=>{if(!a)return"bg-slate-100 text-slate-500 border border-slate-200";const e=String(a);return e.includes("MEDIDA")?"bg-indigo-50 text-indigo-600 border border-indigo-100":e.includes("ORCAMENTO")?"bg-amber-50 text-amber-700 border border-amber-100":e.includes("PRODUCAO")?"bg-blue-50 text-blue-700 border border-blue-100":e.includes("MONTAGEM")?"bg-emerald-50 text-emerald-700 border border-emerald-100":e.includes("ENCERR")?"bg-slate-200 text-slate-700 border border-slate-300":"bg-slate-100 text-slate-600 border border-slate-200"},O=a=>{if(!a)return"bg-slate-400";const e=String(a);return e.includes("MEDIDA")?"bg-indigo-500":e.includes("ORCAMENTO")?"bg-amber-500":e.includes("PRODUCAO")?"bg-blue-500":e.includes("MONTAGEM")?"bg-emerald-500":e.includes("ENCERR")?"bg-slate-600":"bg-slate-400"},I=a=>{if(!c("clientes.editar"))return p.error("Acesso negado.");C.push(`/clientes/${a}`)};async function M(a){var o,s;if(!c("clientes.excluir"))return p.error("Acesso negado.");if(!await G.show("Excluir Cliente?","Esta ação não pode ser desfeita."))return;const t=Number(a);try{await S.remover(t),r.value=r.value.filter(i=>Number(i.id)!==t),p.success("Cliente removido com sucesso")}catch(i){console.error("Erro ao excluir cliente:",i);const v=(s=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:s.message;p.error(Array.isArray(v)?v.join(" | "):v||"Não foi possível excluir o cliente")}}const R=()=>{const a=g.value.map(s=>({ID:s.id,"Nome/Razão Social":s.nome_completo||s.razao_social,"CPF/CNPJ":s.cpf||s.cnpj,Status:(s.pipeline_status||"SEM_OBRA").replaceAll("_"," "),Cidade:s.cidade,Estado:s.estado,"E-mail":s.email,WhatsApp:s.whatsapp,Telefone:s.telefone})),e=[Object.keys(a[0]||{}).join(","),...a.map(s=>Object.values(s).join(","))].join(`
`),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.download=`clientes_${new Date().toISOString().split("T")[0]}.csv`,o.click()},B=[{key:"cliente",label:"CLIENTE",width:"40%"},{key:"status",label:"STATUS",width:"15%"},{key:"localizacao",label:"LOCALIZAÇÃO",width:"25%"},{key:"acoes",label:"",align:"right",width:"20%"}];return D(async()=>{var a,e;f.value=!0;try{console.log("[CLIENTES] chamando listar...");const t=await S.listar();console.log("[CLIENTES] response:",t);const o=Array.isArray(t)?t:Array.isArray(t==null?void 0:t.data)?t.data:[];console.log("[CLIENTES] data length:",o.length),console.log("[CLIENTES] first:",o[0]),r.value=o}catch(t){console.error("[CLIENTES] erro:",t),console.error("[CLIENTES] status:",(a=t==null?void 0:t.response)==null?void 0:a.status),console.error("[CLIENTES] body:",(e=t==null?void 0:t.response)==null?void 0:e.data),p.error("Falha ao carregar clientes."),r.value=[]}finally{f.value=!1}}),(a,e)=>{const t=E("Button"),o=E("Table");return m(),h("div",J,[l("div",q,[e[5]||(e[5]=P('<div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center"><i class="pi pi-id-card text-lg"></i></div><div><h1 class="text-lg font-black text-slate-800 uppercase tracking-tight">Clientes</h1><p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Base estratégica de contatos</p></div></div>',1)),l("div",W,[l("div",Z,[e[3]||(e[3]=l("i",{class:"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"},null,-1)),N(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),type:"text",placeholder:"Buscar por nome, CPF ou CNPJ...",class:"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all"},null,512),[[V,d.value]])]),b(c)("clientes.criar")?(m(),U(t,{key:0,variant:"primary",size:"md",class:"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider",onClick:e[1]||(e[1]=s=>b(C).push("/clientes/novo"))},{default:u(()=>[...e[4]||(e[4]=[l("i",{class:"pi pi-plus mr-1.5 text-[10px]"},null,-1),w(" Novo ",-1)])]),_:1})):_("",!0)])]),l("div",H,[l("div",K,[e[6]||(e[6]=l("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400"},"Total",-1)),l("p",Q,n(r.value.length),1)]),l("div",X,[e[7]||(e[7]=l("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-emerald-600"},"Ativos",-1)),l("p",Y,n(a.totalAtivos),1)]),l("div",ee,[e[8]||(e[8]=l("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-blue-600"},"Cidades",-1)),l("p",te,n(T.value),1)])]),l("div",se,[$(o,{columns:B,rows:g.value,loading:f.value,"empty-text":d.value?"Nenhum cliente encontrado para sua busca":"Nenhum cliente cadastrado",boxed:!1},{"cell-cliente":u(({row:s})=>[l("div",le,[l("div",ae,n((s.nome_completo||s.razao_social||"?").substring(0,2).toUpperCase()),1),l("div",oe,[l("span",ne,n(s.nome_completo||s.razao_social),1),l("span",re,n(s.cpf||s.cnpj||"Sem documento"),1)])])]),"cell-status":u(({row:s})=>[l("span",{class:A(["px-2 py-1 rounded text-[9px] font-black uppercase inline-flex items-center gap-1",j(s.pipeline_status)])},[l("span",{class:A(["w-1.5 h-1.5 rounded-full",O(s.pipeline_status)])},null,2),w(" "+n(L(s.pipeline_status)),1)],2)]),"cell-localizacao":u(({row:s})=>[l("div",ie,[l("span",de,n(s.cidade||"—"),1),l("span",ce,n(s.estado||"—"),1)])]),"cell-acoes":u(({row:s})=>[l("div",ue,[b(c)("clientes.editar")?(m(),h("button",{key:0,onClick:i=>I(s.id),class:"w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-brand-primary hover:text-white transition-all flex items-center justify-center"},[...e[9]||(e[9]=[l("i",{class:"pi pi-pencil text-xs"},null,-1)])],8,pe)):_("",!0),b(c)("clientes.excluir")?(m(),h("button",{key:1,onClick:i=>M(s.id),class:"w-8 h-8 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center"},[...e[10]||(e[10]=[l("i",{class:"pi pi-trash text-xs"},null,-1)])],8,xe)):_("",!0)])]),_:1},8,["rows","loading","empty-text"]),l("div",me,[l("div",be,n(g.value.length)+" de "+n(r.value.length)+" cliente"+n(r.value.length!==1?"s":""),1),l("div",fe,[l("label",ge,[N(l("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),class:"w-3.5 h-3.5 rounded border-slate-300 text-brand-primary focus:ring-brand-primary/20"},null,512),[[F,y.value]]),e[11]||(e[11]=l("span",{class:"text-slate-600 text-[10px] font-medium"},"Mostrar inativos",-1))]),l("button",{onClick:R,class:"text-slate-600 hover:text-brand-primary text-[10px] font-medium flex items-center gap-1"},[...e[12]||(e[12]=[l("i",{class:"pi pi-download text-[10px]"},null,-1),w(" Exportar ",-1)])])])])])])}}};export{we as default};
//# sourceMappingURL=index-CaMv1cwf.js.map
