{"version":3,"file":"_id_-Bxq9GWmd.js","sources":["../../src/pages/compras/[id].vue"],"sourcesContent":["<template>\r\n  <Card class=\"mt-4 mb-8 mx-2 lg:mx-4 shadow-xl rounded-[2.5rem] overflow-hidden animate-page-in\">\r\n    <PageHeader\r\n      :title=\"isEdit ? `Compra #${compraId}` : 'Nova Compra'\"\r\n      subtitle=\"Registre uma nova entrada de materiais.\"\r\n      icon=\"pi pi-shopping-cart\"\r\n      :backTo=\"'/compras'\"\r\n      class=\"border-b border-border-ui\"\r\n    />\r\n\r\n    <div class=\"p-8 lg:p-12\">\r\n      <Loading v-if=\"loading\" />\r\n\r\n      <form v-else class=\"space-y-10\" @submit.prevent=\"confirmarSalvarCompra\" autocomplete=\"off\">\r\n        <!-- Identificação -->\r\n        <div class=\"grid grid-cols-12 gap-6 items-end bg-slate-50/50 dark:bg-slate-800/20 p-6 rounded-2xl\">\r\n          <div class=\"col-span-12 md:col-span-4\">\r\n            <label class=\"block text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 ml-1\">\r\n              Destino do Gasto\r\n            </label>\r\n\r\n            <div class=\"flex gap-3\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                class=\"flex-1 justify-center !h-12 !rounded-xl\"\r\n                :class=\"tipoCompra === 'INSUMOS' ? 'ring-2 ring-brand-primary bg-brand-primary/10' : ''\"\r\n                @click=\"tipoCompra = 'INSUMOS'\"\r\n              >\r\n                <span class=\"text-[10px] font-black uppercase\">Estoque</span>\r\n              </Button>\r\n\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"secondary\"\r\n                class=\"flex-1 justify-center !h-12 !rounded-xl\"\r\n                :class=\"tipoCompra === 'CLIENTE_AMBIENTE' ? 'ring-2 ring-brand-primary bg-brand-primary/10' : ''\"\r\n                @click=\"tipoCompra = 'CLIENTE_AMBIENTE'\"\r\n              >\r\n                <span class=\"text-[10px] font-black uppercase\">Venda</span>\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <SearchInput\r\n            class=\"col-span-12 md:col-span-5\"\r\n            v-model=\"fornecedorSelecionado\"\r\n            mode=\"select\"\r\n            label=\"Fornecedor *\"\r\n            :options=\"fornecedorOptions\"\r\n            required\r\n            placeholder=\"Selecione...\"\r\n          />\r\n\r\n          <Input\r\n            class=\"col-span-12 md:col-span-3\"\r\n            v-model=\"form.data_compra\"\r\n            label=\"Data da Compra *\"\r\n            type=\"date\"\r\n            required\r\n          />\r\n        </div>\r\n\r\n        <!-- Cliente x Ambiente (somente quando Venda) -->\r\n        <div v-if=\"tipoCompra === 'CLIENTE_AMBIENTE'\" class=\"space-y-6\">\r\n          <div class=\"relative\">\r\n            <div class=\"absolute inset-0 flex items-center\">\r\n              <div class=\"w-full border-t border-border-ui/50\"></div>\r\n            </div>\r\n            <div class=\"relative flex justify-center\">\r\n              <span class=\"bg-bg-page dark:bg-slate-900 px-4 text-xs font-bold uppercase tracking-wider text-slate-400\">\r\n                Cliente x Ambiente\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"grid grid-cols-12 gap-6 items-end\">\r\n            <SearchInput\r\n              class=\"col-span-12 md:col-span-6\"\r\n              v-model=\"vendaSelecionada\"\r\n              mode=\"select\"\r\n              label=\"Venda *\"\r\n              :options=\"vendaOptions\"\r\n              required\r\n              placeholder=\"Selecione...\"\r\n            />\r\n\r\n            <SearchInput\r\n              class=\"col-span-12 md:col-span-6\"\r\n              v-model=\"ambienteSelecionado\"\r\n              mode=\"select\"\r\n              label=\"Ambiente\"\r\n              :options=\"ambienteOptions\"\r\n              :required=\"!todosAmbientesMes\"\r\n              :readonly=\"todosAmbientesMes\"\r\n              placeholder=\"Selecione...\"\r\n            />\r\n\r\n            <div class=\"col-span-12\">\r\n              <CustomCheckbox\r\n                label=\"Aplicar em TODOS os ambientes do mês\"\r\n                description=\"Quando marcado, o rateio será dividido entre todos os ambientes desta venda.\"\r\n                :model-value=\"todosAmbientesMes\"\r\n                @update:model-value=\"(v) => { todosAmbientesMes = v; if (v) ambienteSelecionado = null }\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Itens -->\r\n        <div class=\"space-y-6\">\r\n          <div class=\"relative\">\r\n            <div class=\"absolute inset-0 flex items-center\">\r\n              <div class=\"w-full border-t border-border-ui/50\"></div>\r\n            </div>\r\n            <div class=\"relative flex justify-center\">\r\n              <span class=\"bg-bg-page dark:bg-slate-900 px-4 text-xs font-bold uppercase tracking-wider text-slate-400\">\r\n                Itens da Nota\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"flex items-center justify-between gap-4\">\r\n            <p class=\"text-xs font-bold uppercase tracking-wider text-slate-400\">\r\n              Adicione os itens da compra\r\n            </p>\r\n\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              type=\"button\"\r\n              class=\"text-[10px] font-black uppercase tracking-widest hover:bg-brand-primary/5 text-brand-primary\"\r\n              @click=\"abrirModalProduto\"\r\n            >\r\n              <i class=\"pi pi-plus-circle mr-2\"></i>\r\n              Produto não cadastrado?\r\n            </Button>\r\n          </div>\r\n\r\n          <div class=\"grid grid-cols-12 gap-6 items-end bg-slate-50/50 dark:bg-slate-800/20 p-6 rounded-2xl border border-border-ui\">\r\n            <SearchInput\r\n  class=\"col-span-12 md:col-span-6\"\r\n  :key=\"itemNovoKey\"\r\n  v-model=\"itemNovo.produto_id\"\r\n  mode=\"select\"\r\n  label=\"Produto\"\r\n  :options=\"produtoOptions\"\r\n  @update:modelValue=\"onSelecionarProdutoNovo\"\r\n  placeholder=\"Selecione...\"\r\n/>\r\n\r\n<Input\r\n  class=\"col-span-6 md:col-span-2\"\r\n  v-model=\"itemNovo.quantidade\"\r\n  label=\"Qtd\"\r\n  type=\"number\"\r\n  placeholder=\"0\"\r\n/>\r\n\r\n<Input\r\n  class=\"col-span-6 md:col-span-4\"\r\n  v-model=\"itemNovo.valorUnitarioMask\"\r\n  label=\"Valor Unitário\"\r\n  placeholder=\"0,00\"\r\n  @input=\"itemNovo.valorUnitarioMask = maskMoneyBR($event.target.value)\"\r\n/>\r\n\r\n\r\n            <div class=\"col-span-12\">\r\n              <Button\r\n                variant=\"primary\"\r\n                size=\"lg\"\r\n                class=\"w-full !rounded-xl\"\r\n                type=\"button\"\r\n                @click=\"registrarItemNovo\"\r\n              >\r\n                ADICIONAR ITEM\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div v-if=\"itens.length\" class=\"border border-border-ui rounded-2xl overflow-hidden\">\r\n            <Table :columns=\"columnsItens\" :rows=\"itens\" boxed>\r\n<template #cell-nome_produto=\"{ row }\">\r\n  <div class=\"py-2\">\r\n    <div class=\"font-black text-slate-700 uppercase text-xs\">\r\n      {{ row.nome_produto }}\r\n    </div>\r\n\r\n    <div v-if=\"descDoItem(row)\" class=\"mt-1 text-[10px] font-bold uppercase tracking-wider text-slate-400\">\r\n      {{ descDoItem(row) }}\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n              <template #cell-valor_unitario=\"{ value }\">\r\n                <span class=\"text-xs font-bold text-slate-500\">\r\n                  R$ {{ Number(value).toLocaleString('pt-br', { minimumFractionDigits: 2 }) }}\r\n                </span>\r\n              </template>\r\n\r\n              <template #cell-valor_total=\"{ value }\">\r\n                <span class=\"text-sm font-black text-slate-800\">\r\n                  R$ {{ Number(value).toLocaleString('pt-br', { minimumFractionDigits: 2 }) }}\r\n                </span>\r\n              </template>\r\n\r\n<template #cell-acoes=\"{ row }\">\r\n  <div class=\"flex justify-end gap-2\">\r\n    <Button\r\n      variant=\"ghost\"\r\n      size=\"sm\"\r\n      type=\"button\"\r\n      @click=\"editarItemPorKey(row._key)\"\r\n    >\r\n      <i class=\"pi pi-pencil text-[12px]\"></i>\r\n    </Button>\r\n\r\n    <Button\r\n      variant=\"ghost\"\r\n      size=\"sm\"\r\n      type=\"button\"\r\n      class=\"text-red-500 hover:bg-red-50\"\r\n      @click=\"removerItem(row._key)\"\r\n    >\r\n      <i class=\"pi pi-trash text-[12px]\"></i>\r\n    </Button>\r\n  </div>\r\n</template>\r\n\r\n\r\n            </Table>\r\n\r\n            <div class=\"flex items-center justify-between p-6 bg-slate-50 dark:bg-slate-800/20 border-t border-border-ui\">\r\n              <span class=\"text-[10px] font-black uppercase tracking-widest text-slate-400\">Total da Compra</span>\r\n              <span class=\"text-lg font-black\">\r\n                R$ {{ Number(totalCalculado).toLocaleString('pt-br', { minimumFractionDigits: 2 }) }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Footer (igual Cliente: simples, sem firula) -->\r\n        <div class=\"pt-10 mt-6 border-t border-border-ui\">\r\n          <div class=\"flex items-center justify-between gap-4\">\r\n            <div></div>\r\n\r\n    \r\n<Button\r\n  v-if=\"can(isEdit ? 'compras.editar' : 'compras.criar')\"\r\n  variant=\"primary\"\r\n  size=\"lg\"\r\n  type=\"submit\"\r\n  :loading=\"salvando\"\r\n  :disabled=\"!podeSalvar\"\r\n>\r\n\r\n              <i class=\"pi pi-save mr-2 text-[12px]\"></i>\r\n              {{ isEdit ? 'ATUALIZAR COMPRA' : 'SALVAR COMPRA' }}\r\n            </Button>\r\n\r\n<Button\r\n  v-if=\"isEdit && can('compras.excluir')\"\r\n  type=\"button\"\r\n  variant=\"danger\"\r\n  size=\"lg\"\r\n  :loading=\"excluindo\"\r\n  @click=\"confirmarExcluirCompra\"\r\n>\r\n              <i class=\"pi pi-trash mr-2 text-[12px]\"></i>\r\n              EXCLUIR\r\n            </Button>\r\n\r\n            <div v-if=\"!isEdit\"></div>\r\n          </div>\r\n        </div>\r\n      </form>\r\n    </div>\r\n\r\n    <QuickCreateProduto\r\n      :open=\"modalProdutoOpen\"\r\n      :fornecedor-id=\"fornecedorSelecionado ? Number(fornecedorSelecionado) : null\"\r\n      :texto-inicial=\"''\"\r\n      @close=\"fecharModalProduto\"\r\n      @created=\"onProdutoCriado\"\r\n    />\r\n  </Card>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, watch, onMounted, computed } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { CompraService, FornecedorService, VendaService, ProdutosService } from '@/services/index'\r\nimport { notify } from '@/services/notify'\r\nimport { confirm } from '@/services/confirm'\r\nimport { maskMoneyBR } from '@/utils/masks'\r\nimport { moedaParaNumero, numeroParaMoeda } from '@/utils/number'\r\nimport { can } from '@/services/permissions'\r\n\r\ndefinePage({ meta: { perm: 'compras.ver' } })\r\n\r\n\r\n// =======================\r\n// STATE\r\n// =======================\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nconst loading = ref(false)\r\nconst salvando = ref(false)\r\nconst excluindo = ref(false)\r\n\r\nconst tipoCompra = ref('INSUMOS')\r\nconst fornecedorSelecionado = ref(null)\r\nconst vendaSelecionada = ref(null)\r\n\r\nconst form = reactive({\r\n  data_compra: new Date().toISOString().split('T')[0],\r\n})\r\n\r\nconst itens = ref([])\r\nconst itensRemoverIds = ref([])\r\n\r\nconst modalProdutoOpen = ref(false)\r\n\r\nconst listaFornecedores = ref([])\r\nconst listaVendas = ref([])\r\n\r\nconst produtoOptions = ref([])\r\nconst produtoMap = ref(new Map())\r\n\r\nconst listaAmbientes = ref([])        // [{ nome: 'COZINHA' }, ...]\r\nconst ambienteSelecionado = ref(null) // string\r\nconst todosAmbientesMes = ref(false)\r\n\r\nconst itemNovoKey = ref(0)\r\n\r\n// item novo com snapshot\r\nconst itemNovo = reactive({\r\n  produto_id: null,\r\n  nome_produto: '',\r\n  marca: null,\r\n  cor: null,\r\n  medida: null,\r\n  unidade: '',\r\n  quantidade: 1,\r\n  valorUnitarioMask: '0,00',\r\n})\r\n\r\n// =======================\r\n// COMPUTED\r\n// =======================\r\nconst isEdit = computed(() => route.params.id && route.params.id !== 'novo')\r\nconst compraId = computed(() => (isEdit.value ? Number(route.params.id) : null))\r\n\r\nconst totalCalculado = computed(() => {\r\n  const total = itens.value.reduce((acc, it) => acc + Number(it.valor_total || 0), 0)\r\n  return round2(total)\r\n})\r\n\r\nconst fornecedorOptions = computed(() => Array.isArray(listaFornecedores.value) ? listaFornecedores.value : [])\r\n\r\n\r\nconst vendaOptions = computed(() =>\r\n  (Array.isArray(listaVendas.value) ? listaVendas.value : []).map((v) => ({\r\n    value: v.id,\r\n    label: v.cliente?.nome_completo || `Venda #${v.id}`,\r\n  })),\r\n)\r\n\r\nconst ambienteOptions = computed(() =>\r\n  (Array.isArray(listaAmbientes.value) ? listaAmbientes.value : []).map((a) => ({\r\n    value: a.nome,\r\n    label: a.nome,\r\n  })),\r\n)\r\n\r\nconst podeSalvar = computed(() => {\r\n  if (!fornecedorSelecionado.value || !form.data_compra) return false\r\n\r\n  if (tipoCompra.value === 'INSUMOS') return true\r\n\r\n  if (tipoCompra.value === 'CLIENTE_AMBIENTE') {\r\n    if (!vendaSelecionada.value) return false\r\n    if (!todosAmbientesMes.value && !ambienteSelecionado.value) return false\r\n    // ✅ não exige itens\r\n    return true\r\n  }\r\n\r\n  return false\r\n})\r\n\r\n\r\n// tabela\r\nconst columnsItens = [\r\n  { key: 'nome_produto', label: 'Produto' },\r\n  { key: 'quantidade', label: 'Qtd', align: 'center' },\r\n  { key: 'valor_unitario', label: 'V. Unit.' },\r\n  { key: 'valor_total', label: 'Subtotal' },\r\n  { key: 'acoes', label: '', width: '120px', align: 'right' },\r\n]\r\n\r\n// =======================\r\n// HELPERS\r\n// =======================\r\nfunction round2(n) {\r\n  return Math.round((Number(n) + Number.EPSILON) * 100) / 100\r\n}\r\n\r\nfunction resetarItemNovo() {\r\n  Object.assign(itemNovo, {\r\n    produto_id: null,\r\n    nome_produto: '',\r\n    marca: null,\r\n    cor: null,\r\n    medida: null,\r\n    unidade: '',\r\n    quantidade: 1,\r\n    valorUnitarioMask: '0,00',\r\n  })\r\n  itemNovoKey.value++\r\n}\r\n\r\nfunction montarRateiosClienteAmbiente(total) {\r\n  const tot = round2(Number(total || 0))\r\n\r\n  // 1 ambiente: sempre 1 linha (mesmo com total 0)\r\n  if (!todosAmbientesMes.value) {\r\n    return [\r\n      { nome_ambiente: String(ambienteSelecionado.value || '').trim(), valor_alocado: tot }\r\n    ]\r\n  }\r\n\r\n  // todos: se ainda não carregou ambientes, não deixa vazio\r\n  const nomes = (listaAmbientes.value || [])\r\n    .map((a) => String(a?.nome || '').trim())\r\n    .filter(Boolean)\r\n\r\n  const unicos = Array.from(new Set(nomes))\r\n\r\n  // ✅ fallback: se não tem lista ainda, usa o ambienteSelecionado se existir\r\n  if (!unicos.length) {\r\n    const fallback = String(ambienteSelecionado.value || '').trim()\r\n    if (fallback) return [{ nome_ambiente: fallback, valor_alocado: tot }]\r\n    return [{ nome_ambiente: 'GERAL', valor_alocado: tot }] // último fallback pra não ir vazio\r\n  }\r\n\r\n  // se total = 0, pode mandar tudo 0 sem dividir\r\n  if (tot === 0) {\r\n    return unicos.map((nome) => ({ nome_ambiente: nome, valor_alocado: 0 }))\r\n  }\r\n\r\n  // total > 0: divide igualmente e ajusta último\r\n  const base = round2(Math.floor((tot / unicos.length) * 100) / 100)\r\n  let soma = 0\r\n\r\n  return unicos.map((nome, idx) => {\r\n    const valor = idx === unicos.length - 1 ? round2(tot - soma) : base\r\n    soma = round2(soma + valor)\r\n    return { nome_ambiente: nome, valor_alocado: valor }\r\n  })\r\n}\r\n\r\n// =======================\r\n// PRODUTOS\r\n// =======================\r\nconst onSelecionarProdutoNovo = (id) => {\r\n  const cleanId = Number(id)\r\n  const p = produtoMap.value.get(cleanId)\r\n  if (!p) return\r\n\r\n  itemNovo.produto_id = cleanId\r\n  itemNovo.nome_produto = p.nome_produto\r\n  itemNovo.marca = p.marca ?? null\r\n  itemNovo.cor = p.cor ?? null\r\n  itemNovo.medida = p.medida ?? null\r\n  itemNovo.unidade = p.unidade || ''\r\n  itemNovo.valorUnitarioMask = numeroParaMoeda(Number(p.valor_unitario || 0))\r\n}\r\n\r\nconst registrarItemNovo = () => {\r\n  if (!itemNovo.produto_id) {\r\n    notify.warn('Selecione um produto.')\r\n    return\r\n  }\r\nif (!itemNovo.unidade) {\r\n  notify.warn('Produto sem unidade. Defina a unidade no cadastro do produto.')\r\n  return\r\n}\r\n\r\n\r\n  const qtd = Number(itemNovo.quantidade || 0)\r\n  if (qtd <= 0) {\r\n    notify.warn('Informe a quantidade.')\r\n    return\r\n  }\r\n\r\n  const vUnit = moedaParaNumero(itemNovo.valorUnitarioMask)\r\n  if (vUnit <= 0) {\r\n    notify.warn('Informe o valor unitário.')\r\n    return\r\n  }\r\n\r\n  const valorTotal = round2(vUnit * qtd)\r\n\r\n  itens.value.push({\r\n    _key: Date.now() + Math.random(),\r\n    produto_id: Number(itemNovo.produto_id),\r\n    nome_produto: itemNovo.nome_produto,\r\n    marca: itemNovo.marca,\r\n    cor: itemNovo.cor,\r\n    medida: itemNovo.medida,\r\n    unidade: itemNovo.unidade,\r\n    quantidade: qtd,\r\n    valor_unitario: vUnit,\r\n    valor_total: valorTotal,\r\n    id: null,\r\n  })\r\n\r\n  resetarItemNovo()\r\n  notify.success('Item adicionado!')\r\n}\r\n\r\nconst removerItem = async (key) => {\r\n  const item = itens.value.find((it) => it._key === key)\r\n  if (!item) return\r\n\r\n  const ok = await confirm.show('Remover Item', 'Tem certeza que deseja remover este item?')\r\n  if (!ok) return\r\n\r\n  if (isEdit.value && item.id) itensRemoverIds.value.push(item.id)\r\n  itens.value = itens.value.filter((it) => it._key !== key)\r\n\r\n  notify.info('Item removido.')\r\n}\r\n\r\nconst editarItemPorKey = async (key) => {\r\n  // sem UX extra: edição simples reaproveitando o form de \"Item Novo\"\r\n  const item = itens.value.find((it) => it._key === key)\r\n  if (!item) return\r\n\r\n  itemNovo.produto_id = item.produto_id\r\n  itemNovo.nome_produto = item.nome_produto\r\n  itemNovo.marca = item.marca ?? null\r\n  itemNovo.cor = item.cor ?? null\r\n  itemNovo.medida = item.medida ?? null\r\n  itemNovo.unidade = item.unidade || ''\r\n  itemNovo.quantidade = Number(item.quantidade || 1)\r\n  itemNovo.valorUnitarioMask = numeroParaMoeda(Number(item.valor_unitario || 0))\r\n\r\n  // remove da lista e deixa o usuário adicionar de novo\r\n  if (isEdit.value && item.id) itensRemoverIds.value.push(item.id)\r\n  itens.value = itens.value.filter((it) => it._key !== key)\r\n\r\n  notify.info('Item carregado para edição.')\r\n}\r\n\r\n// =======================\r\n// AMBIENTES (VENDA)\r\n// =======================\r\nconst carregarAmbientesDaVenda = async () => {\r\n  if (!vendaSelecionada.value) {\r\n    listaAmbientes.value = []\r\n    ambienteSelecionado.value = null\r\n    return\r\n  }\r\n\r\n  try {\r\n    const res = await VendaService.listarAmbientes(Number(vendaSelecionada.value))\r\n    const data = res?.data ?? res\r\n    listaAmbientes.value = Array.isArray(data) ? data : []\r\n  } catch (e) {\r\n    console.log('[COMPRA] erro ao carregar ambientes:', e?.response?.data || e)\r\n    listaAmbientes.value = []\r\n    notify.error('Erro ao carregar ambientes da venda.')\r\n  }\r\n}\r\n\r\n// =======================\r\n// SAVE / DELETE\r\n// =======================\r\nconst validarFormulario = () => {\r\n  if (!fornecedorSelecionado.value) {\r\n    notify.error('Selecione um fornecedor.')\r\n    return false\r\n  }\r\n  if (!form.data_compra) {\r\n    notify.error('Informe a data da compra.')\r\n    return false\r\n  }\r\n\r\n  if (tipoCompra.value === 'CLIENTE_AMBIENTE') {\r\n    if (!vendaSelecionada.value) {\r\n      notify.error('Selecione a venda.')\r\n      return false\r\n    }\r\n    if (!todosAmbientesMes.value && !ambienteSelecionado.value) {\r\n      notify.error('Selecione o ambiente (ou marque todos).')\r\n      return false\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\n\r\nconst confirmarSalvarCompra = async () => {\r\n  const perm = isEdit.value ? 'compras.editar' : 'compras.criar'\r\n  if (!can(perm)) return notify.error('Acesso negado.')\r\n\r\n\r\n  if (!validarFormulario()) return\r\n\r\n  const ok = await confirm.show(\r\n    isEdit.value ? 'Atualizar Compra' : 'Salvar Compra',\r\n    isEdit.value ? `Deseja atualizar a Compra #${compraId.value}?` : 'Deseja confirmar e salvar esta compra?',\r\n  )\r\n  if (!ok) return\r\n\r\n  await salvarCompra()\r\n}\r\n\r\nconst salvarCompra = async () => {\r\n  const perm = isEdit.value ? 'compras.editar' : 'compras.criar'\r\n  if (!can(perm)) return notify.error('Acesso negado.')\r\n  \r\n  salvando.value = true\r\n  try {\r\n    const total = round2(Number(totalCalculado.value || 0))\r\n\r\n    const payload = {\r\n      tipo_compra: tipoCompra.value,\r\n      fornecedor_id: Number(fornecedorSelecionado.value),\r\n      venda_id: tipoCompra.value === 'CLIENTE_AMBIENTE' ? Number(vendaSelecionada.value) : null,\r\n      data_compra: form.data_compra,\r\n      valor_total: total,\r\n      itens: itens.value.map((it) => ({\r\n        ...(it.id ? { id: Number(it.id) } : {}),\r\n        produto_id: Number(it.produto_id),\r\n        quantidade: Number(it.quantidade),\r\n        unidade: it.unidade,\r\n        valor_unitario: Number(it.valor_unitario),\r\n        valor_total: Number(it.valor_total),\r\n      })),\r\n      ...(isEdit.value && itensRemoverIds.value.length\r\n        ? { itens_remover_ids: itensRemoverIds.value.map(Number) }\r\n        : {}),\r\n    }\r\n\r\nif (tipoCompra.value === 'CLIENTE_AMBIENTE') {\r\n  payload.rateios = montarRateiosClienteAmbiente(total)\r\n}\r\n\r\n\r\n    await CompraService.salvar(compraId.value, payload)\r\n    notify.success(isEdit.value ? 'Compra atualizada!' : 'Compra criada!')\r\n    router.push('/compras')\r\n  } catch (e) {\r\n    console.log('[COMPRA] erro salvar:', e?.response?.status, e?.response?.data, e)\r\n    notify.error(e?.response?.data?.message || 'Erro ao salvar compra.')\r\n  } finally {\r\n    salvando.value = false\r\n  }\r\n}\r\n\r\nconst confirmarExcluirCompra = async () => {\r\n  if (!can('compras.excluir')) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show(\r\n    'Excluir Compra',\r\n    `Deseja realmente excluir a Compra #${compraId.value}?`,\r\n  )\r\n  if (!ok) return\r\n\r\n  excluindo.value = true\r\n  try {\r\n    await CompraService.remover(compraId.value)\r\n    notify.success('Compra excluída!')\r\n    router.push('/compras')\r\n  } catch (e) {\r\n    notify.error(e?.response?.data?.message || 'Erro ao excluir compra.')\r\n  } finally {\r\n    excluindo.value = false\r\n  }\r\n}\r\n\r\n// =======================\r\n// LOADERS\r\n// =======================\r\nconst carregarProdutos = async () => {\r\n  if (!fornecedorSelecionado.value) {\r\n    produtoOptions.value = []\r\n    produtoMap.value = new Map()\r\n    return\r\n  }\r\n\r\n  try {\r\n    const res = await ProdutosService.listar({ fornecedor_id: Number(fornecedorSelecionado.value) })\r\n    const data = res?.data ?? res\r\n    const arr = Array.isArray(data) ? data : []\r\n\r\nprodutoOptions.value = arr.map((p) => ({\r\n  value: p.id,\r\n  label: `${p.nome_produto}${p.marca ? ` • ${p.marca}` : ''}${p.cor ? ` • ${p.cor}` : ''}${p.medida ? ` • ${p.medida}` : ''}`,\r\n}))\r\n\r\n\r\n    const map = new Map()\r\n    arr.forEach((p) => {\r\n      map.set(Number(p.id), {\r\n        id: p.id,\r\n        nome_produto: p.nome_produto,\r\n        marca: p.marca ?? null,\r\n        cor: p.cor ?? null,\r\n        medida: p.medida ?? null,\r\n        unidade: p.unidade ?? '',\r\n        valor_unitario: Number(p.valor_unitario || 0),\r\n      })\r\n    })\r\n    produtoMap.value = map\r\n  } catch (e) {\r\n    console.log('[COMPRA] erro carregarProdutos:', e?.response?.data || e)\r\n    produtoOptions.value = []\r\n    produtoMap.value = new Map()\r\n    notify.error('Erro ao carregar produtos do fornecedor.')\r\n  }\r\n}\r\n\r\nconst carregarCompra = async () => {\r\n  const res = await CompraService.buscar(compraId.value)\r\n  const compra = res?.data ?? res\r\n  if (!compra) throw new Error('Compra não encontrada')\r\n\r\n  tipoCompra.value = compra.tipo_compra || 'INSUMOS'\r\n  fornecedorSelecionado.value = compra.fornecedor_id ?? null\r\n  vendaSelecionada.value = compra.venda_id ?? null\r\n  form.data_compra = compra.data_compra?.split('T')[0] || form.data_compra\r\n\r\n  itens.value = (compra.itens || []).map((it) => ({\r\n    ...it,\r\n    _key: it.id ? `db-${it.id}` : Date.now() + Math.random(),\r\n    valor_unitario: Number(it.valor_unitario || 0),\r\n    valor_total: Number(it.valor_total || 0),\r\n  }))\r\n\r\n  itensRemoverIds.value = []\r\n\r\n  // ambientes: se for venda, carrega lista e tenta setar selecionado pela regra:\r\n  if (tipoCompra.value === 'CLIENTE_AMBIENTE' && vendaSelecionada.value) {\r\n    await carregarAmbientesDaVenda()\r\n    // se a compra tiver rateios, tenta escolher o 1o\r\n    if (Array.isArray(compra.rateios) && compra.rateios.length === 1) {\r\n      todosAmbientesMes.value = false\r\n      ambienteSelecionado.value = compra.rateios[0]?.nome_ambiente || null\r\n    } else if (Array.isArray(compra.rateios) && compra.rateios.length > 1) {\r\n      todosAmbientesMes.value = true\r\n      ambienteSelecionado.value = null\r\n    }\r\n  }\r\n}\r\n\r\nfunction descDoItem(row) {\r\n  const partes = [\r\n    row?.marca,\r\n    row?.cor,\r\n    row?.medida,\r\n    row?.unidade,\r\n  ]\r\n    .map((v) => String(v || '').trim())\r\n    .filter(Boolean)\r\n\r\n  return partes.join(' • ')\r\n}\r\n\r\n\r\nconst carregarDadosIniciais = async () => {\r\n  loading.value = true\r\n  try {\r\nconst [fornRes, vendRes] = await Promise.all([\r\n  FornecedorService.select(),\r\n  VendaService.listar(),\r\n])\r\n\r\nlistaFornecedores.value = Array.isArray(fornRes?.data) ? fornRes.data : []\r\nlistaVendas.value = Array.isArray(vendRes?.data) ? vendRes.data : []\r\n\r\nif (isEdit.value) {\r\n  await carregarCompra()\r\n}\r\n\r\n  } catch (e) {\r\n    console.log('[COMPRA] erro carregarDadosIniciais:', e)\r\n    notify.error('Erro ao carregar dados.')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// =======================\r\n// MODAL PRODUTO\r\n// =======================\r\nfunction abrirModalProduto() {\r\n  if (!fornecedorSelecionado.value) {\r\n    notify.warn('Selecione um fornecedor primeiro.')\r\n    return\r\n  }\r\n  modalProdutoOpen.value = true\r\n}\r\n\r\nfunction fecharModalProduto() {\r\n  modalProdutoOpen.value = false\r\n}\r\n\r\nasync function onProdutoCriado(payload) {\r\n  await carregarProdutos()\r\n\r\n  const produto = payload?.data ?? payload\r\n  const id = Number(produto?.id)\r\n  if (id) {\r\n    itemNovo.produto_id = id\r\n    onSelecionarProdutoNovo(id)\r\n  }\r\n\r\n  modalProdutoOpen.value = false\r\n}\r\n\r\n// =======================\r\n// WATCHERS\r\n// =======================\r\nwatch(tipoCompra, (t) => {\r\n  if (t !== 'CLIENTE_AMBIENTE') {\r\n    vendaSelecionada.value = null\r\n    listaAmbientes.value = []\r\n    ambienteSelecionado.value = null\r\n    todosAmbientesMes.value = false\r\n  }\r\n})\r\n\r\nwatch(vendaSelecionada, async () => {\r\n  todosAmbientesMes.value = false\r\n  ambienteSelecionado.value = null\r\n  await carregarAmbientesDaVenda()\r\n})\r\n\r\nwatch(fornecedorSelecionado, async (id) => {\r\n  if (!id) {\r\n    produtoOptions.value = []\r\n    produtoMap.value = new Map()\r\n    resetarItemNovo()\r\n    return\r\n  }\r\n  resetarItemNovo()\r\n  await carregarProdutos()\r\n})\r\n\r\n// =======================\r\n// INIT\r\n// =======================\r\nonMounted(async () => {\r\n  const perm = isEdit.value ? 'compras.editar' : 'compras.criar'\r\n  if (!can(perm)) {\r\n    notify.error('Acesso negado.')\r\n    router.push('/compras')\r\n    return\r\n  }\r\n  await carregarDadosIniciais()\r\n})\r\n\r\n</script>\r\n\r\n"],"names":["route","useRoute","router","useRouter","loading","ref","salvando","excluindo","tipoCompra","fornecedorSelecionado","vendaSelecionada","form","reactive","itens","itensRemoverIds","modalProdutoOpen","listaFornecedores","listaVendas","produtoOptions","produtoMap","listaAmbientes","ambienteSelecionado","todosAmbientesMes","itemNovoKey","itemNovo","isEdit","computed","compraId","totalCalculado","total","acc","it","round2","fornecedorOptions","vendaOptions","v","_a","ambienteOptions","podeSalvar","columnsItens","n","resetarItemNovo","montarRateiosClienteAmbiente","tot","nomes","a","unicos","fallback","nome","base","soma","idx","valor","onSelecionarProdutoNovo","id","cleanId","p","numeroParaMoeda","registrarItemNovo","notify","qtd","vUnit","moedaParaNumero","valorTotal","removerItem","key","item","confirm","editarItemPorKey","carregarAmbientesDaVenda","res","VendaService","data","validarFormulario","confirmarSalvarCompra","perm","can","salvarCompra","payload","CompraService","e","_b","_d","_c","confirmarExcluirCompra","carregarProdutos","ProdutosService","arr","map","carregarCompra","compra","descDoItem","row","carregarDadosIniciais","fornRes","vendRes","FornecedorService","abrirModalProduto","fecharModalProduto","onProdutoCriado","produto","watch","t","onMounted","_createBlock","_component_Card","_createVNode","_component_PageHeader","_createElementVNode","_hoisted_1","_component_Loading","_createElementBlock","_hoisted_2","_hoisted_3","_cache","_hoisted_4","_component_Button","_normalizeClass","_component_SearchInput","$event","_component_Input","_openBlock","_hoisted_5","_hoisted_6","_hoisted_7","_component_CustomCheckbox","_hoisted_8","_hoisted_9","_hoisted_10","_unref","maskMoneyBR","_hoisted_11","_hoisted_12","_component_Table","_withCtx","_hoisted_13","_hoisted_14","_toDisplayString","_hoisted_15","value","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_createTextVNode","_hoisted_23","_component_QuickCreateProduto"],"mappings":"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"}