import{y as S,f as h,g as I,i as B,r as k,c as d,o as i,b as e,k as V,E as j,d as p,w as D,v as $,u as c,m as n,A as m,l as F,t as r,P as y,e as M,F as R,n as P,a6 as U,s as f}from"./index-CH22lQIC.js";const z={class:"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in"},G={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-2"},q={class:"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto"},H={class:"relative w-full sm:w-64"},J={class:"grid grid-cols-2 lg:grid-cols-4 gap-3"},K={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},Q={class:"text-xl font-black text-slate-800"},W={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},X={class:"text-xl font-black text-blue-600"},Y={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},Z={class:"text-lg font-black text-emerald-600 truncate"},ee={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},te={class:"flex items-center gap-2"},se={class:"text-xl font-black text-amber-600"},oe={class:"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm"},ae={class:"flex flex-col py-1"},le={class:"text-sm font-bold text-slate-800 uppercase tracking-tight"},ne={class:"text-[10px] font-bold text-slate-400 tracking-wider"},re={class:"flex flex-wrap gap-1 justify-end"},ie=["onClick"],ce={key:1,class:"text-[10px] font-black uppercase tracking-widest text-slate-300"},de={class:"flex flex-col items-end"},ue={class:"text-sm font-black text-slate-800 tabular-nums"},pe={class:"flex justify-end gap-1.5 px-2"},me=["onClick"],xe=["onClick"],ge={__name:"index",setup(fe){const x=S(),b=h(!1),g=h(""),u=h([]),C=[{key:"cliente",label:"CLIENTE / CONTATO",width:"40%"},{key:"orcamentos",label:"PROJETOS",width:"25%",align:"right"},{key:"total",label:"TOTAL",width:"20%",align:"right"},{key:"acoes",label:"",width:"15%",align:"right"}];async function N(){b.value=!0;try{const{data:a}=await U.get("/orcamentos");u.value=a||[]}catch(a){console.error(a)}finally{b.value=!1}}const v=I(()=>{const a=(g.value||"").trim().toLowerCase(),t=new Map;for(const l of u.value||[]){const s=l.cliente_id||l.clienteId;if(s){if(!t.has(s)){const o=l.cliente||{},w=o.nome_completo||o.razao_social||o.nome_fantasia||l.cliente_nome_snapshot||"CLIENTE S/N",L=o.whatsapp||o.telefone||o.contato||o.celular||"";t.set(s,{cliente_id:s,cliente_nome:w,cliente_telefone:L,orcamentos:[]})}t.get(s).orcamentos.push(l)}}return Array.from(t.values()).map(l=>({...l,total:l.orcamentos.reduce((s,o)=>s+(Number(o.total_itens)||0),0)})).filter(l=>String(l.cliente_nome).toLowerCase().includes(a)||String(l.cliente_telefone).toLowerCase().includes(a))});function T(){if(!n("orcamentos.criar"))return f.error("Acesso negado.");x.push("/orcamentos/novo")}function E(a){if(!n("orcamentos.criar"))return f.error("Acesso negado.");x.push({path:"/orcamentos/novo",query:{cliente_id:String(a)}})}function O(a){if(!n("orcamentos.ver"))return f.error("Acesso negado.");x.push(`/orcamentos/cliente/${a}`)}function A(a){if(!n("orcamentos.editar"))return f.error("Acesso negado.");x.push(`/orcamentos/${a}`)}return B(N),(a,t)=>{const _=k("Button"),l=k("Table");return i(),d("div",z,[e("div",G,[t[3]||(t[3]=V('<div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center shadow-sm"><i class="pi pi-briefcase text-lg"></i></div><div><h1 class="text-lg font-black text-slate-800 uppercase tracking-tight">Orçamentos</h1><p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Controle de propostas comerciais</p></div></div>',1)),e("div",q,[e("div",H,[t[1]||(t[1]=e("i",{class:"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"},null,-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),type:"text",placeholder:"BUSCAR CLIENTE OU TELEFONE...",class:"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all uppercase"},null,512),[[$,g.value]])]),c(n)("orcamentos.criar")?(i(),j(_,{key:0,variant:"primary",size:"md",class:"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider w-full sm:w-auto shadow-sm",onClick:T},{default:m(()=>[...t[2]||(t[2]=[e("i",{class:"pi pi-plus mr-1.5 text-[10px]"},null,-1),F(" Novo Orçamento ",-1)])]),_:1})):p("",!0)])]),e("div",J,[e("div",K,[t[4]||(t[4]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1"},"Total Geral",-1)),e("p",Q,r(u.value.length),1)]),e("div",W,[t[5]||(t[5]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1"},"Carteira Ativa",-1)),e("p",X,r(v.value.length),1)]),e("div",Y,[t[6]||(t[6]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1"},"Volume Negociado",-1)),e("p",Z,r(c(y).currency(u.value.reduce((s,o)=>s+(Number(o.total_itens)||0),0))),1)]),e("div",ee,[t[8]||(t[8]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1"},"Recentes",-1)),e("div",te,[e("p",se,r(u.value.slice(0,5).length),1),t[7]||(t[7]=e("span",{class:"w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse"},null,-1))])])]),e("div",oe,[M(l,{columns:C,rows:v.value,loading:b.value,"empty-text":"Nenhum orçamento encontrado.",boxed:!1},{"cell-cliente":m(({row:s})=>[e("div",ae,[e("span",le,r(s.cliente_nome||"CLIENTE NÃO IDENTIFICADO"),1),e("span",ne,r(s.cliente_telefone||"SEM CONTATO"),1)])]),"cell-orcamentos":m(({row:s})=>[e("div",re,[c(n)("orcamentos.editar")?(i(!0),d(R,{key:0},P(s.orcamentos,o=>(i(),d("button",{key:o.id,class:"h-6 px-2 rounded bg-slate-50 border border-slate-200 text-[9px] font-black text-slate-500 hover:bg-slate-900 hover:text-white transition-all uppercase",onClick:w=>A(o.id)}," #"+r(o.id),9,ie))),128)):p("",!0),c(n)("orcamentos.editar")?p("",!0):(i(),d("span",ce," — "))])]),"cell-total":m(({row:s})=>[e("div",de,[e("span",ue,r(c(y).currency(s.total||0)),1),t[9]||(t[9]=e("span",{class:"text-[9px] font-bold text-slate-400 uppercase tracking-tighter"},"Acumulado",-1))])]),"cell-acoes":m(({row:s})=>[e("div",pe,[c(n)("orcamentos.criar")?(i(),d("button",{key:0,onClick:o=>E(s.cliente_id),class:"w-7 h-7 rounded-lg bg-emerald-50 text-emerald-600 hover:bg-emerald-600 hover:text-white transition-all border border-emerald-100 flex items-center justify-center",title:"Novo Orçamento"},[...t[10]||(t[10]=[e("i",{class:"pi pi-plus text-[10px]"},null,-1)])],8,me)):p("",!0),c(n)("orcamentos.ver")?(i(),d("button",{key:1,onClick:o=>O(s.cliente_id),class:"w-7 h-7 rounded-lg bg-slate-100 text-slate-500 hover:bg-slate-900 hover:text-white transition-all border border-slate-200 flex items-center justify-center",title:"Histórico"},[...t[11]||(t[11]=[e("i",{class:"pi pi-list text-[10px]"},null,-1)])],8,xe)):p("",!0)])]),_:1},8,["rows","loading"])])])}}};export{ge as default};
//# sourceMappingURL=index-B9Uk3E7A.js.map
