{"version":3,"file":"index-BFCCuOpA.js","sources":["../../src/pages/vendas/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in\">\r\n    \r\n    <div class=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-2\">\r\n      <div class=\"flex items-center gap-3\">\r\n        <div class=\"w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center\">\r\n          <i class=\"pi pi-dollar text-lg\"></i>\r\n        </div>\r\n        <div>\r\n          <h1 class=\"text-lg font-black text-slate-800 uppercase tracking-tight\">Vendas</h1>\r\n          <p class=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider\">Gestão comercial e pós-venda</p>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto\">\r\n        <div class=\"relative w-full sm:w-64\">\r\n          <i class=\"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs\"></i>\r\n          <input \r\n            v-model=\"filtro\" \r\n            type=\"text\" \r\n            placeholder=\"BUSCAR CLIENTE, STATUS OU ID...\"\r\n            class=\"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all uppercase\"\r\n          />\r\n        </div>\r\n        \r\n        <Button \r\n        v-if=\"can('vendas.criar')\"\r\n          variant=\"primary\" \r\n          size=\"md\"\r\n          class=\"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider w-full sm:w-auto\"\r\n          @click=\"router.push('/vendas/novo')\"\r\n        >\r\n          <i class=\"pi pi-plus mr-1.5 text-[10px]\"></i>\r\n          Nova Venda\r\n        </Button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"grid grid-cols-2 lg:grid-cols-4 gap-3\">\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Total de Vendas</p>\r\n        <p class=\"text-xl font-black text-slate-800\">{{ vendas.length }}</p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Faturamento Total</p>\r\n        <p class=\"text-xl font-black text-emerald-600\">\r\n          {{ format.currency(vendas.reduce((acc, v) => acc + Number(v.valor_vendido || 0), 0)) }}\r\n        </p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Ticket Médio</p>\r\n        <p class=\"text-xl font-black text-blue-600\">\r\n{{ format.currency(\r\n  vendas.length\r\n    ? (vendas.reduce((acc, v) => acc + Number(v.valor_vendido || 0), 0) / vendas.length)\r\n    : 0\r\n) }}\r\n\r\n        </p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Em Produção</p>\r\n        <div class=\"flex items-center gap-2\">\r\n          <p class=\"text-xl font-black text-amber-600\">\r\n            {{ vendas.filter(v => String(v.status).toUpperCase().includes('PRODU')).length }}\r\n          </p>\r\n          <span class=\"w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm\">\r\n      <Table \r\n        :columns=\"columns\" \r\n        :rows=\"filtradas\" \r\n        :loading=\"loading\" \r\n        :boxed=\"false\"\r\n      >\r\n        <template #cell-cliente=\"{ row }\">\r\n          <div class=\"flex flex-col py-1\">\r\n            <span class=\"text-sm font-bold text-slate-800 uppercase tracking-tight leading-tight\">\r\n              {{ row.cliente?.nome_completo || row.cliente?.razao_social || row.cliente?.nome || 'Consumidor' }}\r\n            </span>\r\n            <span class=\"text-[10px] font-bold text-slate-400 tracking-wider uppercase\">\r\n              {{ row.cliente?.cpf || row.cliente?.cnpj || 'Sem documento' }}\r\n            </span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-status=\"{ row }\">\r\n          <span \r\n            class=\"px-2 py-1 rounded text-[9px] font-black uppercase inline-flex items-center gap-1.5\"\r\n            :class=\"pillClassTailwind(row.status)\"\r\n          >\r\n            <span class=\"w-1.5 h-1.5 rounded-full bg-current\"></span>\r\n            {{ row.status }}\r\n          </span>\r\n        </template>\r\n\r\n        <template #cell-valor_total=\"{ row }\">\r\n          <div class=\"flex flex-col items-end\">\r\n            <span class=\"text-sm font-black text-slate-800 tabular-nums\">\r\n              {{ format.currency(row.valor_total) }}\r\n            </span>\r\n            <span class=\"text-[9px] font-bold text-slate-400 uppercase tracking-tighter\">Valor Final</span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-data_venda=\"{ row }\">\r\n          <div class=\"flex flex-col\">\r\n            <span class=\"text-xs font-bold text-slate-700\">\r\n              {{ format.date(row.data_venda) }}\r\n            </span>\r\n            <span class=\"text-[9px] font-bold text-slate-400 uppercase\">Data Venda</span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-acoes=\"{ row }\">\r\n          <div class=\"flex justify-end gap-1.5 px-2\">\r\n            <button \r\n            v-if=\"can('vendas.editar')\"\r\n              @click=\"router.push(`/vendas/${row.id}`)\" \r\n              class=\"w-7 h-7 rounded-lg bg-slate-100 text-slate-500 hover:bg-slate-900 hover:text-white transition-all border border-slate-200 flex items-center justify-center\"\r\n            >\r\n              <i class=\"pi pi-pencil text-[10px]\"></i>\r\n            </button>\r\n            <button \r\n            v-if=\"can('vendas.excluir')\"\r\n              @click=\"confirmarExcluirVenda(row.id)\" \r\n              class=\"w-7 h-7 rounded-lg bg-rose-50 text-rose-500 hover:bg-rose-500 hover:text-white transition-all border border-rose-100 flex items-center justify-center\"\r\n            >\r\n              <i class=\"pi pi-trash text-[10px]\"></i>\r\n            </button>\r\n          </div>\r\n        </template>\r\n      </Table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { confirm } from '@/services/confirm'\r\nimport { notify } from '@/services/notify'\r\nimport { can } from '@/services/permissions'\r\nimport api from '@/services/api'\r\nimport { format } from '@/utils/format'\r\n\r\ndefinePage({ meta: { perm: 'vendas.ver' } })\r\n\r\nconst router = useRouter()\r\nconst loading = ref(false)\r\nconst deletandoId = ref(null)\r\nconst vendas = ref([])\r\nconst filtro = ref('')\r\n\r\nconst columns = [\r\n  { key: 'id', label: 'ID', width: '80px' },\r\n  { key: 'cliente', label: 'CLIENTE', width: '35%' },\r\n  { key: 'status', label: 'SITUAÇÃO', width: '15%', align: 'center' },\r\n  { key: 'forma_pagamento_chave', label: 'PAGAMENTO', width: '15%' },\r\n  { key: 'data_venda', label: 'DATA', width: '15%' },\r\n  { key: 'valor_total', label: 'TOTAL', align: 'right', width: '15%' },\r\n  { key: 'acoes', label: '', width: '120px', align: 'right' },\r\n]\r\n\r\nconst filtradas = computed(() => {\r\n  const f = String(filtro.value || '').toLowerCase().trim()\r\n  if (!f) return vendas.value\r\n\r\n  return vendas.value.filter((v) => {\r\n    const cli = v?.cliente || {}\r\n    const cliente = String(cli.nome_completo || cli.razao_social || cli.nome || '').toLowerCase()\r\n    const status = String(v?.status || '').toLowerCase()\r\n    const pag = String(v?.forma_pagamento_chave || '').toLowerCase()\r\n    const id = String(v?.id || '').toLowerCase()\r\n\r\n    return cliente.includes(f) || status.includes(f) || pag.includes(f) || id.includes(f)\r\n  })\r\n})\r\n\r\nfunction pillClassTailwind(status) {\r\n  const s = String(status || '').toUpperCase()\r\n  if (s.includes('FECH')) return 'bg-emerald-50 text-emerald-600 border border-emerald-100'\r\n  if (s.includes('CANCEL')) return 'bg-rose-50 text-rose-500 border border-rose-100'\r\n  if (s.includes('PRODU')) return 'bg-sky-50 text-sky-600 border border-sky-100'\r\n  return 'bg-slate-50 text-slate-500 border border-slate-200'\r\n}\r\n\r\nasync function carregar() {\r\n  if (!can('vendas.ver')) return notify.error('Acesso negado.')\r\n  loading.value = true\r\n  try {\r\n    const { data } = await api.get('/vendas')\r\n    vendas.value = Array.isArray(data) ? data : []\r\n  } catch (e) {\r\n    notify.error('Erro ao carregar vendas.')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nfunction novaVenda() {\r\n  if (!can('vendas.criar')) return notify.error('Acesso negado.')\r\n  router.push('/vendas/novo')\r\n}\r\n\r\nfunction editarVenda(id) {\r\n  if (!can('vendas.editar')) return notify.error('Acesso negado.')\r\n  router.push(`/vendas/${id}`)\r\n}\r\n\r\nasync function confirmarExcluirVenda(id) {\r\n  if (!can('vendas.excluir')) return notify.error('Acesso negado.')\r\n\r\n  const ok = await confirm.show(\r\n    'Excluir Venda',\r\n    `Deseja excluir a Venda #${id}? Esta ação não pode ser desfeita.`,\r\n  )\r\n  if (!ok) return\r\n  await excluir(id)\r\n}\r\n\r\nasync function excluir(id) {\r\n  if (!can('vendas.excluir')) return notify.error('Acesso negado.')\r\n  deletandoId.value = id\r\n  try {\r\n    await api.delete(`/vendas/${id}`)\r\n    await carregar()\r\n    notify.success('Venda removida.')\r\n  } catch (e) {\r\n    notify.error('Erro ao excluir.')\r\n  } finally {\r\n    deletandoId.value = null\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  if (!can('vendas.ver')) {\r\n    notify.error('Acesso negado.')\r\n    router.push('/')\r\n    return\r\n  }\r\n  await carregar()\r\n})\r\n</script>\r\n"],"names":["router","useRouter","loading","ref","deletandoId","vendas","filtro","columns","filtradas","computed","f","v","cli","cliente","status","pag","id","pillClassTailwind","s","carregar","can","notify","data","api","confirmarExcluirVenda","confirm","excluir","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","$event","_unref","_createBlock","_component_Button","_cache","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","format","acc","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_createVNode","_component_Table","_withCtx","row","_hoisted_16","_hoisted_17","_a","_b","_c","_hoisted_18","_d","_e","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23"],"mappings":"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"}