import{y as xe,x as _e,g as p,f as v,ac as ge,R as A,j as ke,i as ye,S as we,ad as C,r as O,c as V,o as m,e as i,E as U,A as f,b as a,t as k,u as x,F as he,d as E,m as d,l as D,H as Q,T as Ne,a9 as Ve,s as _,q as G,ae as Ce}from"./index-CH22lQIC.js";const H=[{key:"EM_ABERTO",label:"Em aberto",fase:"ABERTURA",ordem:1,temTela:!0},{key:"EM_PRODUCAO",label:"Em produção",fase:"PRODUCAO",ordem:2,temTela:!1},{key:"FINALIZADO",label:"Finalizado",fase:"PRODUCAO",ordem:3,temTela:!1},{key:"COMPENSADO",label:"Compensado",fase:"FINANCEIRO",ordem:4,temTela:!1}],Ee={class:"w-full max-w-[1400px] mx-auto space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-700"},Pe={class:"flex flex-col md:flex-row items-center justify-between gap-6 p-10 border-b border-slate-100 bg-slate-50/50"},Ie={class:"flex items-center gap-6"},Ae={class:"text-2xl font-black tracking-tighter text-slate-800 uppercase italic leading-none"},Oe={class:"p-10"},Ue={class:"grid grid-cols-12 gap-8 mb-12"},Te={class:"col-span-12 md:col-span-6"},Me={class:"col-span-12 md:col-span-3"},De={class:"col-span-12 md:col-span-3"},Re={class:"bg-slate-50 rounded-[2.5rem] p-8 border border-slate-100 shadow-inner mb-10"},Se={class:"flex items-center justify-between mb-8"},qe={class:"grid grid-cols-12 gap-6 items-end"},je={class:"col-span-12 md:col-span-5"},$e={class:"col-span-6 md:col-span-2"},Be={class:"col-span-6 md:col-span-2"},Fe={class:"col-span-12 md:col-span-3"},ze={class:"flex items-center gap-3"},Le={class:"flex-1 px-4 h-14 rounded-2xl bg-white border border-slate-200 flex flex-col justify-center"},Xe={class:"text-sm font-black text-emerald-600"},Qe={class:"flex flex-col"},Ge={class:"font-black text-slate-700 uppercase italic tracking-tighter"},He={class:"text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-0.5"},Ke={class:"font-bold text-slate-500 text-xs"},Ze={class:"font-black text-slate-800"},Je={class:"flex justify-end"},We=["onClick"],Ye={class:"flex justify-end mt-12"},ea={class:"relative group"},aa={class:"relative flex flex-col items-end p-8 rounded-[2rem] bg-white border border-slate-100 shadow-xl min-w-[300px]"},ta={class:"text-4xl font-black text-slate-900 tracking-tighter mt-2 italic"},oa={key:1,class:"py-40 flex flex-col items-center justify-center gap-6"},la={class:"flex items-center justify-between p-10 border-t border-slate-100 bg-slate-50/50"},sa={key:1},na={class:"flex items-center gap-6"},ra={class:"w-full max-w-2xl max-h-[85vh] bg-white rounded-[2rem] shadow-2xl overflow-hidden flex flex-col"},ia={class:"flex items-center justify-between px-6 py-5 border-b border-slate-100 bg-slate-50/50"},da={class:"p-6 overflow-y-auto"},ua={class:"col-span-12"},ca={class:"col-span-12 md:col-span-6"},ma={class:"col-span-12 md:col-span-6"},pa={class:"col-span-12 md:col-span-6"},va={class:"col-span-12 md:col-span-6"},fa={class:"col-span-12 flex items-center justify-end gap-4 pt-6 border-t border-slate-100 mt-2"},_a={__name:"[id]",setup(ba){const R=xe(),K=_e(),B=p(()=>String(K.params.id||"novo")),u=p(()=>B.value!=="novo"),h=p(()=>u.value?Number(String(B.value).replace(/\D/g,"")):null),b=()=>u.value?"plano_corte.editar":"plano_corte.criar",S=v(!0),P=v(!1),q=v(!1),Z=p(()=>(H||[]).map(t=>({label:t.label,value:t.key}))),J=p(()=>(ge||[]).map(t=>({label:t.label,value:t.key}))),I=v(""),N=v(""),F=v([]),y=v(null),W=p(()=>F.value.map(t=>({label:t.razao_social,value:t.id}))),T=v([]),w=v([]),r=v({item_id:null,unidade:"",quantidade:"",valorUnitarioMask:"R$ 0,00"}),Y=p(()=>{const t=Number(r.value.quantidade)||0,e=Number(String(r.value.valorUnitarioMask).replace(/\D/g,""))/100||0;return t*e}),ee=p(()=>A(Y.value)),ae=p(()=>T.value.map(t=>({label:`${t.nome_produto} ${t.cor?`(${t.cor})`:""}`,value:t.id}))),te=p(()=>!!r.value.item_id&&Number(r.value.quantidade)>0),oe=p(()=>w.value.reduce((t,e)=>t+(e.valor_total||0),0)),le=[{key:"produto",label:"Insumo Selecionado"},{key:"quantidade",label:"Qtd",width:"100px",align:"center"},{key:"valor_unitario",label:"Custo Unit.",width:"140px"},{key:"valor_total",label:"Total Item",width:"140px"},{key:"acoes",label:"",width:"60px",align:"right"}];ke(()=>r.value.valorUnitarioMask,t=>{const e=String(t||"").replace(/\D/g,"");r.value.valorUnitarioMask=A(e?Number(e)/100:0)});const s=v({aberto:!1,salvando:!1,form:{fornecedor_id:null,nome_produto:"",marca:"",cor:"",medida:"",unidade:"UN",status:"ATIVO"}});function se(){if(!d(b()))return _.error("Acesso negado.");y.value&&(s.value.form.fornecedor_id=Number(y.value),s.value.aberto=!0)}function M(){s.value.aberto=!1,s.value.form={fornecedor_id:null,nome_produto:"",marca:"",cor:"",medida:"",unidade:"UN",status:"ATIVO"}}async function j(t){const{data:e}=await C.itens.listar(Number(t));T.value=e||[]}async function ne(){var t,e,l,n;if(!d(b()))return _.error("Acesso negado.");if((t=s.value.form.nome_produto)!=null&&t.trim()&&s.value.form.fornecedor_id){s.value.salvando=!0;try{const c={fornecedor_id:s.value.form.fornecedor_id,nome_produto:s.value.form.nome_produto.trim(),marca:((e=s.value.form.marca)==null?void 0:e.trim())||null,cor:((l=s.value.form.cor)==null?void 0:l.trim())||null,medida:((n=s.value.form.medida)==null?void 0:n.trim())||null,unidade:s.value.form.unidade||null,status:s.value.form.status,quantidade:0,valor_unitario:0,valor_total:0},{data:g}=await C.itens.salvar(null,c);await j(y.value),r.value.item_id=g.id,r.value.unidade=g.unidade||"",M()}finally{s.value.salvando=!1}}}async function re(){if(!d("plano_corte.excluir"))return _.error("Acesso negado.");if(!(!u.value||!await G.show("Excluir Plano de Corte",`Deseja excluir permanentemente o Plano de Corte #${h.value}? Esta ação não pode ser desfeita.`))){P.value=!0;try{await C.excluir(h.value),R.push("/plano-corte")}finally{P.value=!1}}}async function ie(){var t,e;if(!d("plano_corte.enviar_producao"))return _.error("Acesso negado.");if(u.value){q.value=!0;try{await Ce.encaminhar({origem_tipo:"PLANO_CORTE",origem_id:h.value});const{data:l}=await C.buscar(h.value);N.value=l.status??"",_.success("Enviado para produção.")}catch(l){_.error(((e=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:e.message)||"Erro ao enviar para produção.")}finally{q.value=!1}}}async function de(t){y.value=t,t&&await j(t),w.value=[],z()}function ue(t){var l;const e=(l=H.find(n=>n.key===t))==null?void 0:l.key;if(!e)throw new Error(`PIPELINE_PLANO_CORTE key não encontrada: ${t}`);return e}function ce(t){const e=Number(t),l=T.value.find(n=>Number(n.id)===e);r.value.unidade=(l==null?void 0:l.unidade)||""}function z(){r.value={item_id:null,unidade:"",quantidade:"",valorUnitarioMask:"R$ 0,00"}}async function me(t){var c,g;if(!d(b()))return _.error("Acesso negado.");const e=(c=w.value)==null?void 0:c[t],l=((g=e==null?void 0:e.item)==null?void 0:g.nome_produto)||"ITEM";await G.show("Remover Item",`Deseja remover "${l}" deste plano?`)&&pe(t)}function pe(t){if(!d(b()))return _.error("Acesso negado.");w.value.splice(t,1)}function ve(){if(!d(b()))return _.error("Acesso negado.");const t=Number(r.value.item_id),e=T.value.find(g=>Number(g.id)===t);if(!e)return;const l=Number(r.value.quantidade)||0,n=Number(String(r.value.valorUnitarioMask).replace(/\D/g,""))/100||0,c=Number((l*n).toFixed(2));w.value.push({item_id:e.id,item:{nome_produto:e.nome_produto,cor:e.cor,marca:e.marca},quantidade:l,valor_unitario:n,valor_total:c,status:"ATIVO"}),z()}async function fe(){const t=b();if(!d(t))return _.error("Acesso negado.");P.value=!0;try{const e={fornecedor_id:Number(y.value),data_venda:I.value,produtos:w.value,...u.value?{}:{status:N.value}};await C.salvar(u.value?h.value:null,e),R.push("/plano-corte")}finally{P.value=!1}}return ye(async()=>{var t;S.value=!0;try{const{data:e}=await we.listar();if(F.value=e||[],u.value){const{data:l}=await C.buscar(h.value);y.value=l.fornecedor_id??null,N.value=l.status??"",I.value=((t=l.data_venda)==null?void 0:t.slice(0,10))||"",w.value=(l.produtos||[]).map(n=>({...n,quantidade:Number(n.quantidade)||0,valor_unitario:Number(n.valor_unitario)||0,valor_total:Number(n.valor_total)||0})),l.fornecedor_id&&await j(l.fornecedor_id)}else I.value=new Date().toISOString().slice(0,10),N.value=ue("EM_ABERTO")}catch{}finally{S.value=!1}}),(t,e)=>{const l=O("SearchInput"),n=O("Input"),c=O("Button"),g=O("Table"),be=O("Card");return m(),V("div",Ee,[i(be,{shadow:!0,class:"overflow-visible !rounded-[3rem] border-none shadow-[0_40px_80px_-15px_rgba(0,0,0,0.2)]"},{default:f(()=>[a("header",Pe,[a("div",Ie,[e[18]||(e[18]=a("div",{class:"w-16 h-16 rounded-[1.5rem] bg-slate-900 flex items-center justify-center text-white shadow-2xl shadow-slate-900/20 rotate-3 hover:rotate-0 transition-transform duration-500"},[a("i",{class:"pi pi-box text-3xl"})],-1)),a("div",null,[a("h2",Ae,k(u.value?`Plano de Corte #${h.value}`:"Novo Plano de Corte"),1),e[17]||(e[17]=a("div",{class:"flex items-center gap-2 mt-2"},[a("span",{class:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),a("p",{class:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]"},"Ordem de Industrialização / Venda")],-1))])]),a("button",{onClick:e[0]||(e[0]=o=>x(R).back()),class:"flex items-center gap-3 px-6 h-12 rounded-2xl bg-white border border-slate-200 text-slate-500 hover:bg-slate-900 hover:text-white transition-all shadow-sm group"},[...e[19]||(e[19]=[a("i",{class:"pi pi-arrow-left text-[10px] group-hover:-translate-x-1 transition-transform"},null,-1),a("span",{class:"text-[10px] font-black uppercase tracking-widest"},"Painel Geral",-1)])])]),a("div",Oe,[S.value?(m(),V("div",oa,[...e[26]||(e[26]=[a("div",{class:"w-16 h-16 border-4 border-slate-100 border-t-slate-900 rounded-full animate-spin"},null,-1),a("p",{class:"text-[10px] font-black text-slate-400 uppercase tracking-[0.4em] animate-pulse"},"Sincronizando Dados...",-1)])])):(m(),V(he,{key:0},[a("section",Ue,[a("div",Te,[i(l,{modelValue:y.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>y.value=o),de],mode:"select",label:"Fornecedor Destinatário",options:W.value,required:""},null,8,["modelValue","options"])]),a("div",Me,[i(n,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=o=>I.value=o),label:"Data do Pedido",type:"date",required:""},null,8,["modelValue"])]),a("div",De,[i(l,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=o=>N.value=o),mode:"select",label:"Status da Venda",options:Z.value,readonly:u.value},null,8,["modelValue","options","readonly"])])]),a("section",Re,[a("div",Se,[e[20]||(e[20]=a("h3",{class:"text-[11px] font-black uppercase tracking-[0.25em] text-slate-500"},"Adicionar Insumos ao Plano",-1)),x(d)(b())?(m(),V("button",{key:0,type:"button",onClick:e[4]||(e[4]=o=>se()),class:"text-[10px] font-black uppercase text-emerald-600 hover:tracking-widest transition-all italic"}," + Cadastrar Novo Produto ")):E("",!0)]),a("div",qe,[a("div",je,[i(l,{modelValue:r.value.item_id,"onUpdate:modelValue":[e[5]||(e[5]=o=>r.value.item_id=o),ce],mode:"select",label:"Produto / Material",options:ae.value},null,8,["modelValue","options"])]),a("div",$e,[i(n,{modelValue:r.value.quantidade,"onUpdate:modelValue":e[6]||(e[6]=o=>r.value.quantidade=o),label:"Quantidade",placeholder:"0",type:"number"},null,8,["modelValue"])]),a("div",Be,[i(n,{modelValue:r.value.valorUnitarioMask,"onUpdate:modelValue":e[7]||(e[7]=o=>r.value.valorUnitarioMask=o),label:"Vl. Unitário (Custo)"},null,8,["modelValue"])]),a("div",Fe,[a("div",ze,[a("div",Le,[e[21]||(e[21]=a("span",{class:"text-[8px] font-black text-slate-400 uppercase tracking-widest"},"Total Item",-1)),a("span",Xe,k(ee.value),1)]),x(d)(b())?(m(),U(c,{key:0,variant:"primary",class:"!h-14 !w-14 !rounded-2xl shadow-xl shadow-slate-900/20",disabled:!te.value,onClick:e[8]||(e[8]=o=>ve())},{default:f(()=>[...e[22]||(e[22]=[a("i",{class:"pi pi-plus text-lg"},null,-1)])]),_:1},8,["disabled"])):E("",!0)])])])]),i(g,{columns:le,rows:w.value,class:"premium-table","empty-text":"Nenhum item adicionado."},{"cell-produto":f(({row:o})=>{var $,L,X;return[a("div",Qe,[a("span",Ge,k(($=o.item)==null?void 0:$.nome_produto),1),a("span",He,k(((L=o.item)==null?void 0:L.cor)||"PADRÃO")+" • "+k(((X=o.item)==null?void 0:X.marca)||"MARCA NÃO INFO."),1)])]}),"cell-valor_unitario":f(({row:o})=>[a("span",Ke,k(x(A)(o.valor_unitario||0)),1)]),"cell-valor_total":f(({row:o})=>[a("span",Ze,k(x(A)(o.valor_total||0)),1)]),"cell-acoes":f(({index:o})=>[a("div",Je,[x(d)(b())?(m(),V("button",{key:0,onClick:$=>me(o),class:"w-10 h-10 rounded-xl text-slate-300 hover:bg-rose-50 hover:text-rose-500 transition-all flex items-center justify-center"},[...e[23]||(e[23]=[a("i",{class:"pi pi-trash text-xs"},null,-1)])],8,We)):E("",!0)])]),_:1},8,["rows"]),a("div",Ye,[a("div",ea,[e[25]||(e[25]=a("div",{class:"absolute -inset-1 bg-gradient-to-r from-emerald-500 to-slate-900 rounded-[2.5rem] blur opacity-10 group-hover:opacity-20 transition duration-1000"},null,-1)),a("div",aa,[e[24]||(e[24]=a("span",{class:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]"},"Total da Industrialização",-1)),a("span",ta,k(x(A)(oe.value)),1)])])])],64))]),a("footer",la,[u.value&&x(d)("plano_corte.excluir")?(m(),U(c,{key:0,variant:"danger",onClick:re,class:"!rounded-2xl !px-8 !h-14 font-black text-[10px] uppercase tracking-widest"},{default:f(()=>[...e[27]||(e[27]=[D(" Excluir Plano ",-1)])]),_:1})):(m(),V("div",sa)),a("div",na,[u.value&&x(d)("plano_corte.enviar_producao")?(m(),U(c,{key:0,type:"button",variant:"secondary",loading:q.value,disabled:N.value==="EM_PRODUCAO",onClick:ie},{default:f(()=>[...e[28]||(e[28]=[D(" Enviar Produção ",-1)])]),_:1},8,["loading","disabled"])):E("",!0),x(d)(b())?(m(),U(c,{key:1,variant:"primary",loading:P.value,onClick:fe,class:"!rounded-[1.5rem] !px-12 !h-14 shadow-[0_20px_40px_-10px_rgba(0,0,0,0.2)] font-black text-[10px] uppercase tracking-widest bg-slate-900 hover:bg-black"},{default:f(()=>[e[29]||(e[29]=a("i",{class:"pi pi-check-circle mr-3"},null,-1)),D(" "+k(u.value?"Atualizar Plano":"Confirmar Venda"),1)]),_:1},8,["loading"])):E("",!0)])])]),_:1}),(m(),U(Ve,{to:"body"},[i(Ne,{name:"fade"},{default:f(()=>[s.value.aberto?(m(),V("div",{key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",onClick:e[16]||(e[16]=Q(o=>M(),["self"]))},[a("div",ra,[a("header",ia,[e[31]||(e[31]=a("div",{class:"flex items-center gap-4"},[a("div",{class:"w-11 h-11 rounded-[1.1rem] bg-slate-900 flex items-center justify-center text-white shadow-lg"},[a("i",{class:"pi pi-box text-lg"})]),a("div",null,[a("h3",{class:"text-lg font-black text-slate-800 tracking-tight uppercase leading-none"}," Novo Insumo "),a("div",{class:"flex items-center gap-2 mt-1"},[a("span",{class:"w-2 h-2 rounded-full bg-emerald-500"}),a("p",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"}," Cadastro rápido para este fornecedor ")])])],-1)),a("button",{class:"w-10 h-10 flex items-center justify-center rounded-xl bg-white border border-slate-100 text-slate-400 hover:text-rose-500 hover:border-rose-200 transition-all shadow-sm",onClick:e[9]||(e[9]=o=>M()),type:"button"},[...e[30]||(e[30]=[a("i",{class:"pi pi-times text-xs"},null,-1)])])]),a("div",da,[a("form",{class:"grid grid-cols-12 gap-x-6 gap-y-6",onSubmit:Q(ne,["prevent"])},[a("div",ua,[i(n,{modelValue:s.value.form.nome_produto,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.form.nome_produto=o),label:"Nome do Produto",placeholder:"EX: MDF BRANCO TX",required:""},null,8,["modelValue"])]),a("div",ca,[i(n,{modelValue:s.value.form.marca,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.form.marca=o),label:"Marca / Fabricante",placeholder:"EX: DURATEX"},null,8,["modelValue"])]),a("div",ma,[i(l,{modelValue:s.value.form.unidade,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.form.unidade=o),mode:"select",label:"Unidade Medida",options:J.value,placeholder:"SELECIONE...",required:""},null,8,["modelValue","options"])]),a("div",pa,[i(n,{modelValue:s.value.form.cor,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.form.cor=o),label:"Cor / Acabamento",placeholder:"EX: BRANCO TX"},null,8,["modelValue"])]),a("div",va,[i(n,{modelValue:s.value.form.medida,"onUpdate:modelValue":e[14]||(e[14]=o=>s.value.form.medida=o),label:"Espessura/Medida",placeholder:"EX: 18MM"},null,8,["modelValue"])]),a("div",fa,[a("button",{type:"button",onClick:e[15]||(e[15]=o=>M()),class:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 hover:text-slate-800 transition-colors"}," Cancelar "),i(c,{variant:"primary",type:"submit",loading:s.value.salvando,class:"!h-12 !rounded-[1.2rem] !px-8 shadow-xl shadow-brand-primary/20 font-black text-[10px] uppercase tracking-widest"},{default:f(()=>[...e[32]||(e[32]=[a("i",{class:"pi pi-check-circle mr-3"},null,-1),D(" Cadastrar e Usar ",-1)])]),_:1},8,["loading"])])],32)])])])):E("",!0)]),_:1})]))])}}};export{_a as default};
//# sourceMappingURL=_id_-BiFzUZ3B.js.map
