{"version":3,"file":"index-B9Uk3E7A.js","sources":["../../src/pages/orcamentos/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in\">\r\n    <div class=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-2\">\r\n      <div class=\"flex items-center gap-3\">\r\n        <div class=\"w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center shadow-sm\">\r\n          <i class=\"pi pi-briefcase text-lg\"></i>\r\n        </div>\r\n        <div>\r\n          <h1 class=\"text-lg font-black text-slate-800 uppercase tracking-tight\">Orçamentos</h1>\r\n          <p class=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider\">Controle de propostas comerciais</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto\">\r\n        <div class=\"relative w-full sm:w-64\">\r\n          <i class=\"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs\"></i>\r\n          <input\r\n            v-model=\"filtro\"\r\n            type=\"text\"\r\n            placeholder=\"BUSCAR CLIENTE OU TELEFONE...\"\r\n            class=\"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all uppercase\"\r\n          />\r\n        </div>\r\n\r\n        <Button\r\n          v-if=\"can('orcamentos.criar')\"\r\n          variant=\"primary\"\r\n          size=\"md\"\r\n          class=\"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider w-full sm:w-auto shadow-sm\"\r\n          @click=\"novoGeral\"\r\n        >\r\n          <i class=\"pi pi-plus mr-1.5 text-[10px]\"></i>\r\n          Novo Orçamento\r\n        </Button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"grid grid-cols-2 lg:grid-cols-4 gap-3\">\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Total Geral</p>\r\n        <p class=\"text-xl font-black text-slate-800\">{{ rows.length }}</p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Carteira Ativa</p>\r\n        <p class=\"text-xl font-black text-blue-600\">{{ grupos.length }}</p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Volume Negociado</p>\r\n        <p class=\"text-lg font-black text-emerald-600 truncate\">\r\n          {{ format.currency(rows.reduce((acc, o) => acc + (Number(o.total_itens) || 0), 0)) }}\r\n        </p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Recentes</p>\r\n        <div class=\"flex items-center gap-2\">\r\n          <p class=\"text-xl font-black text-amber-600\">{{ rows.slice(0, 5).length }}</p>\r\n          <span class=\"w-1.5 h-1.5 rounded-full bg-amber-400 animate-pulse\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm\">\r\n      <Table\r\n        :columns=\"columns\"\r\n        :rows=\"grupos\"\r\n        :loading=\"loading\"\r\n        empty-text=\"Nenhum orçamento encontrado.\"\r\n        :boxed=\"false\"\r\n      >\r\n        <template #cell-cliente=\"{ row }\">\r\n          <div class=\"flex flex-col py-1\">\r\n            <span class=\"text-sm font-bold text-slate-800 uppercase tracking-tight\">\r\n              {{ row.cliente_nome || 'CLIENTE NÃO IDENTIFICADO' }}\r\n            </span>\r\n            <span class=\"text-[10px] font-bold text-slate-400 tracking-wider\">\r\n              {{ row.cliente_telefone || 'SEM CONTATO' }}\r\n            </span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-orcamentos=\"{ row }\">\r\n          <div class=\"flex flex-wrap gap-1 justify-end\">\r\n            <button\r\n              v-for=\"o in row.orcamentos\"\r\n              :key=\"o.id\"\r\n              v-if=\"can('orcamentos.editar')\"\r\n              class=\"h-6 px-2 rounded bg-slate-50 border border-slate-200 text-[9px] font-black text-slate-500 hover:bg-slate-900 hover:text-white transition-all uppercase\"\r\n              @click=\"abrirOrcamento(o.id)\"\r\n            >\r\n              #{{ o.id }}\r\n            </button>\r\n\r\n            <span\r\n              v-if=\"!can('orcamentos.editar')\"\r\n              class=\"text-[10px] font-black uppercase tracking-widest text-slate-300\"\r\n            >\r\n              —\r\n            </span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-total=\"{ row }\">\r\n          <div class=\"flex flex-col items-end\">\r\n            <span class=\"text-sm font-black text-slate-800 tabular-nums\">\r\n              {{ format.currency(row.total || 0) }}\r\n            </span>\r\n            <span class=\"text-[9px] font-bold text-slate-400 uppercase tracking-tighter\">Acumulado</span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-acoes=\"{ row }\">\r\n          <div class=\"flex justify-end gap-1.5 px-2\">\r\n            <button\r\n              v-if=\"can('orcamentos.criar')\"\r\n              @click=\"novoParaCliente(row.cliente_id)\"\r\n              class=\"w-7 h-7 rounded-lg bg-emerald-50 text-emerald-600 hover:bg-emerald-600 hover:text-white transition-all border border-emerald-100 flex items-center justify-center\"\r\n              title=\"Novo Orçamento\"\r\n            >\r\n              <i class=\"pi pi-plus text-[10px]\"></i>\r\n            </button>\r\n\r\n            <button\r\n              v-if=\"can('orcamentos.ver')\"\r\n              @click=\"abrirListaDoCliente(row.cliente_id)\"\r\n              class=\"w-7 h-7 rounded-lg bg-slate-100 text-slate-500 hover:bg-slate-900 hover:text-white transition-all border border-slate-200 flex items-center justify-center\"\r\n              title=\"Histórico\"\r\n            >\r\n              <i class=\"pi pi-list text-[10px]\"></i>\r\n            </button>\r\n          </div>\r\n        </template>\r\n      </Table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, onMounted, ref } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport api from '@/services/api'\r\nimport { format } from '@/utils/format'\r\nimport { can } from '@/services/permissions'\r\nimport { notify } from '@/services/notify'\r\n\r\ndefinePage({ meta: { perm: 'orcamentos.ver' } })\r\n\r\nconst router = useRouter()\r\nconst loading = ref(false)\r\nconst filtro = ref('')\r\nconst rows = ref([])\r\n\r\nconst columns = [\r\n  { key: 'cliente', label: 'CLIENTE / CONTATO', width: '40%' },\r\n  { key: 'orcamentos', label: 'PROJETOS', width: '25%', align: 'right' },\r\n  { key: 'total', label: 'TOTAL', width: '20%', align: 'right' },\r\n  { key: 'acoes', label: '', width: '15%', align: 'right' },\r\n]\r\n\r\nasync function carregar() {\r\n  loading.value = true\r\n  try {\r\n    const { data } = await api.get('/orcamentos')\r\n    rows.value = data || []\r\n  } catch (e) {\r\n    console.error(e)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst grupos = computed(() => {\r\n  const f = (filtro.value || '').trim().toLowerCase()\r\n  const map = new Map()\r\n\r\n  for (const o of rows.value || []) {\r\n    const cid = o.cliente_id || o.clienteId\r\n    if (!cid) continue\r\n\r\n    if (!map.has(cid)) {\r\n      const cli = o.cliente || {}\r\n      const nome = cli.nome_completo || cli.razao_social || cli.nome_fantasia || o.cliente_nome_snapshot || 'CLIENTE S/N'\r\n      const tel = cli.whatsapp || cli.telefone || cli.contato || cli.celular || ''\r\n\r\n      map.set(cid, {\r\n        cliente_id: cid,\r\n        cliente_nome: nome,\r\n        cliente_telefone: tel,\r\n        orcamentos: [],\r\n      })\r\n    }\r\n    map.get(cid).orcamentos.push(o)\r\n  }\r\n\r\n  let lista = Array.from(map.values()).map(g => ({\r\n    ...g,\r\n    total: g.orcamentos.reduce((acc, o) => acc + (Number(o.total_itens) || 0), 0),\r\n  }))\r\n\r\n  return lista.filter(g =>\r\n    String(g.cliente_nome).toLowerCase().includes(f) ||\r\n    String(g.cliente_telefone).toLowerCase().includes(f)\r\n  )\r\n})\r\n\r\nfunction novoGeral() {\r\n  if (!can('orcamentos.criar')) return notify.error('Acesso negado.')\r\n  router.push('/orcamentos/novo')\r\n}\r\n\r\nfunction novoParaCliente(clienteId) {\r\n  if (!can('orcamentos.criar')) return notify.error('Acesso negado.')\r\n  router.push({ path: '/orcamentos/novo', query: { cliente_id: String(clienteId) } })\r\n}\r\n\r\nfunction abrirListaDoCliente(clienteId) {\r\n  if (!can('orcamentos.ver')) return notify.error('Acesso negado.')\r\n  router.push(`/orcamentos/cliente/${clienteId}`)\r\n}\r\n\r\nfunction abrirOrcamento(id) {\r\n  if (!can('orcamentos.editar')) return notify.error('Acesso negado.')\r\n  router.push(`/orcamentos/${id}`)\r\n}\r\n\r\nonMounted(carregar)\r\n</script>\r\n"],"names":["router","useRouter","loading","ref","filtro","rows","columns","carregar","data","api","e","grupos","computed","f","map","o","cid","cli","nome","tel","g","acc","novoGeral","can","notify","novoParaCliente","clienteId","abrirListaDoCliente","abrirOrcamento","id","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","$event","_unref","_createBlock","_component_Button","_cache","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","format","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_createVNode","_component_Table","_withCtx","row","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_Fragment","_renderList","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24"],"mappings":"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"}