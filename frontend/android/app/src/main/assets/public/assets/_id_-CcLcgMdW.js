import{_ as se,x as ne,y as ie,g as f,f as v,j as P,R as U,ac as ue,i as de,m as b,s as i,r as V,c as g,o as p,b as a,e as c,E as G,t as S,A as E,H as q,p as ce,d as A,u as O,l as me,T as ve,a9 as pe,S as fe,X as N,q as R,D as ge}from"./index-CH22lQIC.js";const xe={class:"w-full max-w-5xl mx-auto py-8 px-4 animate-in fade-in duration-500"},be={class:"flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8"},_e={class:"flex items-center gap-3 mb-2"},ye={class:"text-2xl font-semibold tracking-tight text-slate-900"},we={key:0,class:"py-24 flex flex-col items-center justify-center gap-4"},he={class:"p-8"},Ie={class:"grid grid-cols-12 gap-8"},ke={class:"col-span-12 lg:col-span-8 space-y-6"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},qe={class:"md:col-span-2"},Ae={class:"col-span-12 lg:col-span-4"},Ne={class:"flex flex-col h-full"},Ce=["src"],Te={key:1,class:"text-center p-6"},De={class:"text-[10px] text-slate-400 font-medium uppercase tracking-tighter leading-tight"},je={key:2,class:"absolute inset-0 bg-slate-900/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2"},Pe={class:"p-8 bg-slate-50/30"},Ue={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ee={class:"p-8"},Oe={class:"grid grid-cols-12 gap-6 items-end"},Re={class:"col-span-12 md:col-span-4"},Me={class:"col-span-12 md:col-span-4"},ze={class:"col-span-12 md:col-span-4"},$e={class:"p-4 bg-slate-900 rounded-xl text-white flex flex-col justify-center"},Be={class:"text-xl font-semibold tabular-nums"},Fe={class:"p-8 flex items-center justify-end gap-4 bg-slate-50/50"},Ge={class:"relative max-w-4xl w-full bg-white rounded-3xl overflow-hidden shadow-2xl"},Le={class:"p-4 flex items-center justify-center bg-white min-h-[400px]"},He=["src"],Ke={__name:"[id]",setup(Qe){const L=ne(),h=ie(),M=f(()=>String(L.params.id||"novo")),s=f(()=>M.value!=="novo"),_=f(()=>s.value?Number(String(M.value).replace(/\D/g,"")):null),I=v(!1);function H(){x.value&&(I.value=!0)}const m=v(null),z=v(!1),$=v(!1),C=v(!1),T=v(!1),B=v([]),K=f(()=>(B.value||[]).map(o=>({label:o.razao_social,value:o.id}))),Q=[{label:"ATIVO",value:"ATIVO"},{label:"INATIVO",value:"INATIVO"}],t=v({fornecedor_id:null,nome_produto:"",marca:"",cor:"",medida:"",unidade:"",quantidade:0,valor_unitario:0,valor_total:0,status:"ATIVO",imagem_url:""}),x=f(()=>{const o=String(t.value.imagem_url||"").trim();return o.length?o:""}),y=v(""),w=v("R$ 0,00"),F=f(()=>{const o=Number(t.value.quantidade||0),e=Number(t.value.valor_unitario||0);return o*e});P(F,o=>{t.value.valor_total=o});const W=f(()=>U(F.value));P(y,o=>{const e=String(o||"").replace(/\D/g,"");t.value.quantidade=e?Number(e):0,o!==e&&(y.value=e)}),P(w,o=>{const e=String(o||"").replace(/\D/g,""),n=e?Number(e)/100:0;t.value.valor_unitario=n;const r=U(n);o!==r&&(w.value=r)});const X=f(()=>ue.map(o=>({label:o.label,value:o.key})));function J(){return t.value.fornecedor_id?t.value.nome_produto?t.value.unidade?!t.value.quantidade||Number(t.value.quantidade)<=0?"Informe a quantidade.":!t.value.valor_unitario||Number(t.value.valor_unitario)<=0?"Informe o valor unitário.":t.value.status?null:"Informe o status.":"Selecione a unidade.":"Informe o nome do produto.":"Selecione o fornecedor."}function Y(){t.value={fornecedor_id:null,nome_produto:"",marca:"",cor:"",medida:"",unidade:"",quantidade:0,valor_unitario:0,valor_total:0,status:"ATIVO",imagem_url:""},y.value="",w.value="R$ 0,00"}async function Z(){const o=await fe.listar(),e=(o==null?void 0:o.data)??o;B.value=Array.isArray(e)?e:[]}async function ee(){const o=await N.buscar(_.value),e=(o==null?void 0:o.data)??o;t.value={...t.value,...e,fornecedor_id:e.fornecedor_id??null,quantidade:Number(e.quantidade||0),valor_unitario:Number(e.valor_unitario||0),valor_total:Number(e.valor_total||0),status:e.status||"ATIVO",imagem_url:e.imagem_url||""},y.value=t.value.quantidade?String(t.value.quantidade):"",w.value=U(t.value.valor_unitario||0)}async function ae(o){var n,r,u,k,l;if(!s.value){i.warn("Salve o produto primeiro para anexar imagem."),m.value&&(m.value.value="");return}if(!b("produtos.editar")){i.error("Acesso negado."),m.value&&(m.value.value="");return}const e=(r=(n=o==null?void 0:o.target)==null?void 0:n.files)==null?void 0:r[0];if(e){if(!((u=e.type)!=null&&u.startsWith("image/"))){i.error("Selecione um arquivo de imagem."),m.value&&(m.value.value="");return}z.value=!0;try{const d=await ge.upload({ownerType:"PRODUTO",ownerId:_.value,categoria:"IMAGEM",slotKey:"IMAGEM_PRINCIPAL",file:e}),D=(d==null?void 0:d.data)??d,j=D==null?void 0:D.url;if(!j){i.error("Upload ok, mas não retornou URL.");return}t.value.imagem_url=j,await N.salvar(_.value,{imagem_url:j}),i.success("Imagem atualizada!")}catch(d){i.error(((l=(k=d==null?void 0:d.response)==null?void 0:k.data)==null?void 0:l.message)||"Erro ao enviar imagem.")}finally{z.value=!1,m.value&&(m.value.value="")}}}async function te(){var e,n;if(!s.value)return;if(!b("produtos.editar"))return i.error("Acesso negado.");if(await R.show("Remover imagem","Deseja remover a imagem deste produto?")){$.value=!0;try{await N.salvar(_.value,{imagem_url:null}),t.value.imagem_url="",i.success("Imagem removida!")}catch(r){i.error(((n=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:n.message)||"Erro ao remover imagem.")}finally{$.value=!1}}}async function oe(){const o=s.value?"produtos.editar":"produtos.criar";if(!b(o))return i.error("Acesso negado.");await R.show(s.value?"Salvar Alterações":"Finalizar Cadastro",s.value?`Deseja salvar as alterações do Produto #${_.value}?`:"Deseja finalizar o cadastro deste produto?")&&await re()}async function le(){await R.show("Descartar","Deseja sair sem salvar? As alterações serão perdidas.")&&h.push("/produtos")}async function re(){var n,r;const o=s.value?"produtos.editar":"produtos.criar";if(!b(o))return i.error("Acesso negado.");const e=J();if(e)return alert(e);T.value=!0;try{const u={...t.value,fornecedor_id:Number(t.value.fornecedor_id),quantidade:Number(t.value.quantidade||0),valor_unitario:Number(t.value.valor_unitario||0),valor_total:Number(t.value.valor_total||0),unidade:t.value.unidade?String(t.value.unidade):null,marca:t.value.marca?String(t.value.marca):null,cor:t.value.cor?String(t.value.cor):null,medida:t.value.medida?String(t.value.medida):null,imagem_url:String(t.value.imagem_url||"").trim()||null};await N.salvar(s.value?_.value:null,u),h.push("/produtos")}catch(u){console.error(u),alert(((r=(n=u==null?void 0:u.response)==null?void 0:n.data)==null?void 0:r.message)||"Erro ao salvar.")}finally{T.value=!1}}return de(async()=>{const o=s.value?"produtos.editar":"produtos.criar";if(!b(o)){i.error("Acesso negado."),h.push("/produtos");return}C.value=!0;try{await Z(),s.value?await ee():Y()}catch(e){console.error("[PRODUTOS] erro no mounted:",e),i.error("Erro ao carregar dados iniciais."),h.push("/produtos")}finally{C.value=!1}}),(o,e)=>{const n=V("SearchInput"),r=V("Input"),u=V("Button"),k=V("Card");return p(),g("div",xe,[a("header",be,[a("div",null,[a("div",_e,[e[14]||(e[14]=a("div",{class:"w-10 h-10 rounded-xl bg-slate-900 flex items-center justify-center text-white"},[a("i",{class:"pi pi-box text-xl"})],-1)),a("h1",ye,S(s.value?"Editar Produto":"Novo Produto"),1)]),e[15]||(e[15]=a("p",{class:"text-sm text-slate-500"},"Gestão de insumos e controle de materiais de estoque.",-1))]),a("button",{type:"button",onClick:le,class:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 transition-all text-sm font-medium"},[...e[16]||(e[16]=[a("i",{class:"pi pi-arrow-left text-xs"},null,-1),a("span",null,"Voltar para lista",-1)])])]),c(k,{class:"border-none shadow-sm ring-1 ring-slate-200 overflow-hidden !rounded-2xl"},{default:E(()=>[C.value?(p(),g("div",we,[...e[17]||(e[17]=[a("div",{class:"w-10 h-10 border-2 border-slate-200 border-t-slate-900 rounded-full animate-spin"},null,-1),a("p",{class:"text-xs font-medium text-slate-400 uppercase tracking-widest"},"Carregando...",-1)])])):(p(),g("form",{key:1,onSubmit:q(oe,["prevent"]),class:"divide-y divide-slate-100"},[a("div",he,[a("div",Ie,[a("div",ke,[e[18]||(e[18]=a("div",{class:"flex items-center gap-2 mb-2"},[a("span",{class:"w-1.5 h-1.5 rounded-full bg-blue-600"}),a("h3",{class:"text-xs font-bold uppercase tracking-wider text-slate-400"},"Identificação Geral")],-1)),a("div",Ve,[c(n,{modelValue:t.value.fornecedor_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.fornecedor_id=l),mode:"select",label:"Fornecedor Principal",options:K.value,required:""},null,8,["modelValue","options"]),c(n,{modelValue:t.value.status,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.status=l),mode:"select",label:"Status do Cadastro",options:Q,required:""},null,8,["modelValue"])]),a("div",Se,[a("div",qe,[c(r,{modelValue:t.value.nome_produto,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.nome_produto=l),label:"Nome do Produto",placeholder:"Ex: Chapa de MDF 18mm",required:""},null,8,["modelValue"])]),c(n,{modelValue:t.value.unidade,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.unidade=l),mode:"select",label:"Unidade",options:X.value,required:""},null,8,["modelValue","options"])])]),a("div",Ae,[a("div",Ne,[e[22]||(e[22]=a("span",{class:"text-xs font-bold uppercase tracking-wider text-slate-400 mb-4 ml-1"},"Imagem do Produto",-1)),a("div",{class:ce(["relative group aspect-square rounded-2xl border-2 border-dashed border-slate-200 bg-slate-50 flex flex-col items-center justify-center overflow-hidden transition-all hover:border-slate-300",{"cursor-pointer":x.value}]),onClick:e[5]||(e[5]=l=>x.value?H():null)},[x.value?(p(),g("img",{key:0,src:x.value,class:"w-full h-full object-contain p-4"},null,8,Ce)):(p(),g("div",Te,[e[19]||(e[19]=a("i",{class:"pi pi-image text-slate-300 text-3xl mb-2"},null,-1)),a("p",De,S(s.value?"Sem imagem anexada":"Salve para anexar"),1)])),s.value&&O(b)("produtos.editar")?(p(),g("div",je,[a("button",{type:"button",onClick:e[4]||(e[4]=q(l=>{var d;return(d=m.value)==null?void 0:d.click()},["stop"])),class:"p-2 bg-white rounded-lg text-slate-900 hover:scale-110 transition-transform"},[...e[20]||(e[20]=[a("i",{class:"pi pi-upload"},null,-1)])]),x.value?(p(),g("button",{key:0,type:"button",onClick:q(te,["stop"]),class:"p-2 bg-white rounded-lg text-rose-600 hover:scale-110 transition-transform"},[...e[21]||(e[21]=[a("i",{class:"pi pi-trash"},null,-1)])])):A("",!0)])):A("",!0)],2),a("input",{ref_key:"imagemInput",ref:m,type:"file",class:"hidden",accept:"image/*",onChange:ae},null,544)])])])]),a("div",Pe,[e[23]||(e[23]=a("div",{class:"flex items-center gap-2 mb-6"},[a("span",{class:"w-1.5 h-1.5 rounded-full bg-slate-400"}),a("h3",{class:"text-xs font-bold uppercase tracking-wider text-slate-400"},"Atributos Técnicos")],-1)),a("div",Ue,[c(r,{modelValue:t.value.marca,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.marca=l),label:"Marca / Fabricante",placeholder:"Ex: Duratex"},null,8,["modelValue"]),c(r,{modelValue:t.value.cor,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.cor=l),label:"Cor / Acabamento",placeholder:"Ex: Branco Texturizado"},null,8,["modelValue"]),c(r,{modelValue:t.value.medida,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.medida=l),label:"Dimensões",placeholder:"Ex: 2750x1840mm"},null,8,["modelValue"])])]),a("div",Ee,[a("div",Oe,[a("div",Re,[c(r,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=l=>y.value=l),label:"Qtd. em Estoque",type:"number",required:""},null,8,["modelValue"])]),a("div",Me,[c(r,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=l=>w.value=l),label:"Custo Unitário (R$)",required:""},null,8,["modelValue"])]),a("div",ze,[a("div",$e,[e[24]||(e[24]=a("span",{class:"text-[10px] font-bold uppercase tracking-[0.1em] text-slate-400 mb-1"},"Total em Inventário",-1)),a("span",Be,S(W.value),1)])])])]),a("div",Fe,[a("button",{type:"button",onClick:e[11]||(e[11]=l=>O(h).push("/produtos")),class:"px-6 py-3 text-sm font-semibold text-slate-500 hover:text-rose-600 transition-colors"}," Cancelar "),O(b)(s.value?"produtos.editar":"produtos.criar")?(p(),G(u,{key:0,type:"submit",loading:T.value,variant:"primary",class:"!h-12 !px-8 !rounded-xl bg-slate-900 text-white font-bold text-sm shadow-lg shadow-slate-200 active:scale-95 transition-all"},{default:E(()=>[me(S(s.value?"Atualizar Produto":"Confirmar Cadastro"),1)]),_:1},8,["loading"])):A("",!0)])],32))]),_:1}),(p(),G(pe,{to:"body"},[c(ve,{name:"fade"},{default:E(()=>[I.value?(p(),g("div",{key:0,class:"fixed inset-0 z-[60] bg-slate-950/80 backdrop-blur-md flex items-center justify-center p-8",onClick:e[13]||(e[13]=q(l=>I.value=!1,["self"]))},[a("div",Ge,[a("button",{onClick:e[12]||(e[12]=l=>I.value=!1),class:"absolute top-4 right-4 z-10 w-10 h-10 bg-white rounded-full shadow-md flex items-center justify-center"},[...e[25]||(e[25]=[a("i",{class:"pi pi-times"},null,-1)])]),a("div",Le,[a("img",{src:x.value,class:"max-h-[80vh] w-auto object-contain"},null,8,He)])])])):A("",!0)]),_:1})]))])}}},Xe=se(Ke,[["__scopeId","data-v-de34053b"]]);export{Xe as default};
//# sourceMappingURL=_id_-CcLcgMdW.js.map
