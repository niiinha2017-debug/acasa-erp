import{x as Qe,y as Je,f as A,g as k,h as ue,j,i as Ke,m as s,s as d,r as O,c as h,o as _,e as l,E,d as U,A as i,b as n,u as r,l as V,t as D,P as N,p as We,H as Ze,F as Ye,aj as Xe,C as ea,V as G,q as z,aa as me,ae as aa}from"./index-CH22lQIC.js";import{F as oa}from"./formas-pagamento-BeF-njRO.js";const S={DEBITO:{taxa:1.99},CREDITO:{parcelas:{1:3.49,2:4.19,3:4.99,4:5.99,5:6.99,6:7.99,7:8.99,8:9.99,9:10.99,10:11.99,11:12.99,12:13.99}}},q={taxa:4.5},Q={ARQUITETO:{label:"Arquiteto",percentual:3},VENDEDOR:{label:"Vendedor",percentual:10},PROJETISTA:{label:"Projetista",percentual:5}},ta={class:"p-6 relative"},na={key:1,class:"space-y-8"},sa={class:"space-y-4"},la={class:"grid grid-cols-12 gap-4 items-end"},ra={class:"col-span-12 md:col-span-4"},ia={class:"col-span-12 md:col-span-4"},da={key:0,class:"mt-1 text-[10px] font-black uppercase tracking-widest text-slate-400"},ca={class:"col-span-12 md:col-span-2"},ua={class:"col-span-12 md:col-span-2"},ma={class:"space-y-4"},pa={class:"flex items-center justify-between gap-4"},va={key:0},_a={class:"whitespace-pre-line"},fa={class:"whitespace-pre-line font-bold"},ba={key:1,class:"font-bold"},ga={class:"font-bold"},ya={class:"font-bold"},xa={key:0,class:"flex justify-end gap-2"},ka={key:1,class:"text-[10px] font-black uppercase tracking-widest text-slate-300"},Va={key:1,class:"text-[10px] font-black uppercase tracking-widest text-slate-400 italic"},ha={class:"space-y-4"},Ea={class:"flex items-center justify-between gap-4"},Na={class:"grid grid-cols-12 gap-4 items-end"},Ca={class:"col-span-12 md:col-span-4"},Ia={key:1,class:"text-slate-300"},Aa={class:"flex justify-end"},Oa={key:1,class:"text-[10px] font-black uppercase tracking-widest text-slate-300"},Ua={class:"flex items-center justify-end gap-6 pt-2"},Da={class:"text-sm font-black uppercase tracking-tight"},Pa={class:"text-brand-primary"},Ra={class:"text-sm font-black uppercase tracking-tight"},wa={class:"space-y-4"},Sa={class:"flex items-center justify-between gap-4"},qa={class:"font-black text-slate-900"},Ta={class:"flex justify-end"},Ma={key:1,class:"text-[10px] font-black uppercase tracking-widest text-slate-300"},ja={class:"space-y-4"},za={class:"grid grid-cols-12 gap-4 items-end"},Ba={class:"col-span-12 md:col-span-3"},Fa={class:"col-span-12 md:col-span-3"},$a={class:"col-span-12 md:col-span-3"},La={class:"col-span-12 md:col-span-3"},Ha={class:"col-span-12 md:col-span-3"},Ga={class:"col-span-12 md:col-span-3"},Qa={class:"col-span-12 md:col-span-3"},Ja={class:"col-span-12 md:col-span-3"},Ka={class:"rounded-2xl border border-slate-100 bg-slate-50/60 p-3"},Wa={class:"space-y-4"},Za={class:"flex items-center justify-between gap-4"},Ya={class:"flex items-center justify-end gap-3 p-6 border-t border-slate-100 bg-slate-50/30"},Xa={class:"p-5 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between"},eo={class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-500"},ao={class:"p-6 space-y-5"},oo={class:"grid grid-cols-12 gap-4 items-end"},to={class:"p-5 border-t border-slate-100 bg-slate-50/50 flex justify-end gap-3"},ro={__name:"[id]",setup(no){const pe=Qe(),T=Je(),B=A(!1),C=k(()=>{const a=Number(String(pe.params.id||"").replace(/\D/g,""));return Number.isFinite(a)&&a>0?a:null}),u=k(()=>!!C.value),f=()=>u.value?"vendas.editar":"vendas.criar",P=A(!1),R=A(!1),ae=A([]),J=A([]),w=A(""),ve=(oa||[]).map(a=>({label:a.label,value:a.key})),_e=Object.entries(Q||{}).map(([a,e])=>({label:e.label,value:a}));function b(a){const e=Number(String(a??"").replace(",","."));return Number.isFinite(e)?e:0}function c(a){return Math.round((Number(a)+Number.EPSILON)*100)/100}function K(a){const e=Number((a==null?void 0:a.quantidade)||0),v=Number((a==null?void 0:a.valor_unitario)||0);return c(e*v)}function W(a){var e;return Number(((e=Q==null?void 0:Q[String(a||"")])==null?void 0:e.percentual)||0)}function fe(a,e){var g,I,p;const v=String(a||"");if(v==="DEBITO")return Number((g=S==null?void 0:S.DEBITO)==null?void 0:g.taxa);if(v==="CREDITO"){const x=Math.min(12,Math.max(1,Number(e||1)));return Number(((p=(I=S==null?void 0:S.CREDITO)==null?void 0:I.parcelas)==null?void 0:p[x])||0)}return 0}function Z(a){var v;const e=(v=Xe.find(g=>g.key===a))==null?void 0:v.key;if(!e)throw new Error(`PIPELINE_CLIENTE key não encontrada: ${a}`);return e}const o=ue({orcamento_id:"",status:Z("VENDA_FECHADA"),data_venda:new Date().toISOString().slice(0,10),valor_vendido:0,itens:[],pagamentos:[{forma_pagamento_chave:"",valor:0,parcelas:1,data_prevista_recebimento:"",data_recebimento:"",status_financeiro_chave:"EM_ABERTO"}],comissoes:[],taxa_pagamento_percentual_aplicado:0,tem_nota_fiscal:!1,taxa_nota_fiscal_percentual_aplicado:Number(q==null?void 0:q.taxa)}),oe=k(()=>(o.itens||[]).map((a,e)=>({...a,__idx:e}))),be=k(()=>(o.pagamentos||[]).map((a,e)=>({...a,__idx:e}))),ge=k(()=>(o.comissoes||[]).map((a,e)=>({...a,__idx:e}))),F=A(!1),$=A(!1),L=A(null),m=ue({nome_ambiente:"",descricao:"",observacao:"",quantidade:1,valor_unitario:0});function ye(){m.nome_ambiente="",m.descricao="",m.observacao="",m.quantidade=1,m.valor_unitario=0,L.value=null,$.value=!1}function xe(){if(!u.value||!s("vendas.editar"))return d.error("Acesso negado.");ye(),F.value=!0}function M(){F.value=!1}function ke(a){var v;if(!u.value||!s("vendas.editar"))return d.error("Acesso negado.");if(!a)return;const e=(v=o.itens)==null?void 0:v[a.__idx];e&&($.value=!0,L.value=a.__idx,m.nome_ambiente=e.nome_ambiente||"",m.descricao=e.descricao||"",m.observacao=e.observacao||"",m.quantidade=Number(e.quantidade||1),m.valor_unitario=Number(e.valor_unitario||0),F.value=!0)}function Ve(){if(!u.value||!s("vendas.editar"))return d.error("Acesso negado.");if(!String(m.nome_ambiente||"").trim()){d.warn("Preencha Item/Ambiente");return}const a={nome_ambiente:String(m.nome_ambiente||"").trim(),descricao:String(m.descricao||""),observacao:String(m.observacao||""),quantidade:Math.max(1,Number(m.quantidade||1)),valor_unitario:c(b(m.valor_unitario||0))};if($.value&&L.value!==null){Object.assign(o.itens[L.value],a),M();return}o.itens.push(a),M()}function he(a){if(!u.value||!s("vendas.editar"))return d.error("Acesso negado.");if(a!=null&&a.id){d.warn("Remoção de item do orçamento não disponível (sem endpoint).");return}const e=a==null?void 0:a.__idx;e!=null&&o.itens.splice(e,1)}async function Ee(){const a=f();if(!s(a))return d.error("Acesso negado.");await z.show(u.value?"Salvar Venda":"Criar Venda",u.value?`Deseja salvar as alterações da Venda #${C.value}?`:"Deseja criar esta venda agora?")&&await $e()}async function Ne(){if(!u.value)return;if(!s("vendas.editar"))return d.error("Acesso negado.");await z.show("Enviar para Produção",`Deseja enviar a Venda #${C.value} para Produção?`)&&await Le()}async function Ce(a){if(!u.value||!s("vendas.editar"))return d.error("Acesso negado.");await z.show("Remover Item",`Deseja remover "${(a==null?void 0:a.nome_ambiente)||"ITEM"}" desta venda?`)&&he(a)}async function Ie(a){if(!s(f()))return d.error("Acesso negado.");await z.show("Remover Pagamento","Deseja remover este pagamento do rateio?")&&Re(a)}async function Ae(a){if(!s(f()))return d.error("Acesso negado.");await z.show("Remover Comissão","Deseja remover esta comissão?")&&qe(a)}const Oe=[{key:"nome_ambiente",label:"Item/Ambiente"},{key:"descricao",label:"Acabamento"},{key:"observacao",label:"Observações"},{key:"quantidade",label:"Qtd",align:"right",width:"110px"},{key:"valor_unitario",label:"Valor",align:"right",width:"160px"},{key:"valor_total",label:"Total",align:"right",width:"160px"},{key:"acoes",label:"",align:"right",width:"140px"}],Ue=[{key:"forma",label:"Forma",width:"220px"},{key:"parcelas",label:"Parcelas",width:"120px",align:"right"},{key:"valor",label:"Valor",width:"160px",align:"right"},{key:"data_prevista",label:"Previsto",width:"150px"},{key:"data_recebimento",label:"Recebido",width:"150px"},{key:"acoes",label:"Ações",width:"140px",align:"right"}],De=[{key:"tipo",label:"Tipo",width:"220px"},{key:"responsavel",label:"Responsável"},{key:"percentual",label:"%",width:"120px",align:"right"},{key:"valor",label:"Valor",width:"160px",align:"right"},{key:"acoes",label:"Ações",width:"140px",align:"right"}];function Pe(){if(!s(f()))return d.error("Acesso negado.");o.pagamentos.push({forma_pagamento_chave:"",valor:0,parcelas:1,data_prevista_recebimento:"",data_recebimento:"",status_financeiro_chave:"EM_ABERTO"})}function Re(a){if(!s(f()))return d.error("Acesso negado.");o.pagamentos.length!==1&&o.pagamentos.splice(a,1)}const te=k(()=>c((o.pagamentos||[]).reduce((a,e)=>a+b((e==null?void 0:e.valor)||0),0))),ne=k(()=>c(te.value-b(o.valor_vendido||0))),we=k(()=>ne.value===0);function Se(){if(!s(f()))return d.error("Acesso negado.");o.comissoes.push({tipo_comissao_chave:"VENDEDOR",responsavel_nome:""})}function qe(a){if(!s(f()))return d.error("Acesso negado.");o.comissoes.splice(a,1)}const H=k(()=>c(b(o.valor_vendido||0))),se=a=>{const e=W(a==null?void 0:a.tipo_comissao_chave);return c(H.value*(e/100))},le=k(()=>c((o.comissoes||[]).reduce((a,e)=>a+se(e),0))),Y=k(()=>c((o.pagamentos||[]).reduce((a,e)=>{const v=b((e==null?void 0:e.valor)||0),g=fe(e==null?void 0:e.forma_pagamento_chave,e==null?void 0:e.parcelas);return a+c(v*(g/100))},0))),Te=k(()=>{const a=b(o.valor_vendido||0);return a<=0?0:c(Y.value/a*100)});j([()=>o.pagamentos,()=>o.valor_vendido],()=>{o.taxa_pagamento_percentual_aplicado=Te.value},{deep:!0}),j(()=>o.tem_nota_fiscal,a=>{o.taxa_nota_fiscal_percentual_aplicado=a?Number(q==null?void 0:q.taxa):0});const re=k(()=>o.tem_nota_fiscal?c(H.value*(b(o.taxa_nota_fiscal_percentual_aplicado||0)/100)):0),ie=k(()=>c(Y.value+re.value)),Me=k(()=>c(H.value-ie.value-le.value));async function je(){const{data:a}=await ea.listar(),e=Array.isArray(a)?a:(a==null?void 0:a.rows)||(a==null?void 0:a.data)||[];ae.value=e.map(v=>({label:v.nome_completo||v.razao_social||v.nome_fantasia||v.nome||`CLIENTE #${v.id}`,value:v.id}))}async function de(a){const{data:e}=await me.listar(),v=Array.isArray(e)?e:(e==null?void 0:e.rows)||(e==null?void 0:e.data)||[];J.value=v.filter(g=>Number(g==null?void 0:g.cliente_id)===Number(a)).map(g=>({label:`Orçamento #${g.id}`,value:g.id}))}async function ze(a){P.value=!0;try{const{data:e}=await me.detalhar(a);o.itens=((e==null?void 0:e.itens)||[]).map(g=>({nome_ambiente:g.nome_ambiente,descricao:g.descricao,observacao:"",quantidade:1,valor_unitario:Number(g.valor_unitario||0)}));const v=c((o.itens||[]).reduce((g,I)=>g+K(I),0));o.valor_vendido=c(v),o.pagamentos.length===1&&b(o.pagamentos[0].valor)===0&&o.valor_vendido>0&&(o.pagamentos[0].valor=c(o.valor_vendido))}catch(e){console.error(e),d.error("Erro ao carregar orçamento")}finally{P.value=!1}}async function X(){if(u.value){P.value=!0;try{const{data:a}=await G.buscar(C.value);w.value=a!=null&&a.cliente_id?String(a.cliente_id):"",await de(w.value),o.orcamento_id=(a==null?void 0:a.orcamento_id)??"",o.data_venda=a!=null&&a.data_venda?String(a.data_venda).slice(0,10):o.data_venda,o.valor_vendido=c(b((a==null?void 0:a.valor_vendido)||0)),o.taxa_pagamento_percentual_aplicado=c(b((a==null?void 0:a.taxa_pagamento_percentual_aplicado)||0)),o.taxa_nota_fiscal_percentual_aplicado=c(b((a==null?void 0:a.taxa_nota_fiscal_percentual_aplicado)||0)),o.tem_nota_fiscal=b(o.taxa_nota_fiscal_percentual_aplicado)>0,o.itens=((a==null?void 0:a.itens)||[]).map(e=>({id:e.id,nome_ambiente:e.nome_ambiente,descricao:e.descricao,observacao:e.observacao||"",quantidade:Number(e.quantidade||1),valor_unitario:Number(e.valor_unitario||0)})),o.pagamentos=((a==null?void 0:a.pagamentos)||[]).map(e=>({id:e.id,forma_pagamento_chave:e.forma_pagamento_chave||"",valor:c(b(e.valor||0)),parcelas:1,data_prevista_recebimento:e.data_prevista_recebimento?String(e.data_prevista_recebimento).slice(0,10):"",data_recebimento:e.data_recebimento?String(e.data_recebimento).slice(0,10):"",status_financeiro_chave:e.status_financeiro_chave||"EM_ABERTO"})),o.pagamentos.length||(o.pagamentos=[{forma_pagamento_chave:"",valor:c(o.valor_vendido),parcelas:1,data_prevista_recebimento:"",data_recebimento:"",status_financeiro_chave:"EM_ABERTO"}]),o.comissoes=((a==null?void 0:a.comissoes)||[]).map(e=>({id:e.id,tipo_comissao_chave:e.tipo_comissao_chave||"VENDEDOR",responsavel_nome:e.responsavel_nome||""}))}catch(a){console.error(a),d.error("Erro ao carregar venda")}finally{P.value=!1}}}async function Be(a){if(!(!u.value||!(a!=null&&a.id))){if(!s("vendas.editar"))return d.error("Acesso negado.");try{await G.atualizarItem(C.value,a.id,{nome_ambiente:a.nome_ambiente,descricao:a.descricao,observacao:a.observacao||"",quantidade:Number(a.quantidade||1),valor_unitario:c(b(a.valor_unitario||0))}),await X()}catch(e){console.error(e),d.error("Erro ao salvar item")}}}function Fe(){return{orcamento_id:Number(o.orcamento_id),status:Z("VENDA_FECHADA"),data_venda:o.data_venda?String(o.data_venda):void 0,valor_vendido:c(b(o.valor_vendido||0)),taxa_pagamento_percentual_aplicado:c(b(o.taxa_pagamento_percentual_aplicado||0)),tem_nota_fiscal:!!o.tem_nota_fiscal,taxa_nota_fiscal_percentual_aplicado:c(b(o.taxa_nota_fiscal_percentual_aplicado||0)),pagamentos:(o.pagamentos||[]).map(a=>({forma_pagamento_chave:String(a.forma_pagamento_chave||""),valor:c(b(a.valor||0)),data_prevista_recebimento:a.data_prevista_recebimento||null,data_recebimento:a.data_recebimento||null,status_financeiro_chave:a.status_financeiro_chave||"EM_ABERTO"})),comissoes:(o.comissoes||[]).map(a=>({tipo_comissao_chave:String(a.tipo_comissao_chave||""),percentual_aplicado:c(W(a.tipo_comissao_chave)),responsavel_nome:a.responsavel_nome||null}))}}async function $e(){const a=f();if(!s(a))return d.error("Acesso negado.");if(!R.value){R.value=!0;try{const e=Fe();if(u.value){await G.salvar(C.value,e),d.success("Salvo!"),T.push("/vendas");return}await G.salvar(null,e),d.success("Criado!"),T.push("/vendas")}catch(e){console.error(e),d.error("Erro ao salvar venda")}finally{R.value=!1}}}async function Le(){if(u.value){if(!s("vendas.editar"))return d.error("Acesso negado.");try{await aa.encaminhar({origem_tipo:"VENDA_CLIENTE",origem_id:C.value,status:Z("EM_PRODUCAO")}),d.success("Enviado para produção!"),await X()}catch(a){console.error(a),d.error("Erro ao enviar para produção")}}}return j(()=>w.value,async a=>{if(!u.value&&(o.orcamento_id="",J.value=[],o.itens=[],!!a))try{await de(a)}catch(e){console.error(e),d.error("Erro ao carregar orçamentos")}}),j(()=>o.orcamento_id,async a=>{a&&(u.value||await ze(a))}),j(()=>o.valor_vendido,a=>{o.pagamentos.length===1&&b(o.pagamentos[0].valor)===0&&b(a)>0&&(o.pagamentos[0].valor=c(b(a)))}),Ke(async()=>{if(!s("vendas.ver")){d.error("Acesso negado."),T.push("/vendas");return}if(u.value&&!s("vendas.editar")){d.error("Acesso negado."),T.push("/vendas");return}if(!u.value&&!s("vendas.criar")){d.error("Acesso negado."),T.push("/vendas");return}P.value=!0;try{await je(),u.value&&await X()}catch(a){console.error(a),d.error("Erro ao inicializar")}finally{P.value=!1}}),(a,e)=>{const v=O("PageHeader"),g=O("Loading"),I=O("SearchInput"),p=O("Input"),x=O("Button"),ee=O("Table"),He=O("CustomCheckbox"),ce=O("Card"),Ge=O("ArquivosModal");return _(),h(Ye,null,[l(ce,{shadow:!0,class:"overflow-hidden border-none"},{default:i(()=>[l(v,{title:u.value?`Venda #${C.value}`:"Nova Venda",subtitle:"Pós-venda: venda líquida, rateio, taxas e comissões.",icon:"pi pi-shopping-cart",backTo:"/vendas",class:"bg-slate-50/50 border-b border-slate-100"},null,8,["title"]),n("div",ta,[P.value?(_(),E(g,{key:0})):(_(),h("div",na,[n("section",sa,[e[12]||(e[12]=n("div",{class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400"}," Dados Gerais ",-1)),n("div",la,[n("div",ra,[l(I,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),mode:"select",label:"Cliente *",placeholder:"Selecione o cliente...",options:ae.value,required:"",readonly:u.value},null,8,["modelValue","options","readonly"])]),n("div",ia,[l(I,{modelValue:o.orcamento_id,"onUpdate:modelValue":e[1]||(e[1]=t=>o.orcamento_id=t),mode:"select",label:"Orçamento *",placeholder:"Selecione o orçamento...",options:J.value,readonly:!w.value||u.value,required:""},null,8,["modelValue","options","readonly"]),u.value?(_(),h("p",da," * Orçamento não altera após salvar a venda. ")):U("",!0)]),n("div",ca,[l(p,{modelValue:"VENDA FECHADA",label:"Status",readonly:""})]),n("div",ua,[l(p,{modelValue:o.data_venda,"onUpdate:modelValue":e[2]||(e[2]=t=>o.data_venda=t),type:"date",label:"Data da venda",forceUpper:!1},null,8,["modelValue"])])])]),e[32]||(e[32]=n("div",{class:"h-px bg-slate-100"},null,-1)),n("section",ma,[n("div",pa,[e[14]||(e[14]=n("div",{class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400"}," Itens da Venda ",-1)),u.value&&r(s)("vendas.editar")?(_(),E(x,{key:0,variant:"secondary",size:"sm",type:"button",onClick:xe},{default:i(()=>[...e[13]||(e[13]=[V(" + Novo item ",-1)])]),_:1})):U("",!0)]),oe.value.length>0?(_(),h("div",va,[l(ee,{columns:Oe,rows:oe.value,boxed:!0,emptyText:"Nenhum item."},{"cell-descricao":i(({row:t})=>[n("div",_a,D(t.descricao||"-"),1)]),"cell-observacao":i(({row:t})=>[n("div",fa,D(t.observacao||"-"),1)]),"cell-quantidade":i(({row:t})=>[u.value&&r(s)("vendas.editar")?(_(),E(p,{key:0,modelValue:o.itens[t.__idx].quantidade,"onUpdate:modelValue":y=>o.itens[t.__idx].quantidade=y,modelModifiers:{number:!0},type:"number",min:"1",forceUpper:!1},null,8,["modelValue","onUpdate:modelValue"])):(_(),h("span",ba,D(t.quantidade),1))]),"cell-valor_unitario":i(({row:t})=>[n("span",ga,D(r(N).currency(t.valor_unitario)),1)]),"cell-valor_total":i(({row:t})=>[n("span",ya,D(r(N).currency(K(t))),1)]),"cell-acoes":i(({row:t})=>[u.value&&r(s)("vendas.editar")?(_(),h("div",xa,[l(x,{variant:"secondary",size:"sm",type:"button",onClick:y=>t.id?Be(t):ke(t)},{default:i(()=>[...e[15]||(e[15]=[V(" Editar ",-1)])]),_:1},8,["onClick"]),l(x,{variant:"danger",size:"sm",type:"button",onClick:y=>Ce(t)},{default:i(()=>[...e[16]||(e[16]=[V(" Remover ",-1)])]),_:1},8,["onClick"])])):(_(),h("span",ka," — "))]),_:1},8,["rows"])])):(_(),h("div",Va," Selecione um orçamento para carregar os itens. ")),e[17]||(e[17]=n("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400"}," * Itens são clonados do orçamento ao salvar. Em edição, as alterações afetam apenas a venda. ",-1))]),e[33]||(e[33]=n("div",{class:"h-px bg-slate-100"},null,-1)),n("section",ha,[n("div",Ea,[e[19]||(e[19]=n("div",{class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400"}," Pagamentos (Rateio) ",-1)),r(s)(f())?(_(),E(x,{key:0,variant:"secondary",size:"sm",type:"button",onClick:Pe},{default:i(()=>[...e[18]||(e[18]=[V(" + Adicionar pagamento ",-1)])]),_:1})):U("",!0)]),n("div",Na,[n("div",Ca,[l(p,{modelValue:o.valor_vendido,"onUpdate:modelValue":e[3]||(e[3]=t=>o.valor_vendido=t),modelModifiers:{number:!0},type:"number",label:"Valor total vendido (cobrado) *",forceUpper:!1,readonly:!r(s)(f())},null,8,["modelValue","readonly"])])]),l(ee,{columns:Ue,rows:be.value,boxed:!0,emptyText:"Nenhum pagamento."},{"cell-forma":i(({row:t})=>[l(I,{modelValue:o.pagamentos[t.__idx].forma_pagamento_chave,"onUpdate:modelValue":y=>o.pagamentos[t.__idx].forma_pagamento_chave=y,mode:"select",placeholder:"Selecione...",options:r(ve),readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","options","readonly"])]),"cell-data_prevista":i(({row:t})=>[l(p,{modelValue:o.pagamentos[t.__idx].data_prevista_recebimento,"onUpdate:modelValue":y=>o.pagamentos[t.__idx].data_prevista_recebimento=y,type:"date",forceUpper:!1,readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","readonly"])]),"cell-data_recebimento":i(({row:t})=>[l(p,{modelValue:o.pagamentos[t.__idx].data_recebimento,"onUpdate:modelValue":y=>o.pagamentos[t.__idx].data_recebimento=y,type:"date",forceUpper:!1,readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","readonly"])]),"cell-parcelas":i(({row:t})=>[o.pagamentos[t.__idx].forma_pagamento_chave==="CREDITO"?(_(),E(p,{key:0,modelValue:o.pagamentos[t.__idx].parcelas,"onUpdate:modelValue":y=>o.pagamentos[t.__idx].parcelas=y,modelModifiers:{number:!0},type:"number",min:"1",max:"12",forceUpper:!1,readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","readonly"])):(_(),h("span",Ia,"—"))]),"cell-valor":i(({row:t})=>[l(p,{modelValue:o.pagamentos[t.__idx].valor,"onUpdate:modelValue":y=>o.pagamentos[t.__idx].valor=y,modelModifiers:{number:!0},type:"number",forceUpper:!1,readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","readonly"])]),"cell-acoes":i(({row:t})=>[n("div",Aa,[r(s)(f())?(_(),E(x,{key:0,variant:"danger",size:"sm",type:"button",disabled:o.pagamentos.length===1,onClick:y=>Ie(t.__idx)},{default:i(()=>[...e[20]||(e[20]=[V(" Remover ",-1)])]),_:1},8,["disabled","onClick"])):(_(),h("span",Oa," — "))])]),_:1},8,["rows"]),n("div",Ua,[n("div",Da,[e[21]||(e[21]=V(" Total rateado: ",-1)),n("span",Pa,D(r(N).currency(te.value)),1)]),n("div",Ra,[e[22]||(e[22]=V(" Diferença: ",-1)),n("span",{class:We(we.value?"text-emerald-600":"text-rose-600")},D(r(N).currency(ne.value)),3)])])]),e[34]||(e[34]=n("div",{class:"h-px bg-slate-100"},null,-1)),n("section",wa,[n("div",Sa,[e[24]||(e[24]=n("div",{class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400"}," Comissões ",-1)),r(s)(f())?(_(),E(x,{key:0,variant:"secondary",size:"sm",type:"button",onClick:Se},{default:i(()=>[...e[23]||(e[23]=[V(" + Adicionar comissão ",-1)])]),_:1})):U("",!0)]),l(ee,{columns:De,rows:ge.value,boxed:!0,emptyText:"Nenhuma comissão."},{"cell-tipo":i(({row:t})=>[l(I,{modelValue:o.comissoes[t.__idx].tipo_comissao_chave,"onUpdate:modelValue":y=>o.comissoes[t.__idx].tipo_comissao_chave=y,mode:"select",options:r(_e),readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","options","readonly"])]),"cell-responsavel":i(({row:t})=>[l(p,{modelValue:o.comissoes[t.__idx].responsavel_nome,"onUpdate:modelValue":y=>o.comissoes[t.__idx].responsavel_nome=y,placeholder:"Nome do responsável",forceUpper:!1,readonly:!r(s)(f())},null,8,["modelValue","onUpdate:modelValue","readonly"])]),"cell-percentual":i(({row:t})=>[l(p,{modelValue:W(t.tipo_comissao_chave),type:"number",readonly:"",forceUpper:!1},null,8,["modelValue"])]),"cell-valor":i(({row:t})=>[n("span",qa,D(r(N).currency(se(t))),1)]),"cell-acoes":i(({row:t})=>[n("div",Ta,[r(s)(f())?(_(),E(x,{key:0,variant:"danger",size:"sm",type:"button",onClick:y=>Ae(t.__idx)},{default:i(()=>[...e[25]||(e[25]=[V(" Remover ",-1)])]),_:1},8,["onClick"])):(_(),h("span",Ma," — "))])]),_:1},8,["rows"]),e[26]||(e[26]=n("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400 italic"}," * O percentual de comissão é fixo conforme configurações do sistema. ",-1))]),e[35]||(e[35]=n("div",{class:"h-px bg-slate-100"},null,-1)),n("section",ja,[e[27]||(e[27]=n("div",{class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400"}," Taxas e Resumo Líquido ",-1)),n("div",za,[n("div",Ba,[l(p,{modelValue:r(N).currency(H.value),label:"Total vendido (base)",readonly:""},null,8,["modelValue"])]),n("div",Fa,[l(p,{modelValue:r(N).currency(Y.value),label:"Taxa Cartão/Meio",readonly:""},null,8,["modelValue"])]),n("div",$a,[l(He,{modelValue:o.tem_nota_fiscal,"onUpdate:modelValue":e[4]||(e[4]=t=>o.tem_nota_fiscal=t),label:"Emitir Nota Fiscal",disabled:!r(s)(f())},null,8,["modelValue","disabled"])]),n("div",La,[l(p,{modelValue:`${o.tem_nota_fiscal?o.taxa_nota_fiscal_percentual_aplicado:0}%`,label:"Alíquota NF",readonly:""},null,8,["modelValue"])]),n("div",Ha,[l(p,{modelValue:r(N).currency(re.value),label:"Valor Imposto NF",readonly:""},null,8,["modelValue"])]),n("div",Ga,[l(p,{modelValue:r(N).currency(ie.value),label:"Total de Impostos/Taxas",readonly:""},null,8,["modelValue"])]),n("div",Qa,[l(p,{modelValue:r(N).currency(le.value),label:"Total Comissões",readonly:""},null,8,["modelValue"])]),n("div",Ja,[n("div",Ka,[l(p,{modelValue:r(N).currency(Me.value),label:"Resultado Líquido",readonly:""},null,8,["modelValue"])])])])]),e[36]||(e[36]=n("div",{class:"h-px bg-slate-100"},null,-1)),n("section",Wa,[n("div",Za,[e[29]||(e[29]=n("div",{class:"text-[11px] font-black uppercase tracking-[0.18em] text-slate-400"}," Arquivos e Comprovantes ",-1)),u.value&&r(s)("vendas.editar")?(_(),E(x,{key:0,variant:"secondary",size:"sm",type:"button",onClick:e[5]||(e[5]=t=>B.value=!0)},{default:i(()=>[...e[28]||(e[28]=[V(" Abrir Arquivos ",-1)])]),_:1})):U("",!0)]),e[30]||(e[30]=n("div",{class:"p-6 rounded-3xl border border-slate-100 bg-slate-50/50"},[n("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400 text-center py-2"}," Use “Abrir Arquivos” para anexar / visualizar dentro do PWA. ")],-1)),e[31]||(e[31]=n("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400"}," * O upload fica disponível apenas após a criação da venda no sistema. ",-1))])]))]),n("footer",Ya,[u.value&&r(s)("vendas.editar")?(_(),E(x,{key:0,variant:"secondary",size:"md",type:"button",disabled:R.value,onClick:Ne},{default:i(()=>[...e[37]||(e[37]=[V(" Enviar para produção ",-1)])]),_:1},8,["disabled"])):U("",!0),r(s)(f())?(_(),E(x,{key:1,variant:"primary",size:"md",type:"button",loading:R.value,disabled:R.value,onClick:Ee},{default:i(()=>[...e[38]||(e[38]=[V(" Salvar Venda ",-1)])]),_:1},8,["loading","disabled"])):U("",!0)]),F.value?(_(),h("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm",onClick:Ze(M,["self"])},[l(ce,{shadow:!0,class:"w-full max-w-[780px] overflow-hidden border-none"},{default:i(()=>[n("div",Xa,[n("div",eo,D($.value?"Editar item":"Novo item (extra na venda)"),1),l(x,{variant:"secondary",size:"sm",type:"button",onClick:M},{default:i(()=>[...e[39]||(e[39]=[V(" Fechar ",-1)])]),_:1})]),n("div",ao,[n("div",oo,[l(p,{class:"col-span-12 md:col-span-6",modelValue:m.nome_ambiente,"onUpdate:modelValue":e[6]||(e[6]=t=>m.nome_ambiente=t),label:"Item/Ambiente *",placeholder:"Ex: COZINHA / ARMÁRIO / FRETE",forceUpper:!1},null,8,["modelValue"]),l(p,{class:"col-span-12 md:col-span-6",modelValue:m.descricao,"onUpdate:modelValue":e[7]||(e[7]=t=>m.descricao=t),label:"Acabamento",placeholder:"Ex: MDF BRANCO / RIPADO / VIDRO",forceUpper:!1},null,8,["modelValue"]),l(p,{class:"col-span-12",modelValue:m.observacao,"onUpdate:modelValue":e[8]||(e[8]=t=>m.observacao=t),label:"Observações",placeholder:"Texto livre",forceUpper:!1},null,8,["modelValue"]),l(p,{class:"col-span-12 md:col-span-4",modelValue:m.quantidade,"onUpdate:modelValue":e[9]||(e[9]=t=>m.quantidade=t),modelModifiers:{number:!0},type:"number",min:"1",label:"Quantidade",forceUpper:!1},null,8,["modelValue"]),l(p,{class:"col-span-12 md:col-span-4",modelValue:m.valor_unitario,"onUpdate:modelValue":e[10]||(e[10]=t=>m.valor_unitario=t),modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",label:"Valor unitário",forceUpper:!1},null,8,["modelValue"]),l(p,{class:"col-span-12 md:col-span-4",modelValue:r(N).currency(K(m)),label:"Total",readonly:""},null,8,["modelValue"])]),e[40]||(e[40]=n("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400"}," * Esse item é extra na venda (não altera o orçamento). ",-1))]),n("div",to,[l(x,{variant:"secondary",type:"button",onClick:M},{default:i(()=>[...e[41]||(e[41]=[V(" Cancelar ",-1)])]),_:1}),l(x,{variant:"primary",type:"button",onClick:Ve},{default:i(()=>[...e[42]||(e[42]=[V(" Salvar item ",-1)])]),_:1})])]),_:1})])):U("",!0)]),_:1}),B.value&&C.value?(_(),E(Ge,{key:0,open:B.value,"owner-type":"VENDA","owner-id":C.value,categoria:"ANEXO","can-manage":r(s)("vendas.editar"),"view-perm":"vendas.ver",onClose:e[11]||(e[11]=t=>B.value=!1)},null,8,["open","owner-id","can-manage"])):U("",!0)],64)}}};export{ro as default};
//# sourceMappingURL=_id_-CpjLDv3S.js.map
