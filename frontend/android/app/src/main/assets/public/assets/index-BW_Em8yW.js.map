{"version":3,"file":"index-BW_Em8yW.js","sources":["../../src/pages/plano-corte/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in\">\r\n    \r\n    <div class=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-2\">\r\n      <div class=\"flex items-center gap-3\">\r\n        <div class=\"w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center\">\r\n          <i class=\"pi pi-box text-lg\"></i>\r\n        </div>\r\n        <div>\r\n          <h1 class=\"text-lg font-black text-slate-800 uppercase tracking-tight\">Plano de Corte</h1>\r\n          <p class=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider\">Industrialização por fornecedor</p>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto\">\r\n        <div class=\"relative w-full sm:w-64\">\r\n          <i class=\"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs\"></i>\r\n          <input \r\n            v-model=\"busca\" \r\n            type=\"text\" \r\n            placeholder=\"Buscar fornecedor ou lote...\"\r\n            class=\"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all uppercase\"\r\n          />\r\n        </div>\r\n        \r\n        <Button \r\n          v-if=\"can('plano_corte.criar')\"\r\n          variant=\"primary\"\r\n          size=\"md\"\r\n          class=\"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider w-full sm:w-auto\"\r\n          @click=\"novo()\"\r\n        >\r\n          <i class=\"pi pi-plus mr-1.5 text-[10px]\"></i>\r\n          Novo Plano\r\n        </Button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6\">\r\n      <div class=\"p-5 rounded-xl bg-white border border-slate-200 shadow-sm flex flex-col justify-center min-h-[100px]\">\r\n        <p class=\"text-[10px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Total Geral (Financeiro)</p>\r\n        <p class=\"text-2xl font-black text-slate-800\">{{ maskMoneyBR(valorTotalGeral) }}</p>\r\n      </div>\r\n      \r\n      <div class=\"p-5 rounded-xl bg-white border border-emerald-100 shadow-sm flex flex-col justify-center min-h-[100px]\">\r\n        <p class=\"text-[10px] font-black uppercase tracking-[0.15em] text-emerald-600 mb-1\">Finalizados</p>\r\n        <p class=\"text-3xl font-black text-emerald-700\">{{ totalFinalizados }}</p>\r\n      </div>\r\n      \r\n      <div class=\"p-5 rounded-xl bg-white border border-amber-100 shadow-sm flex flex-col justify-center min-h-[100px]\">\r\n        <p class=\"text-[10px] font-black uppercase tracking-[0.15em] text-amber-600 mb-1\">Em Aberto</p>\r\n        <div class=\"flex items-center gap-2\">\r\n          <p class=\"text-3xl font-black text-amber-700\">{{ totalEmAberto }}</p>\r\n          <span class=\"flex h-2 w-2 rounded-full bg-amber-500 animate-pulse mt-2\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm\">\r\n      <Table \r\n        :columns=\"columns\" \r\n        :rows=\"rowsFiltrados\" \r\n        :loading=\"loading\" \r\n        :boxed=\"false\"\r\n      >\r\n        <template #cell-fornecedor=\"{ row }\">\r\n          <div class=\"flex items-center gap-3 py-1\">\r\n            <div class=\"w-8 h-8 rounded-lg bg-slate-50 border border-slate-100 flex items-center justify-center font-black text-slate-400 text-[10px] uppercase\">\r\n              {{ (row.fornecedor?.razao_social || 'F').substring(0,2) }}\r\n            </div>\r\n            <div class=\"flex flex-col\">\r\n              <span class=\"text-sm font-bold text-slate-800 uppercase tracking-tight leading-tight\">\r\n                {{ row.fornecedor?.razao_social || 'Fornecedor não Identificado' }}\r\n              </span>\r\n              <span class=\"text-[10px] font-bold text-brand-primary tracking-wider uppercase\">\r\n                Pedido #{{ row.numero_pedido || row.id }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-data=\"{ row }\">\r\n          <div class=\"flex flex-col\">\r\n            <span class=\"text-xs font-bold text-slate-700\">\r\n              {{ row.data_venda ? new Date(row.data_venda).toLocaleDateString('pt-BR') : '-' }}\r\n            </span>\r\n            <span class=\"text-[9px] font-bold text-slate-400 uppercase\">Emissão</span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-total=\"{ row }\">\r\n          <div class=\"flex flex-col\">\r\n            <span class=\"text-sm font-black text-slate-800\">\r\n              {{ maskMoneyBR(row.valor_total || 0) }}\r\n            </span>\r\n            <span class=\"text-[9px] font-bold text-slate-400 uppercase italic\">Total Plano</span>\r\n          </div>\r\n        </template>\r\n\r\n        <template #cell-status=\"{ row }\">\r\n          <span \r\n            class=\"px-2 py-1 rounded text-[9px] font-black uppercase inline-flex items-center gap-1.5\"\r\n            :class=\"statusClassTailwind(row.status)\"\r\n          >\r\n            <span class=\"w-1.5 h-1.5 rounded-full bg-current\"></span>\r\n            {{ row.status || '—' }}\r\n          </span>\r\n        </template>\r\n\r\n        <template #cell-acoes=\"{ row }\">\r\n          <div class=\"flex justify-end gap-1 px-2\">\r\n            <button\r\n              v-if=\"can('plano_corte.editar')\"\r\n              @click=\"editar(row.id)\"\r\n              class=\"w-7 h-7 rounded-lg bg-slate-100 text-slate-500 hover:bg-brand-primary hover:text-white transition-all flex items-center justify-center\"\r\n              title=\"Editar\"\r\n            >\r\n              <i class=\"pi pi-pencil text-[10px]\"></i>\r\n            </button>\r\n            <button\r\n              v-if=\"can('plano_corte.excluir')\"\r\n              @click=\"confirmarExcluirPlanoIndex(row)\"\r\n              class=\"w-7 h-7 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center\"\r\n              title=\"Excluir\"\r\n            >\r\n              <i class=\"pi pi-trash text-[10px]\"></i>\r\n            </button>\r\n          </div>\r\n        </template>\r\n      </Table>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport api from '@/services/api'\r\nimport { maskMoneyBR } from '@/utils/masks'\r\nimport { confirm } from '@/services/confirm'\r\nimport { can } from '@/services/permissions'\r\nimport { notify } from '@/services/notify'\r\n\r\ndefinePage({ meta: { perm: 'plano_corte.ver' } })\r\n\r\nconst router = useRouter()\r\nconst busca = ref('')\r\nconst loading = ref(false)\r\nconst planos = ref([])\r\n\r\nconst columns = [\r\n  { key: 'fornecedor', label: 'FORNECEDOR / PEDIDO', width: '35%' },\r\n  { key: 'data', label: 'EMISSÃO', width: '15%' },\r\n  { key: 'total', label: 'VALOR TOTAL', width: '20%' }, // Aumentei um pouco a largura\r\n  { key: 'status', label: 'SITUAÇÃO', width: '20%' },\r\n  { key: 'acoes', label: '', width: '10%', align: 'right' }\r\n]\r\n\r\n// CÁLCULOS DOS CARDS DE TOPO\r\nconst totalFinalizados = computed(() =>\r\n  planos.value.filter(p => ['CONCLUIDO', 'FINALIZADO', 'ENTREGUE'].includes(String(p.status || '').toUpperCase())).length\r\n)\r\n\r\nconst totalEmAberto = computed(() => \r\n  planos.value.filter(p => !['CONCLUIDO', 'FINALIZADO', 'CANCELADO'].includes(String(p.status || '').toUpperCase())).length\r\n)\r\n\r\nconst valorTotalGeral = computed(() => \r\n  planos.value.reduce((acc, p) => acc + (Number(p.valor_total) || 0), 0)\r\n)\r\n\r\nconst rowsFiltrados = computed(() => {\r\n  const termo = (busca.value || '').toLowerCase().trim()\r\n  if (!termo) return planos.value\r\n  return planos.value.filter(p =>\r\n    String(p.fornecedor?.razao_social || '').toLowerCase().includes(termo) ||\r\n    String(p.status || '').toLowerCase().includes(termo) ||\r\n    String(p.numero_pedido || '').includes(termo)\r\n  )\r\n})\r\n\r\nfunction statusClassTailwind(status) {\r\n  const s = String(status || '').toUpperCase()\r\n  if (['CONCLUIDO', 'FINALIZADO'].includes(s)) return 'bg-emerald-50 text-emerald-600 border border-emerald-100'\r\n  if (s === 'CANCELADO') return 'bg-red-50 text-red-500 border border-red-100'\r\n  if (['EM_PRODUCAO', 'EM PRODUCAO', 'PRODUZINDO'].includes(s)) return 'bg-blue-50 text-blue-600 border border-blue-100'\r\n  // ABERTO / EM ABERTO\r\n  return 'bg-amber-50 text-amber-600 border border-amber-100'\r\n}\r\n\r\nfunction novo() {\r\n  router.push('/plano-corte/novo')\r\n}\r\n\r\nfunction editar(id) {\r\n  router.push(`/plano-corte/${id}`)\r\n}\r\n\r\nasync function carregar() {\r\n  loading.value = true\r\n  try {\r\n    const { data } = await api.get('/plano-corte')\r\n    // IMPORTANTE: Se o backend não somar os itens no GET /, \r\n    // você precisará fazer um map aqui ou garantir que o campo 'valor_total' exista no banco.\r\n    planos.value = Array.isArray(data) ? data : []\r\n  } catch (err) {\r\n    notify.error('Erro ao carregar planos.')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nasync function excluir(plano) {\r\n  try {\r\n    await api.delete(`/plano-corte/${plano.id}`)\r\n    planos.value = planos.value.filter(p => p.id !== plano.id)\r\n    notify.success('Plano removido com sucesso.')\r\n  } catch (err) {\r\n    notify.error('Erro ao excluir plano.')\r\n  }\r\n}\r\n\r\nasync function confirmarExcluirPlanoIndex(plano) {\r\n  const ok = await confirm.show(\r\n    'Excluir Plano de Corte',\r\n    `Deseja excluir o Plano de ${plano.fornecedor?.razao_social || 'Marcenaria'}?`\r\n  )\r\n  if (ok) await excluir(plano)\r\n}\r\n\r\nonMounted(carregar)\r\n</script>"],"names":["router","useRouter","busca","ref","loading","planos","columns","totalFinalizados","computed","p","totalEmAberto","valorTotalGeral","acc","rowsFiltrados","termo","_a","statusClassTailwind","status","s","novo","editar","id","carregar","data","api","notify","excluir","plano","confirmarExcluirPlanoIndex","confirm","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","$event","_unref","can","_createBlock","_component_Button","_cache","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","maskMoneyBR","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_createVNode","_component_Table","_withCtx","row","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_b","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23"],"mappings":"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"}