import{x as L,y as F,f as p,g as y,P as k,i as R,r as j,c,o as n,b as t,E as B,d,t as f,u as r,m as u,l as z,w as G,v as U,e as X,A as v,aa as q,C as H,s as b,q as J}from"./index-CH22lQIC.js";const K={class:"w-full max-w-[1200px] mx-auto space-y-6 animate-page-in pb-10"},Q={class:"flex flex-col md:flex-row items-start md:items-end justify-between gap-6 px-2 pt-4"},W={class:"space-y-4"},Y={class:"flex items-center gap-4"},Z={class:"flex items-center gap-2 mt-1.5"},ee={class:"px-2 py-0.5 rounded-md bg-brand-primary/10 text-brand-primary text-[10px] font-black uppercase tracking-widest"},te={key:0,class:"text-[10px] font-bold text-slate-400 uppercase tracking-tighter"},ae={class:"flex items-center gap-3 w-full md:w-auto"},se={class:"px-2"},oe={class:"relative max-w-md group"},re={class:"bg-white border border-slate-200 rounded-[2rem] shadow-sm overflow-hidden mx-2"},le={class:"py-2"},ne={class:"inline-flex items-center justify-center bg-slate-100 px-3 py-1 rounded-full text-[10px] font-black text-slate-500 tracking-tighter"},ie={class:"flex flex-col"},ce={class:"text-xs font-black text-slate-700"},de={class:"flex flex-col items-end pr-4"},ue={class:"text-sm font-black text-slate-900 tabular-nums"},pe={class:"flex justify-end items-center gap-2 pr-2"},xe=["onClick"],me={class:"flex items-center gap-1.5"},fe=["onClick"],ve=["onClick"],be=["onClick"],ye={__name:"[id]",setup(ge){const A=L(),g=F(),h=p(!1),_=p(null),C=p(!1),E=p(""),x=p([]),m=p(null),w=y(()=>Number(String(A.params.id||"").replace(/\D/g,""))),T=[{key:"id",label:"ID",width:"90px"},{key:"data",label:"Data",width:"140px"},{key:"total",label:"Total",width:"160px",align:"right"},{key:"acoes",label:"Ações",width:"220px",align:"right"}];async function D(){if(w.value){C.value=!0;try{const[a,e]=await Promise.allSettled([q.listar(),H.buscar(w.value)]),o=a.status==="fulfilled"?a.value.data:[];x.value=(Array.isArray(o)?o:[]).filter(l=>Number(l.cliente_id)===w.value).sort((l,s)=>{const i=new Date(l.criado_em||l.data||0).getTime();return new Date(s.criado_em||s.data||0).getTime()-i}),e.status==="fulfilled"&&(m.value=e.value.data)}catch(a){console.error("Erro ao carregar orçamentos:",a),b.error("Erro ao sincronizar dados.")}finally{C.value=!1}}}const O=y(()=>{var e;const a=(e=E.value)==null?void 0:e.trim().toLowerCase();return a?x.value.filter(o=>{const l=String(o.id||"").toLowerCase(),s=k.date(o.criado_em||o.data||"").toLowerCase(),i=k.currency(o.total_itens||o.valor_total||0).toLowerCase();return l.includes(a)||s.includes(a)||i.includes(a)}):x.value}),$=y(()=>{var e,o;if(m.value)return m.value.nome_completo||m.value.razao_social;const a=(e=x.value)==null?void 0:e[0];return(a==null?void 0:a.cliente_nome_snapshot)||((o=a==null?void 0:a.cliente)==null?void 0:o.nome_completo)||"CLIENTE"}),N=y(()=>{var e,o;const a=m.value||((o=(e=x.value)==null?void 0:e[0])==null?void 0:o.cliente)||{};return a.whatsapp||a.telefone||a.celular||""});function I(a){if(!u("orcamentos.editar"))return b.error("Acesso negado.");g.push(`/orcamentos/${a}`)}function M(a){_.value=a,h.value=!0}async function P(a){try{const{data:e}=await q.abrirPdf(a),o=(e==null?void 0:e.arquivoId)||(e==null?void 0:e.id);if(!o)throw new Error;g.push({path:`/arquivos/${o}`,query:{name:`ORC_${a}.pdf`,type:"application/pdf"}})}catch{b.error("Documento PDF não disponível no momento.")}}async function S(a){if(await J.show("Excluir?",`Deseja remover o orçamento #${a}?`))try{await q.remover(a),b.success("Removido com sucesso"),await D()}catch{b.error("Erro ao excluir.")}}function V(){g.push({path:"/orcamentos/novo",query:{cliente_id:w.value}})}return R(D),(a,e)=>{const o=j("Table"),l=j("ArquivosModal");return n(),c("div",K,[t("header",Q,[t("div",W,[t("div",Y,[e[4]||(e[4]=t("div",{class:"w-12 h-12 rounded-2xl bg-slate-900 text-white flex items-center justify-center shadow-xl shadow-slate-200 rotate-3 hover:rotate-0 transition-transform duration-300"},[t("i",{class:"pi pi-file-edit text-xl"})],-1)),t("div",null,[e[3]||(e[3]=t("h1",{class:"text-2xl font-black text-slate-800 uppercase tracking-tight leading-none"}," Orçamentos ",-1)),t("div",Z,[t("span",ee,f($.value),1),N.value?(n(),c("span",te," • "+f(N.value),1)):d("",!0)])])])]),t("div",ae,[t("button",{onClick:e[0]||(e[0]=s=>r(g).back()),class:"flex-1 md:flex-none h-11 px-6 rounded-xl border border-slate-200 bg-white text-slate-500 text-[10px] font-black uppercase tracking-widest hover:bg-slate-50 transition-all active:scale-95"}," Voltar "),r(u)("orcamentos.criar")?(n(),c("button",{key:0,onClick:V,class:"flex-1 md:flex-none h-11 px-8 rounded-xl bg-brand-primary text-white text-[10px] font-black uppercase tracking-widest shadow-lg shadow-brand-primary/25 hover:brightness-110 transition-all active:scale-95 flex items-center justify-center gap-2"},[...e[5]||(e[5]=[t("i",{class:"pi pi-plus text-[8px]"},null,-1),z(" Novo Orçamento ",-1)])])):d("",!0)])]),t("div",se,[t("div",oe,[e[6]||(e[6]=t("i",{class:"pi pi-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs group-focus-within:text-brand-primary transition-colors"},null,-1)),G(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>E.value=s),type:"text",placeholder:"Filtrar por ID, data ou valor...",class:"w-full pl-11 pr-4 h-12 bg-white/60 backdrop-blur-sm border border-slate-200 rounded-2xl text-[11px] font-bold focus:ring-4 focus:ring-brand-primary/5 focus:border-brand-primary outline-none transition-all uppercase placeholder:text-slate-300"},null,512),[[U,E.value]])])]),t("div",re,[X(o,{columns:T,rows:O.value,loading:C.value,boxed:!1},{"cell-id":v(({row:s})=>[t("div",le,[t("span",ne," #"+f(s.id),1)])]),"cell-data":v(({row:s})=>[t("div",ie,[t("span",ce,f(r(k).date(s.criado_em||s.data)),1),e[7]||(e[7]=t("span",{class:"text-[9px] text-slate-400 font-bold uppercase tracking-widest"},"Emissão",-1))])]),"cell-total":v(({row:s})=>[t("div",de,[t("span",ue,f(r(k).currency(s.total_itens||s.valor_total||0)),1),e[8]||(e[8]=t("span",{class:"text-[9px] font-black text-emerald-500 uppercase tracking-tighter bg-emerald-50 px-1.5 rounded"},"Valor Final",-1))])]),"cell-acoes":v(({row:s})=>[t("div",pe,[r(u)("orcamentos.editar")?(n(),c("button",{key:0,onClick:i=>I(s.id),class:"h-9 px-5 rounded-xl bg-slate-900 text-white text-[10px] font-black uppercase tracking-widest hover:shadow-lg hover:shadow-slate-200 hover:-translate-y-0.5 transition-all active:scale-95"}," Gerenciar ",8,xe)):d("",!0),e[12]||(e[12]=t("div",{class:"h-6 w-px bg-slate-100 mx-1"},null,-1)),t("div",me,[r(u)("orcamentos.ver")?(n(),c("button",{key:0,onClick:i=>M(s.id),class:"w-9 h-9 flex items-center justify-center rounded-xl text-slate-400 hover:bg-slate-50 hover:text-brand-primary transition-all",title:"Arquivos"},[...e[9]||(e[9]=[t("i",{class:"pi pi-paperclip text-xs"},null,-1)])],8,fe)):d("",!0),r(u)("orcamentos.ver")?(n(),c("button",{key:1,onClick:i=>P(s.id),class:"w-9 h-9 flex items-center justify-center rounded-xl text-slate-400 hover:bg-slate-50 hover:text-emerald-500 transition-all",title:"Imprimir PDF"},[...e[10]||(e[10]=[t("i",{class:"pi pi-file-pdf text-xs"},null,-1)])],8,ve)):d("",!0),r(u)("orcamentos.excluir")?(n(),c("button",{key:2,onClick:i=>S(s.id),class:"w-9 h-9 flex items-center justify-center rounded-xl text-slate-300 hover:bg-rose-50 hover:text-rose-500 transition-all",title:"Excluir"},[...e[11]||(e[11]=[t("i",{class:"pi pi-trash text-xs"},null,-1)])],8,be)):d("",!0)])])]),empty:v(()=>[...e[13]||(e[13]=[t("div",{class:"py-24 flex flex-col items-center justify-center text-center"},[t("div",{class:"relative mb-6"},[t("div",{class:"absolute inset-0 bg-brand-primary/5 blur-3xl rounded-full"}),t("div",{class:"relative w-20 h-20 bg-white border border-slate-100 rounded-3xl shadow-xl flex items-center justify-center rotate-6"},[t("i",{class:"pi pi-folder-open text-slate-200 text-4xl"})])]),t("h3",{class:"text-sm font-black text-slate-800 uppercase tracking-widest"},"Lista vazia"),t("p",{class:"text-[10px] text-slate-400 font-bold uppercase mt-2 max-w-[200px] leading-relaxed"}," Não encontramos orçamentos registrados para este cliente. ")],-1)])]),_:1},8,["rows","loading"])]),h.value&&_.value?(n(),B(l,{key:0,open:h.value,ownerType:"ORCAMENTO",ownerId:_.value,categoria:"ANEXO",canManage:r(u)("orcamentos.editar"),onClose:e[2]||(e[2]=s=>h.value=!1)},null,8,["open","ownerId","canManage"])):d("",!0)])}}};export{ye as default};
//# sourceMappingURL=_id_-BlWfGI2E.js.map
