{"version":3,"file":"utils-haS6CNYB.js","sources":["../../src/utils/utils.js"],"sourcesContent":["//src/utils/utils.js\r\n\r\nimport api from '@/services/api'\r\n\r\n/* =====================\r\n   CEP\r\n===================== */\r\nexport async function buscarCep(cep) {\r\n  const n = cep.replace(/\\D/g, '') // Garante que só tenha números\r\n  if (n.length !== 8) return null\r\n\r\n  try {\r\n    const res = await fetch(`https://viacep.com.br/ws/${n}/json`)\r\n    const data = await res.json()\r\n    return data.erro ? null : data\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function buscarCnpj(cnpj) {\r\n  const limpo = String(cnpj || '').replace(/\\D/g, '')\r\n  if (limpo.length !== 14) return null\r\n\r\n  try {\r\n    const res = await api.get(`/utils/cnpj/${limpo}`)\r\n    console.log('[buscarCnpj] status:', res.status)\r\n    console.log('[buscarCnpj] data:', res.data)\r\n    return res.data || null\r\n  } catch (err) {\r\n    console.log('[buscarCnpj] ERRO status:', err?.response?.status)\r\n    console.log('[buscarCnpj] ERRO data:', err?.response?.data)\r\n    return null\r\n  }\r\n}\r\n\r\nexport function calcularCustoHora(salarioMensal, horasSemana = 48, semanasMes = 4.5) {\r\n  const s = Number(salarioMensal || 0)\r\n  const hs = Number(horasSemana || 0)\r\n  const sm = Number(semanasMes || 0)\r\n\r\n  const horasMes = hs * sm\r\n  if (!horasMes) return 0\r\n\r\n  const v = s / horasMes\r\n  return Math.round(v * 100) / 100\r\n}\r\n\r\n\r\nexport function calcularHorasDiaPorSemana(horasSemana = 48, diasSemana = 6) {\r\n  const hs = Number(horasSemana)\r\n  const ds = Number(diasSemana)\r\n  if (!hs || !ds) return 0\r\n  return hs / ds\r\n}\r\nexport function calcularHorasTrabalhadasNoDia(registrosDoDia = []) {\r\n  const regs = [...registrosDoDia]\r\n    .filter(r => r?.status !== 'INVALIDADO')\r\n    .slice()\r\n    .sort((a, b) => new Date(a.data_hora) - new Date(b.data_hora))\r\n\r\n  let totalMs = 0\r\n  let entrada = null\r\n\r\n  for (const r of regs) {\r\n    if (r.tipo === 'ENTRADA') {\r\n      entrada = new Date(r.data_hora)\r\n      continue\r\n    }\r\n    if (r.tipo === 'SAIDA' && entrada) {\r\n      const saida = new Date(r.data_hora)\r\n      const diff = saida - entrada\r\n      if (diff > 0) totalMs += diff\r\n      entrada = null\r\n    }\r\n  }\r\n\r\n  return totalMs / 3600000 // horas em decimal\r\n}\r\n\r\n// mantém esta função (você ainda usa para horas e meta)\r\nexport function horasDecimalParaHHMM(h) {\r\n  const totalMin = Math.round((Number(h) || 0) * 60)\r\n  const hh = String(Math.floor(totalMin / 60)).padStart(2, '0')\r\n  const mm = String(totalMin % 60).padStart(2, '0')\r\n  return `${hh}:${mm}`\r\n}\r\n\r\nexport function horasDecimalParaHHMMComSinal(h) {\r\n  const negativo = Number(h) < 0\r\n  const abs = Math.abs(Number(h) || 0)\r\n\r\n  const totalMin = Math.round(abs * 60)\r\n  const hh = String(Math.floor(totalMin / 60)).padStart(2, '0')\r\n  const mm = String(totalMin % 60).padStart(2, '0')\r\n\r\n  return `${negativo ? '-' : ''}${hh}:${mm}`\r\n}\r\n\r\nexport function consolidarSaldoPeriodo({ registros = [], horasSemana = 48, diasSemana = 6 }) {\r\n  const metaDia = calcularHorasDiaPorSemana(horasSemana, diasSemana)\r\n\r\n  const porDia = new Map()\r\n  for (const r of registros) {\r\n    const dia = new Date(r.data_hora).toISOString().slice(0, 10)\r\n    if (!porDia.has(dia)) porDia.set(dia, [])\r\n    porDia.get(dia).push(r)\r\n  }\r\n\r\n  const dias = Array.from(porDia.keys()).sort()\r\n  const linhas = dias.map((dia) => {\r\n    const h = calcularHorasTrabalhadasNoDia(porDia.get(dia))\r\n    const saldo = h - metaDia\r\n    return {\r\n      dia,\r\n      horas: h,\r\n      horasHHMM: horasDecimalParaHHMM(h),\r\n      meta: metaDia,\r\n      metaHHMM: horasDecimalParaHHMM(metaDia),\r\n      saldo,\r\n      saldoHHMM: horasDecimalParaHHMMComSinal(saldo),\r\n    }\r\n  })\r\n\r\n  const totalHoras = linhas.reduce((acc, l) => acc + l.horas, 0)\r\n  const totalSaldo = linhas.reduce((acc, l) => acc + l.saldo, 0)\r\n\r\n  return {\r\n    metaDia,\r\n    linhas,\r\n    totalHoras,\r\n    totalHorasHHMM: horasDecimalParaHHMM(totalHoras),\r\n    totalSaldo,\r\n    totalSaldoHHMM: horasDecimalParaHHMMComSinal(totalSaldo),\r\n  }\r\n}\r\n\r\n"],"names":["buscarCep","cep","n","data","buscarCnpj","cnpj","limpo","res","api","err","_a","_b","calcularHorasDiaPorSemana","horasSemana","diasSemana","hs","ds","calcularHorasTrabalhadasNoDia","registrosDoDia","regs","r","a","b","totalMs","entrada","diff","horasDecimalParaHHMM","h","totalMin","hh","mm","horasDecimalParaHHMMComSinal","negativo","abs","consolidarSaldoPeriodo","registros","metaDia","porDia","dia","linhas","saldo","totalHoras","acc","l","totalSaldo"],"mappings":"yCAOO,eAAeA,EAAUC,EAAK,CACnC,MAAMC,EAAID,EAAI,QAAQ,MAAO,EAAE,EAC/B,GAAIC,EAAE,SAAW,EAAG,OAAO,KAE3B,GAAI,CAEF,MAAMC,EAAO,MADD,MAAM,MAAM,4BAA4BD,CAAC,OAAO,GACrC,KAAI,EAC3B,OAAOC,EAAK,KAAO,KAAOA,CAC5B,MAAc,CACZ,OAAO,IACT,CACF,CAEO,eAAeC,EAAWC,EAAM,SACrC,MAAMC,EAAQ,OAAOD,GAAQ,EAAE,EAAE,QAAQ,MAAO,EAAE,EAClD,GAAIC,EAAM,SAAW,GAAI,OAAO,KAEhC,GAAI,CACF,MAAMC,EAAM,MAAMC,EAAI,IAAI,eAAeF,CAAK,EAAE,EAChD,eAAQ,IAAI,uBAAwBC,EAAI,MAAM,EAC9C,QAAQ,IAAI,qBAAsBA,EAAI,IAAI,EACnCA,EAAI,MAAQ,IACrB,OAASE,EAAK,CACZ,eAAQ,IAAI,6BAA6BC,EAAAD,GAAA,YAAAA,EAAK,WAAL,YAAAC,EAAe,MAAM,EAC9D,QAAQ,IAAI,2BAA2BC,EAAAF,GAAA,YAAAA,EAAK,WAAL,YAAAE,EAAe,IAAI,EACnD,IACT,CACF,CAeO,SAASC,EAA0BC,EAAc,GAAIC,EAAa,EAAG,CAC1E,MAAMC,EAAK,OAAOF,CAAW,EACvBG,EAAK,OAAOF,CAAU,EAC5B,MAAI,CAACC,GAAM,CAACC,EAAW,EAChBD,EAAKC,CACd,CACO,SAASC,EAA8BC,EAAiB,GAAI,CACjE,MAAMC,EAAO,CAAC,GAAGD,CAAc,EAC5B,OAAOE,IAAKA,GAAA,YAAAA,EAAG,UAAW,YAAY,EACtC,MAAK,EACL,KAAK,CAACC,EAAGC,IAAM,IAAI,KAAKD,EAAE,SAAS,EAAI,IAAI,KAAKC,EAAE,SAAS,CAAC,EAE/D,IAAIC,EAAU,EACVC,EAAU,KAEd,UAAWJ,KAAKD,EAAM,CACpB,GAAIC,EAAE,OAAS,UAAW,CACxBI,EAAU,IAAI,KAAKJ,EAAE,SAAS,EAC9B,QACF,CACA,GAAIA,EAAE,OAAS,SAAWI,EAAS,CAEjC,MAAMC,EADQ,IAAI,KAAKL,EAAE,SAAS,EACbI,EACjBC,EAAO,IAAGF,GAAWE,GACzBD,EAAU,IACZ,CACF,CAEA,OAAOD,EAAU,IACnB,CAGO,SAASG,EAAqBC,EAAG,CACtC,MAAMC,EAAW,KAAK,OAAO,OAAOD,CAAC,GAAK,GAAK,EAAE,EAC3CE,EAAK,OAAO,KAAK,MAAMD,EAAW,EAAE,CAAC,EAAE,SAAS,EAAG,GAAG,EACtDE,EAAK,OAAOF,EAAW,EAAE,EAAE,SAAS,EAAG,GAAG,EAChD,MAAO,GAAGC,CAAE,IAAIC,CAAE,EACpB,CAEO,SAASC,EAA6BJ,EAAG,CAC9C,MAAMK,EAAW,OAAOL,CAAC,EAAI,EACvBM,EAAM,KAAK,IAAI,OAAON,CAAC,GAAK,CAAC,EAE7BC,EAAW,KAAK,MAAMK,EAAM,EAAE,EAC9BJ,EAAK,OAAO,KAAK,MAAMD,EAAW,EAAE,CAAC,EAAE,SAAS,EAAG,GAAG,EACtDE,EAAK,OAAOF,EAAW,EAAE,EAAE,SAAS,EAAG,GAAG,EAEhD,MAAO,GAAGI,EAAW,IAAM,EAAE,GAAGH,CAAE,IAAIC,CAAE,EAC1C,CAEO,SAASI,EAAuB,CAAE,UAAAC,EAAY,CAAA,EAAI,YAAAtB,EAAc,GAAI,WAAAC,EAAa,GAAK,CAC3F,MAAMsB,EAAUxB,EAA0BC,EAAaC,CAAU,EAE3DuB,EAAS,IAAI,IACnB,UAAWjB,KAAKe,EAAW,CACzB,MAAMG,EAAM,IAAI,KAAKlB,EAAE,SAAS,EAAE,cAAc,MAAM,EAAG,EAAE,EACtDiB,EAAO,IAAIC,CAAG,GAAGD,EAAO,IAAIC,EAAK,EAAE,EACxCD,EAAO,IAAIC,CAAG,EAAE,KAAKlB,CAAC,CACxB,CAGA,MAAMmB,EADO,MAAM,KAAKF,EAAO,KAAI,CAAE,EAAE,KAAI,EACvB,IAAKC,GAAQ,CAC/B,MAAMX,EAAIV,EAA8BoB,EAAO,IAAIC,CAAG,CAAC,EACjDE,EAAQb,EAAIS,EAClB,MAAO,CACL,IAAAE,EACA,MAAOX,EACP,UAAWD,EAAqBC,CAAC,EACjC,KAAMS,EACN,SAAUV,EAAqBU,CAAO,EACtC,MAAAI,EACA,UAAWT,EAA6BS,CAAK,CACnD,CACE,CAAC,EAEKC,EAAaF,EAAO,OAAO,CAACG,EAAKC,IAAMD,EAAMC,EAAE,MAAO,CAAC,EACvDC,EAAaL,EAAO,OAAO,CAACG,EAAKC,IAAMD,EAAMC,EAAE,MAAO,CAAC,EAE7D,MAAO,CACL,QAAAP,EACA,OAAAG,EACA,WAAAE,EACA,eAAgBf,EAAqBe,CAAU,EAC/C,WAAAG,EACA,eAAgBb,EAA6Ba,CAAU,CAC3D,CACA"}