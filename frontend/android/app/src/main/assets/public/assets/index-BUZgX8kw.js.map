{"version":3,"file":"index-BUZgX8kw.js","sources":["../../src/pages/produtos/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"w-full max-w-[1200px] mx-auto px-2 sm:px-3 lg:px-4 space-y-4 animate-page-in\">\r\n\r\n    <!-- Header -->\r\n    <div class=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3 pt-2\">\r\n      <div class=\"flex items-center gap-3\">\r\n        <div class=\"w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center\">\r\n          <i class=\"pi pi-shopping-cart text-lg\"></i>\r\n        </div>\r\n        <div>\r\n          <h1 class=\"text-lg font-black text-slate-800 uppercase tracking-tight\">Insumos & Materiais</h1>\r\n          <p class=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider\">Base de dados para industrialização</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full sm:w-auto\">\r\n        <div class=\"relative w-full sm:w-72\">\r\n          <i class=\"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs\"></i>\r\n          <input\r\n            v-model=\"filtro\"\r\n            type=\"text\"\r\n            placeholder=\"BUSCAR MATERIAL OU FORNECEDOR...\"\r\n            class=\"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold\r\n                   focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all uppercase\"\r\n          />\r\n        </div>\r\n\r\n        <Button\r\n          v-if=\"can('produtos.criar')\"\r\n          variant=\"primary\"\r\n          size=\"md\"\r\n          class=\"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider w-full sm:w-auto\"\r\n          @click=\"router.push('/produtos/novo')\"\r\n        >\r\n          <i class=\"pi pi-plus mr-1.5 text-[10px]\"></i>\r\n          Novo Produto\r\n        </Button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Cards (sem valor_total) -->\r\n    <div class=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Total de Itens</p>\r\n        <p class=\"text-xl font-black text-slate-800\">{{ totalItens }}</p>\r\n      </div>\r\n\r\n      <div class=\"p-4 rounded-xl bg-white border border-slate-200 shadow-sm\">\r\n        <p class=\"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400 mb-1\">Produtos Ativos</p>\r\n        <p class=\"text-xl font-black text-blue-600\">{{ totalAtivos }}</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Tabela -->\r\n    <div class=\"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm\">\r\n      <Table\r\n        :columns=\"columns\"\r\n        :rows=\"rows\"\r\n        :loading=\"loading\"\r\n        :boxed=\"false\"\r\n        empty-text=\"Nenhum produto encontrado.\"\r\n      >\r\n        <template #cell-nome_produto=\"{ row }\">\r\n          <div class=\"flex items-center gap-3 py-1\">\r\n<div class=\"w-8 h-8 rounded-lg border border-slate-100 bg-slate-50 overflow-hidden flex items-center justify-center\">\r\n  <img\r\n    v-if=\"String(row.imagem_url || '').trim()\"\r\n    :src=\"row.imagem_url\"\r\n    class=\"w-full h-full object-cover\"\r\n    alt=\"Imagem do produto\"\r\n  />\r\n  <span v-else class=\"font-black text-slate-400 text-[10px] uppercase\">\r\n    {{ String(row.nome_produto || '').substring(0, 2) }}\r\n  </span>\r\n</div>\r\n\r\n\r\n\r\n            <div class=\"flex flex-col min-w-0\">\r\n              <span class=\"text-sm font-bold text-slate-800 uppercase tracking-tight leading-tight truncate\">\r\n                {{ row.nome_produto }}\r\n              </span>\r\n              <span class=\"text-[10px] font-bold text-slate-400 tracking-wider uppercase\">\r\n                Ref: {{ String(row.id || 0).padStart(4, '0') }} • {{ row.marca || 'S/ Marca' }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </template>\r\n\r\n        <!-- ✅ Valor Unitário -->\r\n        <template #cell-valor_unitario=\"{ row }\">\r\n          <span class=\"text-xs font-black text-slate-800 tabular-nums\">\r\n            {{ format.currency(row.valor_unitario) }}\r\n          </span>\r\n        </template>\r\n\r\n        <template #cell-status=\"{ row }\">\r\n          <span\r\n            class=\"px-2 py-1 rounded text-[9px] font-black uppercase inline-flex items-center gap-1.5\"\r\n            :class=\"row.status === 'ATIVO'\r\n              ? 'bg-emerald-50 text-emerald-600 border border-emerald-100'\r\n              : 'bg-slate-50 text-slate-500 border border-slate-100'\"\r\n          >\r\n            <span class=\"w-1.5 h-1.5 rounded-full bg-current\"></span>\r\n            {{ row.status || 'INATIVO' }}\r\n          </span>\r\n        </template>\r\n\r\n        <template #cell-acoes=\"{ row }\">\r\n          <div class=\"flex justify-end gap-1 px-2\">\r\n            <button\r\n  v-if=\"can('produtos.editar')\"\r\n  @click=\"router.push(`/produtos/${row.id}`)\"\r\n              class=\"w-7 h-7 rounded-lg bg-slate-100 text-slate-500 hover:bg-brand-primary hover:text-white transition-all flex items-center justify-center\"\r\n            >\r\n              <i class=\"pi pi-pencil text-[10px]\"></i>\r\n            </button>\r\n\r\n            <button\r\n  v-if=\"can('produtos.excluir')\"\r\n  @click=\"confirmarExcluirProduto(row)\"\r\n              class=\"w-7 h-7 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center\"\r\n            >\r\n              <i class=\"pi pi-trash text-[10px]\"></i>\r\n            </button>\r\n          </div>\r\n        </template>\r\n      </Table>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport api from '@/services/api'\r\nimport { useRouter } from 'vue-router'\r\nimport { confirm } from '@/services/confirm'\r\nimport { notify } from '@/services/notify'\r\nimport { format } from '@/utils/format'\r\nimport { can } from '@/services/permissions'\r\n\r\n\r\ndefinePage({ meta: { perm: 'produtos.ver' } })\r\n\r\n\r\nconst produtos = ref([])\r\nconst loading = ref(false)\r\nconst router = useRouter()\r\nconst filtro = ref('')\r\n\r\nconst columns = [\r\n  { key: 'nome_produto', label: 'PRODUTO / REF', width: '34%' },\r\n  { key: 'fornecedor_nome', label: 'FORNECEDOR', width: '24%' },\r\n  { key: 'unidade', label: 'UN', width: '8%', align: 'center' },\r\n\r\n  // ✅ só valor unitário\r\n  { key: 'valor_unitario', label: 'VLR UNIT', width: '14%', align: 'right' },\r\n\r\n  { key: 'status', label: 'STATUS', width: '10%', align: 'center' },\r\n  { key: 'acoes', label: '', width: '10%', align: 'right' }\r\n]\r\n\r\nconst filtrados = computed(() => {\r\n  const f = String(filtro.value || '').trim().toUpperCase()\r\n  if (!f) return produtos.value || []\r\n\r\n  return (produtos.value || []).filter((p) => {\r\n    const nome = String(p.nome_produto || '').toUpperCase()\r\n    const fornecedor = String(p.fornecedor?.razao_social || p.fornecedor?.nome_fantasia || '').toUpperCase()\r\n    const cor = String(p.cor || '').toUpperCase()\r\n    const medida = String(p.medida || '').toUpperCase() // “metragem”/medida\r\n    const marca = String(p.marca || '').toUpperCase()   // opcional, mas ajuda\r\n    const id = String(p.id || '').toUpperCase()\r\n\r\n    const alvo = `${nome} ${fornecedor} ${cor} ${medida} ${marca} ${id}`\r\n\r\n    return alvo.includes(f)\r\n  })\r\n})\r\n\r\n\r\nconst rows = computed(() => {\r\n  return filtrados.value.map((p) => ({\r\n    ...p,\r\n    fornecedor_nome: p.fornecedor?.razao_social || p.fornecedor?.nome_fantasia || '-',\r\n    valor_unitario: Number(p.valor_unitario || 0),\r\n  }))\r\n})\r\n\r\nconst totalItens = computed(() => filtrados.value.length)\r\nconst totalAtivos = computed(() => filtrados.value.filter(p => p.status === 'ATIVO').length)\r\n\r\nasync function buscarDadosDoBanco() {\r\n  loading.value = true\r\n  try {\r\n    const resp = await api.get('/produtos')\r\n    produtos.value = resp.data || []\r\n  } catch (err) {\r\n    console.error('Erro ao buscar produtos:', err?.response || err)\r\n    notify.error('Erro ao carregar produtos.')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nasync function confirmarExcluirProduto(row) {\r\n  if (!can('produtos.excluir')) return notify.error('Acesso negado.')\r\n  const ok = await confirm.show(\r\n    'Excluir Produto',\r\n    `Deseja excluir o produto \"${row?.nome_produto}\"? Esta ação não pode ser desfeita.`,\r\n  )\r\n  if (!ok) return\r\n\r\n  try {\r\n    await api.delete(`/produtos/${row.id}`)\r\n    produtos.value = produtos.value.filter(p => p.id !== row.id)\r\n    notify.success('Produto excluído!')\r\n  } catch (err) {\r\n    notify.error('Erro ao excluir.')\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  if (!can('produtos.ver')) {\r\n    notify.error('Acesso negado.')\r\n    router.push('/') // ou '/produtos' se preferir voltar pra lista, mas aqui é a própria\r\n    return\r\n  }\r\n\r\n  await buscarDadosDoBanco()\r\n})\r\n\r\n</script>\r\n"],"names":["produtos","ref","loading","router","useRouter","filtro","columns","filtrados","computed","f","p","nome","fornecedor","_a","_b","cor","medida","marca","id","rows","totalItens","totalAtivos","buscarDadosDoBanco","resp","api","err","notify","confirmarExcluirProduto","row","can","confirm","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","$event","_unref","_createBlock","_component_Button","_cache","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_hoisted_10","_createVNode","_component_Table","_withCtx","_hoisted_11","_hoisted_12","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","format","_normalizeClass","_hoisted_19"],"mappings":"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"}