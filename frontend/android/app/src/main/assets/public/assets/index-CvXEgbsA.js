import{f as h,g as b,h as je,P as T,j as Oe,i as Fe,r as w,E as $,o as s,A as E,e as f,b as o,c,d as S,u as g,m as u,l as D,t as n,F as A,n as C,H as I,a9 as Me,T as Le,a2 as Ue,ae as U,s as N,q as Z}from"./index-CH22lQIC.js";const Be={class:"p-6 relative"},He={key:1,class:"space-y-8"},ze={class:"flex flex-col md:flex-row gap-4 items-end justify-between bg-slate-50/50 p-4 rounded-3xl border border-slate-100"},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full md:w-2/3"},Ye={class:"flex items-center gap-2"},Qe={class:"grid grid-cols-2 md:grid-cols-4 gap-6 px-2"},qe={class:"text-2xl font-black text-slate-800 tracking-tighter italic"},Ze={class:"text-2xl font-black text-emerald-600 tracking-tighter italic"},Ge={key:0,class:"bg-amber-50/40 p-6 rounded-[2.5rem] border border-amber-100"},Ke={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3"},Je=["onClick"],We={class:"text-[9px] font-black text-slate-400 uppercase tracking-tighter"},Xe={class:"text-[9px] text-slate-400 mt-2 italic italic"},et={class:"space-y-4"},tt={class:"flex items-center justify-between px-2"},at={class:"text-[11px] font-black uppercase tracking-[0.25em] text-slate-400"},ot={class:"overflow-x-auto pb-4 custom-scrollbar"},it={class:"min-w-[1100px] space-y-3"},rt={class:"grid grid-cols-7 gap-3"},st={class:"text-[9px] font-black uppercase opacity-50 tracking-[0.2em] mb-1"},nt={class:"text-sm font-black italic tracking-tight"},lt={class:"absolute -right-2 -bottom-2 opacity-10 text-4xl font-black italic select-none"},ct=["onDblclick"],ut={class:"flex justify-between items-center mb-2 px-1"},dt={class:"text-[10px] font-black text-slate-300 uppercase italic tracking-widest"},mt=["onClick"],ft={class:"space-y-2"},pt=["onClick"],gt={class:"flex justify-between items-start mb-1"},_t={class:"text-[10px] font-black text-slate-800 leading-tight uppercase truncate pr-4"},vt={class:"text-[9px] font-black text-slate-400 uppercase"},bt=["onClick"],xt={class:"flex flex-col gap-1 text-[9px] font-bold"},ht={class:"text-slate-400 flex items-center gap-1"},yt={class:"text-emerald-600 font-black tracking-tight"},kt={class:"mt-1 flex items-center gap-1"},St={class:"px-1.5 py-0.5 rounded-md bg-slate-200 text-slate-600 text-[8px] uppercase font-black"},Tt={class:"w-full max-w-2xl bg-white rounded-[3rem] shadow-2xl overflow-hidden border border-white/20"},wt={class:"p-8 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center"},Et={class:"text-xl font-black italic uppercase text-slate-800 tracking-tight"},Nt={key:0,class:"col-span-12"},$t={class:"col-span-12 md:col-span-6"},Dt={class:"col-span-12 md:col-span-6"},At={class:"col-span-12"},Ct={class:"col-span-12 md:col-span-6"},It={class:"col-span-12 md:col-span-6"},Vt={class:"col-span-12 flex justify-end gap-3 mt-6"},Ot={__name:"index",setup(Pt){const le=["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00"],ce=[{label:"PENDENTE",value:"PENDENTE"},{label:"EM_ANDAMENTO",value:"EM_ANDAMENTO"},{label:"FINALIZADA",value:"FINALIZADA"},{label:"CANCELADA",value:"CANCELADA"}];function m(e){return String(e).padStart(2,"0")}function ue(){const e=new Date;return`${e.getFullYear()}-${m(e.getMonth()+1)}-${m(e.getDate())}`}function V(e,t){const i=new Date(`${e}T00:00:00`);return i.setDate(i.getDate()+Number(t||0)),`${i.getFullYear()}-${m(i.getMonth()+1)}-${m(i.getDate())}`}function de(e){return new Date(`${e}T00:00:00`).toISOString()}function me(e){return new Date(`${e}T23:59:59`).toISOString()}function fe(e){return String(e??"").toLowerCase().trim()}function P(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":`${t.getFullYear()}-${m(t.getMonth()+1)}-${m(t.getDate())}T${m(t.getHours())}:${m(t.getMinutes())}`}function j(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}function pe(e,t){return new Date(`${e}T${t}:00`).toISOString()}function ge(e,t=2){const i=new Date(e);return i.setHours(i.getHours()+t),i.toISOString()}function _e(e,t){const i=new Date(e),l=i.getFullYear(),_=m(i.getMonth()+1),v=m(i.getDate());return`${l}-${_}-${v}`===t}function ve(e){const t=new Date(e);return`${m(t.getHours())}:${m(t.getMinutes())}`}const B=h(!0),H=h(!1),p=h(ue()),G=b(()=>V(p.value,6)),z=h(""),O=h([]),K=h([]),J=b(()=>(O.value||[]).filter(e=>e.encaminhado_em&&(!e.tarefas||e.tarefas.length===0))),a=je({open:!1,isEdit:!1,tarefaId:null,origem_tipo:"",origem_id:0,funcionario_id:null,titulo:"",status:"PENDENTE",observacao:"",inicio_em:"",fim_em:""}),F=h(!1),R=h(!1),W=b(()=>{const e=p.value,t=["Seg","Ter","Qua","Qui","Sex","Sáb","Dom"];return[0,1,2,3,4,5].map(i=>({key:`${e}-${i}`,label:t[i],date:V(e,i)}))}),be=b(()=>`${T.date(p.value)} → ${T.date(G.value)}`),xe=b(()=>(O.value||[]).map(e=>({label:`${e.codigo?e.codigo+" · ":""}${e.origem_tipo} #${e.origem_id}`,value:`${e.origem_tipo}::${e.origem_id}`})));function he(e){const t=String(e||""),[i,l]=t.split("::");a.origem_tipo=String(i||"").trim(),a.origem_id=Number(l||0)}const X=b(()=>{const e=[];for(const t of O.value||[]){const i=ye(t);for(const l of t.tarefas||[])e.push({...l,origem_tipo:t.origem_tipo,origem_id:t.origem_id,codigo:t.codigo,titulo_auto:i})}return e});function ye(e){var _,v,k,M,r,x,d,L,ae,oe,ie,re,se,ne;const t=((k=(v=(_=e==null?void 0:e.venda_item)==null?void 0:_.venda)==null?void 0:v.cliente)==null?void 0:k.nome_fantasia)||((x=(r=(M=e==null?void 0:e.venda_item)==null?void 0:M.venda)==null?void 0:r.cliente)==null?void 0:x.nome_completo)||((ae=(L=(d=e==null?void 0:e.venda_item)==null?void 0:d.venda)==null?void 0:L.cliente)==null?void 0:ae.razao_social)||"",i=((oe=e==null?void 0:e.venda_item)==null?void 0:oe.nome_ambiente)||"";if(t||i)return[t,i].filter(Boolean).join(" · ");const l=((re=(ie=e==null?void 0:e.plano_corte)==null?void 0:ie.fornecedor)==null?void 0:re.nome_fantasia)||((ne=(se=e==null?void 0:e.plano_corte)==null?void 0:se.fornecedor)==null?void 0:ne.razao_social)||"";return l?`PLANO DE CORTE · ${l}`:`${e.codigo||""} ${e.origem_tipo} #${e.origem_id}`.trim()}function ke(e){if(!u("producao.criar"))return N.error("Acesso negado.");a.open=!0,a.isEdit=!1,a.tarefaId=null,a.origem_tipo=e.origem_tipo,a.origem_id=e.origem_id,a._origem_key=`${e.origem_tipo}::${e.origem_id}`,a.funcionario_id=null,a.titulo="",a.status="PENDENTE",a.observacao="",a.inicio_em="",a.fim_em=""}const Y=b(()=>{const e=fe(z.value);return e?X.value.filter(t=>{var l;return`${t.id} ${t.titulo} ${t.status} ${((l=t.funcionario)==null?void 0:l.nome)||""} ${t.funcionario_id} ${t.origem_tipo} ${t.origem_id}`.toLowerCase().includes(e)}):X.value}),Se=b(()=>Y.value.reduce((e,t)=>e+Number(t.custo_total||0),0));function Te(e,t){return Y.value.filter(i=>!i.inicio_em||!_e(i.inicio_em,e)?!1:ve(i.inicio_em).slice(0,2)===t.slice(0,2))}async function we(e=""){if(!u("funcionarios.select"))return;const{data:t}=await Ue.select(e);K.value=Array.isArray(t)?t:[]}async function y(){if(u("producao.ver")){H.value=!0;try{const e=de(p.value),t=me(G.value),{data:i}=await U.getAgenda(e,t);O.value=Array.isArray(i)?i:[]}finally{H.value=!1,B.value=!1}}}async function Ee(){const e=a.isEdit?"producao.editar":"producao.criar";if(!u(e))return N.error("Acesso negado.");!q.value||!await Z.show(a.isEdit?"Salvar Alterações":"Criar Tarefa",a.isEdit?`Deseja salvar as alterações da tarefa "${a.titulo}"?`:`Deseja criar a tarefa "${a.titulo}"?`)||await Pe()}async function Ne(e){if(!u("producao.excluir"))return N.error("Acesso negado.");if(!(!(e!=null&&e.id)||R.value||!await Z.show("Excluir Tarefa",`Deseja excluir a tarefa "${e.titulo}"? Esta ação não pode ser desfeita.`))){R.value=!0;try{await U.tarefas.remover(e.id),await y()}finally{R.value=!1}}}async function Q(){await Z.show("Fechar","Deseja fechar o formulário da tarefa?")&&te()}function $e(){p.value=V(p.value,-7),y()}function De(){p.value=V(p.value,7),y()}function Ae(){if(!u("producao.criar"))return N.error("Acesso negado.");a.open=!0,a.isEdit=!1,a.tarefaId=null,a.origem_tipo="",a.origem_id=0,a._origem_key="",a.funcionario_id=null,a.titulo="",a.status="PENDENTE",a.observacao="",a.inicio_em="",a.fim_em=""}function ee(e,t){if(!u("producao.criar"))return N.error("Acesso negado.");const i=pe(e,t),l=ge(i,2);a.open=!0,a.isEdit=!1,a.tarefaId=null,a.origem_tipo="",a.origem_id=0,a._origem_key="",a.funcionario_id=null,a.titulo="",a.status="PENDENTE",a.observacao="",a.inicio_em=P(i),a.fim_em=P(l)}function Ce(e){if(!u("producao.editar"))return N.error("Acesso negado.");a.open=!0,a.isEdit=!0,a.tarefaId=e.id,a.funcionario_id=e.funcionario_id??null,a.titulo=e.titulo??"",a.status=e.status??"PENDENTE",a.observacao=e.observacao??"",a.inicio_em=P(e.inicio_em),a.fim_em=P(e.fim_em)}function te(){a.open=!1}const q=b(()=>!(F.value||!String(a.origem_tipo||"").trim()||!Number(a.origem_id||0)||!String(a.titulo||"").trim()||!String(a.inicio_em||"").trim()||!String(a.fim_em||"").trim()));function Ie(){return{origem_tipo:String(a.origem_tipo||"").trim(),origem_id:Number(a.origem_id||0),funcionario_id:a.funcionario_id?Number(a.funcionario_id):null,titulo:String(a.titulo||"").trim(),status:String(a.status||"PENDENTE").trim(),observacao:a.observacao?String(a.observacao).trim():null,inicio_em:j(a.inicio_em),fim_em:j(a.fim_em)}}function Ve(){return{funcionario_id:Number(a.funcionario_id),titulo:String(a.titulo||"").trim(),status:String(a.status||"PENDENTE").trim(),observacao:a.observacao?String(a.observacao).trim():null,inicio_em:j(a.inicio_em),fim_em:j(a.fim_em)}}async function Pe(){if(q.value){F.value=!0;try{a.isEdit&&a.tarefaId?await U.tarefas.atualizar(a.tarefaId,Ve()):await U.tarefas.criar(Ie()),te(),await y()}finally{F.value=!1}}}return Oe(()=>p.value,async()=>{B.value||await y()}),Fe(async()=>{await we(),await y()}),(e,t)=>{const i=w("PageHeader"),l=w("Loading"),_=w("Input"),v=w("SearchInput"),k=w("Button"),M=w("Card");return s(),$(M,{shadow:!0,class:"overflow-visible"},{default:E(()=>[f(i,{title:"Agenda de Produção",subtitle:"Chão de fábrica: grade semanal de tarefas.",icon:"pi pi-calendar",backTo:"/"}),o("div",Be,[B.value?(s(),$(l,{key:0})):(s(),c("div",He,[o("section",ze,[o("div",Re,[f(_,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=r=>p.value=r),type:"date",label:"Semana (início) *"},null,8,["modelValue"]),f(v,{modelValue:z.value,"onUpdate:modelValue":t[1]||(t[1]=r=>z.value=r),mode:"search",label:"Buscar",placeholder:"Título, status, funcionário..."},null,8,["modelValue"])]),o("div",Ye,[o("div",{class:"flex bg-white rounded-2xl border border-slate-200 p-1 shadow-sm"},[o("button",{onClick:$e,class:"p-2 hover:bg-slate-100 rounded-xl transition-colors text-slate-600"},"◀"),o("button",{onClick:De,class:"p-2 hover:bg-slate-100 rounded-xl transition-colors text-slate-600"},"▶")]),g(u)("producao.ver")?(s(),$(k,{key:0,variant:"secondary",loading:H.value,onClick:y},{default:E(()=>[...t[8]||(t[8]=[o("i",{class:"pi pi-refresh"},null,-1)])]),_:1},8,["loading"])):S("",!0),g(u)("producao.criar")?(s(),$(k,{key:1,variant:"primary",onClick:Ae},{default:E(()=>[...t[9]||(t[9]=[D(" + Nova Tarefa ",-1)])]),_:1})):S("",!0)])]),o("section",Qe,[o("header",null,[t[10]||(t[10]=o("p",{class:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400"},"Tarefas (Filtro)",-1)),o("p",qe,n(Y.value.length),1)]),o("header",null,[t[11]||(t[11]=o("p",{class:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400"},"Custo Total",-1)),o("p",Ze,n(g(T).currency(Se.value)),1)])]),J.value.length?(s(),c("section",Ge,[t[13]||(t[13]=o("h3",{class:"text-[11px] font-black uppercase tracking-widest text-amber-600 mb-4 flex items-center gap-2"},[o("span",{class:"w-2 h-2 rounded-full bg-amber-500 animate-pulse"}),D(" Projetos Encaminhados (Sem Tarefas) ")],-1)),o("div",Ke,[(s(!0),c(A,null,C(J.value,r=>(s(),c("button",{key:r.id,onClick:x=>ke(r),class:"group bg-white p-4 rounded-2xl border border-slate-200 hover:border-amber-400 hover:shadow-lg transition-all text-left"},[o("p",We,n(r.origem_tipo)+" #"+n(r.origem_id),1),t[12]||(t[12]=o("p",{class:"text-xs font-bold text-slate-700 mt-1 group-hover:text-amber-700"},"Agendar 1ª Tarefa",-1)),o("p",Xe,"Encaminhado em: "+n(g(T).date(r.encaminhado_em)),1)],8,Je))),128))])])):S("",!0),o("section",et,[o("div",tt,[o("h3",at,"Semana: "+n(be.value),1)]),o("div",ot,[o("div",it,[o("div",rt,[(s(!0),c(A,null,C(W.value,r=>(s(),c("div",{key:r.key,class:"p-4 bg-slate-900 rounded-3xl text-white shadow-xl shadow-slate-200 relative overflow-hidden"},[o("p",st,n(r.label),1),o("p",nt,n(g(T).date(r.date)),1),o("div",lt,n(r.label[0]),1)]))),128))]),(s(),c(A,null,C(le,r=>o("div",{key:r,class:"grid grid-cols-7 gap-3"},[(s(!0),c(A,null,C(W.value,x=>(s(),c("div",{key:x.key+"-"+r,onDblclick:d=>g(u)("producao.criar")&&ee(x.date,r),class:"group min-h-[140px] rounded-[2rem] border border-slate-100 bg-white p-3 hover:border-brand-primary/40 transition-all hover:shadow-md relative"},[o("header",ut,[o("span",dt,n(r),1),g(u)("producao.criar")?(s(),c("button",{key:0,onClick:I(d=>ee(x.date,r),["stop"]),class:"opacity-0 group-hover:opacity-100 text-brand-primary hover:scale-110 transition-all"},[...t[14]||(t[14]=[o("i",{class:"pi pi-plus-circle text-sm"},null,-1)])],8,mt)):S("",!0)]),o("div",ft,[(s(!0),c(A,null,C(Te(x.date,r),d=>(s(),c("div",{key:d.id,onClick:I(L=>g(u)("producao.editar")&&Ce(d),["stop"]),class:"p-2.5 rounded-2xl border border-slate-100 bg-slate-50/50 hover:bg-white hover:shadow-lg transition-all cursor-pointer group/task relative"},[o("div",gt,[o("p",_t,n(d.titulo_auto),1),o("span",vt,n(d.etapa),1),g(u)("producao.excluir")?(s(),c("button",{key:0,onClick:I(L=>Ne(d),["stop"]),class:"opacity-0 group-hover/task:opacity-100 text-rose-400 hover:text-rose-600 transition-opacity absolute top-2 right-2"},[...t[15]||(t[15]=[o("i",{class:"pi pi-times-circle text-[12px]"},null,-1)])],8,bt)):S("",!0)]),o("div",xt,[o("span",ht,[t[16]||(t[16]=o("i",{class:"pi pi-clock text-[8px]"},null,-1)),D(" "+n(Number(d.horas_total||0).toFixed(1))+"h ",1)]),o("span",yt,n(g(T).currency(Number(d.custo_total||0))),1),o("div",kt,[o("span",St,n(d.status),1)])])],8,pt))),128))])],40,ct))),128))])),64))])])])]))]),(s(),$(Me,{to:"body"},[f(Le,{name:"fade"},{default:E(()=>[a.open?(s(),c("div",{key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",onClick:I(Q,["self"])},[o("div",Tt,[o("header",wt,[o("div",null,[t[17]||(t[17]=o("p",{class:"text-[10px] font-black uppercase tracking-[0.4em] text-slate-400 mb-1"},"Gestão de Fábrica",-1)),o("h3",Et,n(a.isEdit?"Editar Detalhes":"Agendar Nova Tarefa"),1)]),o("button",{onClick:Q,class:"w-12 h-12 rounded-full bg-white border border-slate-200 flex items-center justify-center hover:bg-rose-50 hover:text-rose-500 transition-all shadow-sm"},[...t[18]||(t[18]=[o("i",{class:"pi pi-times"},null,-1)])])]),o("form",{class:"p-8 grid grid-cols-12 gap-5",onSubmit:I(Ee,["prevent"])},[a.isEdit?S("",!0):(s(),c("div",Nt,[f(v,{modelValue:a._origem_key,"onUpdate:modelValue":[t[2]||(t[2]=r=>a._origem_key=r),he],mode:"select",label:"Vincular ao Projeto/Origem *",placeholder:"Selecione o projeto de origem...",options:xe.value},null,8,["modelValue","options"])])),o("div",$t,[f(v,{modelValue:a.funcionario_id,"onUpdate:modelValue":t[3]||(t[3]=r=>a.funcionario_id=r),mode:"select",label:"Responsável",placeholder:"Quem vai executar?",options:K.value},null,8,["modelValue","options"])]),o("div",Dt,[f(v,{modelValue:a.status,"onUpdate:modelValue":t[4]||(t[4]=r=>a.status=r),mode:"select",label:"Status Atual *",options:ce},null,8,["modelValue"])]),o("div",At,[f(_,{modelValue:a.observacao,"onUpdate:modelValue":t[5]||(t[5]=r=>a.observacao=r),label:"Observações / Instruções",placeholder:"Detalhes técnicos..."},null,8,["modelValue"])]),o("div",Ct,[f(_,{modelValue:a.inicio_em,"onUpdate:modelValue":t[6]||(t[6]=r=>a.inicio_em=r),type:"datetime-local",label:"Início Previsto *"},null,8,["modelValue"])]),o("div",It,[f(_,{modelValue:a.fim_em,"onUpdate:modelValue":t[7]||(t[7]=r=>a.fim_em=r),type:"datetime-local",label:"Finalização Prevista *"},null,8,["modelValue"])]),o("footer",Vt,[f(k,{variant:"secondary",type:"button",onClick:Q},{default:E(()=>[...t[19]||(t[19]=[D("Descartar",-1)])]),_:1}),f(k,{variant:"primary",type:"submit",loading:F.value,disabled:!q.value},{default:E(()=>[t[20]||(t[20]=o("i",{class:"pi pi-check mr-2"},null,-1)),D(" "+n(a.isEdit?"Salvar Alterações":"Confirmar Agendamento"),1)]),_:1},8,["loading","disabled"])])],32)])])):S("",!0)]),_:1})]))]),_:1})}}};export{Ot as default};
//# sourceMappingURL=index-CvXEgbsA.js.map
