import{g,f as m,ab as s,a6 as v}from"./index-CH22lQIC.js";const d="ACASA_SESSION_ALIVE",u=m(s.getToken()),i=m(s.getUser()),r=m(!1),l=m("");u.value&&!sessionStorage.getItem(d)?(s.removeToken(),s.removeUser(),u.value=null,i.value=null,window.location.href="/login"):u.value&&sessionStorage.setItem(d,"1");const k=()=>{var h,c,f;return((c=(h=window.matchMedia)==null?void 0:h.call(window,"(display-mode: standalone)"))==null?void 0:c.matches)||((f=window.navigator)==null?void 0:f.standalone)===!0};window.__ACASA_HIDE_LOGOUT_BOUND__||(window.__ACASA_HIDE_LOGOUT_BOUND__=!0,window.addEventListener("pagehide",()=>{k()&&u.value&&(fetch("/api/auth/logout",{method:"POST",credentials:"include",keepalive:!0}).catch(()=>{}),sessionStorage.removeItem(d),s.removeToken(),s.removeUser(),u.value=null,i.value=null)}));function E(){const h=g(()=>!!u.value),c=g(()=>{const t=i.value;return Array.isArray(t==null?void 0:t.permissoes)?t.permissoes:[]}),f=t=>{const a=i.value;return a?a.usuario==="Ana.P"||c.value.includes("ADMIN")?!0:c.value.includes(t):!1};async function w({usuario:t,senha:a}){var o,e;r.value=!0,l.value="";try{const{data:n}=await v.post("/auth/login",{usuario:t,senha:a});return s.setToken(n.token),s.setUser(n.usuario),sessionStorage.setItem(d,"1"),u.value=n.token,i.value=n.usuario,n}catch(n){throw l.value=((e=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:e.message)||"Credenciais inválidas",n}finally{r.value=!1}}async function p(t){var a,o;r.value=!0;try{const{data:e}=await v.post("/auth/cadastro",t);return e}catch(e){throw l.value=((o=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao solicitar cadastro",e}finally{r.value=!1}}async function y(t){var a,o;r.value=!0,l.value="";try{const{data:e}=await v.post("/auth/esqueci-senha",{email:t});return e}catch(e){throw l.value=((o=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao enviar recuperação",e}finally{r.value=!1}}async function A(t){var a,o;r.value=!0,l.value="";try{const{data:e}=await v.post("/auth/alterar-senha",t);return e}catch(e){throw l.value=((o=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao alterar senha",e}finally{r.value=!1}}async function S(){if(!s.getToken())return null;const{data:a}=await v.get("/auth/me");return s.setUser(a),i.value=a,a}async function _(){try{await v.post("/auth/logout")}catch{}sessionStorage.removeItem(d),s.removeToken(),s.removeUser(),u.value=null,i.value=null,window.location.href="/login"}return{token:u,usuarioLogado:i,isAuthenticated:h,loading:r,error:l,login:w,logout:_,solicitarCadastro:p,esqueciSenha:y,alterarSenha:A,temAcesso:f,permissoes:c,syncMe:S}}export{E as u};
//# sourceMappingURL=useauth-BQLIh4i2.js.map
