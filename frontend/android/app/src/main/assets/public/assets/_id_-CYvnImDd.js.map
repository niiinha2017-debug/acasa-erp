{"version":3,"file":"_id_-CYvnImDd.js","sources":["../../src/pages/arquivos/[id].vue"],"sourcesContent":["<template>\r\n  <div class=\"w-full min-h-[70vh] animate-page-in\">\r\n    <div class=\"w-full max-w-[1200px] mx-auto p-4 space-y-3\">\r\n      <div class=\"flex items-center justify-between gap-3\">\r\n        <Button variant=\"secondary\" size=\"md\" class=\"!h-10\" @click=\"voltar\">\r\n          <i class=\"pi pi-arrow-left mr-2 text-xs\"></i> Voltar\r\n        </Button>\r\n\r\n        <div class=\"flex items-center gap-2\">\r\n          <Button variant=\"secondary\" size=\"md\" class=\"!h-10\" @click=\"zoomOut\">-</Button>\r\n          <div class=\"px-3 h-10 flex items-center rounded-xl border border-slate-200 text-xs font-black\">\r\n            {{ Math.round(zoom * 100) }}%\r\n          </div>\r\n          <Button variant=\"secondary\" size=\"md\" class=\"!h-10\" @click=\"zoomIn\">+</Button>\r\n\r\n          <Button variant=\"primary\" size=\"md\" class=\"!h-10\" @click=\"download\" :disabled=\"!blobUrl\">\r\n            <i class=\"pi pi-download mr-2 text-xs\"></i> Download\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <Card>\r\n        <div class=\"p-4 border-b border-slate-100\">\r\n          <div class=\"text-sm font-black text-slate-800 truncate\">{{ nomeArquivo }}</div>\r\n          <div class=\"text-[10px] font-bold text-slate-400 uppercase tracking-wider\">\r\n            {{ mimeFinal || 'ARQUIVO' }}\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"p-4 overflow-auto\">\r\n          <div v-if=\"loading\" class=\"p-10 text-center text-slate-400 text-[10px] font-black uppercase tracking-widest\">\r\n            Carregando...\r\n          </div>\r\n\r\n          <div v-else-if=\"erro\" class=\"p-6 rounded-xl border border-rose-100 bg-rose-50 text-rose-600 text-[10px] font-black uppercase tracking-widest\">\r\n            {{ erro }}\r\n          </div>\r\n\r\n          <div v-else class=\"flex justify-center\">\r\n            <img\r\n              v-if=\"isImage\"\r\n              :src=\"blobUrl\"\r\n              :style=\"{ transform: `scale(${zoom})` }\"\r\n              class=\"origin-top\"\r\n              alt=\"arquivo\"\r\n            />\r\n\r\n            <iframe\r\n              v-else-if=\"isPdf\"\r\n              :src=\"blobUrl\"\r\n              class=\"w-full\"\r\n              style=\"height: 75vh;\"\r\n            />\r\n\r\n            <div v-else class=\"p-10 text-center text-slate-500 text-[10px] font-black uppercase tracking-widest\">\r\n              Visualização não suportada. Use Download.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed, onBeforeUnmount, onMounted, ref } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ArquivosService } from '@/services/index'\r\nimport { notify } from '@/services/notify'\r\n\r\ndefinePage({ meta: { perm: 'arquivos.ver' } })\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst mimeDetectado = ref('')\r\n\r\n\r\nconst id = computed(() => String(route.params.id || '').replace(/\\D/g, ''))\r\n\r\nconst nomeArquivo = computed(() => String(route.query.name || `ARQUIVO_${id.value}`))\r\nconst mimeType = computed(() => String(route.query.type || ''))\r\n\r\nconst mimeFinal = computed(() => (mimeDetectado.value || mimeType.value || '').toLowerCase())\r\n\r\nconst isImage = computed(() => mimeFinal.value.startsWith('image/'))\r\nconst isPdf = computed(() => mimeFinal.value.includes('pdf'))\r\n\r\n\r\nconst loading = ref(false)\r\nconst erro = ref('')\r\nconst blobUrl = ref('')\r\nconst zoom = ref(1)\r\n\r\nfunction zoomIn() { zoom.value = Math.min(3, zoom.value + 0.1) }\r\nfunction zoomOut() { zoom.value = Math.max(0.3, zoom.value - 0.1) }\r\n\r\nfunction voltar() {\r\n  router.back()\r\n}\r\n\r\nasync function carregarBlob() {\r\n  if (!id.value) {\r\n    erro.value = 'ID inválido.'\r\n    return\r\n  }\r\n\r\n  loading.value = true\r\n  erro.value = ''\r\n  try {\r\n    const res = await ArquivosService.baixarBlob(id.value)\r\nconst contentType = String(res?.headers?.['content-type'] || mimeType.value || 'application/octet-stream')\r\nmimeDetectado.value = contentType\r\n\r\n    const blob = new Blob([res.data], { type: contentType })\r\n    blobUrl.value = URL.createObjectURL(blob)\r\n  } catch (e) {\r\n    console.error(e)\r\n    erro.value = 'Falha ao abrir arquivo.'\r\n    notify.error('Falha ao abrir arquivo.')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nfunction download() {\r\n  if (!blobUrl.value) return\r\n  const a = document.createElement('a')\r\n  a.href = blobUrl.value\r\n  a.download = nomeArquivo.value || 'arquivo'\r\n  a.click()\r\n}\r\n\r\nonMounted(carregarBlob)\r\n\r\nonBeforeUnmount(() => {\r\n  if (blobUrl.value) URL.revokeObjectURL(blobUrl.value)\r\n})\r\n</script>\r\n  "],"names":["route","useRoute","router","useRouter","mimeDetectado","ref","id","computed","nomeArquivo","mimeType","mimeFinal","isImage","isPdf","loading","erro","blobUrl","zoom","zoomIn","zoomOut","voltar","carregarBlob","res","ArquivosService","contentType","_a","blob","notify","download","a","onMounted","onBeforeUnmount","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_Button","_cache","_hoisted_4","_hoisted_5","_toDisplayString","_component_Card","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_15"],"mappings":"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"}