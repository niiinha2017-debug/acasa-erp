import{y as Q,f as u,g as V,ac as W,i as Y,S as Z,r as m,c as B,o as x,e as n,A as c,b as t,u as w,l as b,t as C,E as I,d as _,m as v,s as f,ad as N,q as ee}from"./index-CH22lQIC.js";const ae={class:"w-full max-w-[1400px] mx-auto space-y-6"},te={class:"px-6 py-5 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between"},oe={class:"p-6 space-y-6"},le={class:"grid grid-cols-12 gap-6"},se={class:"col-span-12 md:col-span-6"},ne={class:"col-span-12 md:col-span-6"},de={class:"rounded-2xl border border-slate-200 bg-white p-5"},re={class:"flex items-center justify-between mb-4"},ie={class:"min-w-0"},ue={class:"text-[10px] font-black uppercase tracking-widest text-slate-500"},ce={class:"text-[10px] font-bold text-slate-400 uppercase tracking-wider"},pe={class:"flex items-center gap-2"},me={class:"grid grid-cols-12 gap-x-6 gap-y-5"},ve={class:"col-span-12 md:col-span-7"},xe={class:"col-span-12 md:col-span-5"},be={class:"col-span-12 md:col-span-4"},fe={class:"col-span-12 md:col-span-4"},_e={class:"col-span-12 md:col-span-4"},ge={class:"col-span-12"},ke={class:"rounded-2xl border border-slate-100 bg-slate-50/50 p-4"},ye={key:0,class:"col-span-12"},he={class:"rounded-xl border border-rose-100 bg-rose-50 px-4 py-3"},Ve={class:"text-[10px] font-black uppercase tracking-widest text-rose-600"},we={class:"rounded-2xl border border-slate-200 overflow-hidden"},Ce={class:"px-4 py-3 bg-slate-50 border-b border-slate-200 flex items-center justify-between"},Ie={class:"flex justify-end gap-2"},Ee={__name:"index",setup(Ae){const z=Q(),T=u([]),d=u(null),M=V(()=>T.value.map(a=>({label:a.razao_social,value:a.id}))),A=u(""),$=V(()=>(W||[]).map(a=>({label:a.label,value:a.key}))),g=u(!1),k=u([]),U=()=>o.value.id?"plano_corte.editar":"plano_corte.criar",S=u(!1),i=u(""),E=u(null),o=u({id:null,fornecedor_id:null,nome_produto:"",marca:"",cor:"",medida:"",unidade:"UN",status:"ATIVO"}),O=V(()=>!!d.value&&!!String(o.value.nome_produto||"").trim()&&!!o.value.unidade),F=[{key:"nome_produto",label:"Nome"},{key:"marca",label:"Marca",width:"160px"},{key:"cor",label:"Cor",width:"140px"},{key:"medida",label:"Medida",width:"140px"},{key:"unidade",label:"Un",width:"80px",align:"center"},{key:"status",label:"Status",width:"120px"},{key:"acoes",label:"",width:"200px",align:"right"}],D=V(()=>{const a=String(A.value||"").trim().toUpperCase();return a?k.value.filter(e=>`${e.nome_produto||""} ${e.marca||""} ${e.cor||""} ${e.medida||""}`.toUpperCase().includes(a)):k.value});function y(a=!0){i.value="",o.value={id:null,fornecedor_id:a?Number(d.value):null,nome_produto:"",marca:"",cor:"",medida:"",unidade:"UN",status:"ATIVO"}}async function X(a){d.value=a,y(!0),k.value=[],a&&await h()}async function h(){var a,e;if(!v("plano_corte.ver"))return f.error("Acesso negado.");if(d.value){g.value=!0,i.value="";try{const{data:s}=await N.itens.listar(Number(d.value));k.value=Array.isArray(s)?s:[]}catch(s){i.value=((e=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:e.message)||"Erro ao carregar itens."}finally{g.value=!1}}}function j(a){if(!v("plano_corte.editar"))return f.error("Acesso negado.");i.value="",o.value={id:a.id,fornecedor_id:Number(a.fornecedor_id||d.value),nome_produto:a.nome_produto||"",marca:a.marca||"",cor:a.cor||"",medida:a.medida||"",unidade:a.unidade||"UN",status:a.status||"ATIVO"},window.scrollTo({top:0,behavior:"smooth"})}function q(){y(!0)}async function P(){var e,s;const a=U();if(!v(a))return f.error("Acesso negado.");if(O.value){S.value=!0,i.value="";try{const r={fornecedor_id:Number(d.value),nome_produto:String(o.value.nome_produto||"").trim(),marca:String(o.value.marca||"").trim()||null,cor:String(o.value.cor||"").trim()||null,medida:String(o.value.medida||"").trim()||null,unidade:o.value.unidade||null,status:o.value.status||"ATIVO",quantidade:0,valor_unitario:0,valor_total:0};await N.itens.salvar(o.value.id,r),f.success(o.value.id?"Item atualizado!":"Item cadastrado!"),await h(),y(!0)}catch(r){i.value=((s=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:s.message)||"Erro ao salvar."}finally{S.value=!1}}}async function R(a){var s,r;if(!v("plano_corte.excluir"))return f.error("Acesso negado.");if(await ee.show("Excluir Item","Deseja excluir este item?")){E.value=a.id,i.value="";try{await N.itens.remover(a.id),f.success("Item removido!"),await h(),o.value.id===a.id&&y(!0)}catch(p){i.value=((r=(s=p==null?void 0:p.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao remover."}finally{E.value=null}}}return Y(async()=>{const{data:a}=await Z.listar();T.value=a||[]}),(a,e)=>{const s=m("Button"),r=m("SearchInput"),p=m("Input"),L=m("CustomCheckbox"),H=m("StatusBadge"),G=m("Table"),J=m("Card");return x(),B("div",ae,[n(J,{shadow:!0,class:"overflow-hidden"},{default:c(()=>[t("div",te,[e[10]||(e[10]=t("div",{class:"flex items-center gap-4"},[t("div",{class:"w-11 h-11 rounded-[1.1rem] bg-slate-900 flex items-center justify-center text-white shadow-lg"},[t("i",{class:"pi pi-box text-lg"})]),t("div",null,[t("h2",{class:"text-lg font-black text-slate-800 tracking-tight uppercase leading-none"}," Itens do Plano de Corte "),t("p",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1"}," Cadastro e edição por fornecedor ")])],-1)),n(s,{type:"button",variant:"secondary",size:"sm",class:"!h-10 !rounded-xl !px-4 text-[10px] font-black uppercase tracking-widest",onClick:e[0]||(e[0]=l=>w(z).back())},{default:c(()=>[...e[9]||(e[9]=[b(" Voltar ",-1)])]),_:1})]),t("div",oe,[t("div",le,[t("div",se,[n(r,{modelValue:d.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>d.value=l),X],mode:"select",label:"Fornecedor",options:M.value,required:""},null,8,["modelValue","options"])]),t("div",ne,[n(r,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=l=>A.value=l),mode:"search",label:"Buscar",placeholder:"Digite nome / marca / cor..."},null,8,["modelValue"])])]),t("div",de,[t("div",re,[t("div",ie,[t("p",ue,C(o.value.id?`Editando item #${o.value.id}`:"Novo item"),1),t("p",ce,C(d.value?`Fornecedor #${d.value}`:"Selecione um fornecedor para habilitar"),1)]),t("div",pe,[o.value.id?(x(),I(s,{key:0,type:"button",variant:"secondary",size:"sm",class:"!h-10 !rounded-xl !px-4 text-[10px] font-black uppercase tracking-widest",onClick:q},{default:c(()=>[...e[11]||(e[11]=[b(" Cancelar ",-1)])]),_:1})):_("",!0),w(v)(U())?(x(),I(s,{key:1,type:"button",variant:"primary",size:"sm",class:"!h-10 !rounded-xl !px-4 text-[10px] font-black uppercase tracking-widest",loading:S.value,disabled:!O.value,onClick:P},{default:c(()=>[b(C(o.value.id?"Salvar alterações":"Cadastrar"),1)]),_:1},8,["loading","disabled"])):_("",!0)])]),t("div",me,[t("div",ve,[n(p,{modelValue:o.value.nome_produto,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.nome_produto=l),label:"Nome do Produto",required:"",placeholder:"EX: MDF BRANCO TX"},null,8,["modelValue"])]),t("div",xe,[n(p,{modelValue:o.value.marca,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.marca=l),label:"Marca / Fabricante",placeholder:"EX: DURATEX"},null,8,["modelValue"])]),t("div",be,[n(p,{modelValue:o.value.cor,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.cor=l),label:"Cor / Acabamento",placeholder:"EX: BRANCO TX"},null,8,["modelValue"])]),t("div",fe,[n(p,{modelValue:o.value.medida,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.medida=l),label:"Espessura/Medida",placeholder:"EX: 18MM"},null,8,["modelValue"])]),t("div",_e,[n(r,{modelValue:o.value.unidade,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.unidade=l),mode:"select",label:"Unidade",options:$.value,placeholder:"SELECIONE...",required:""},null,8,["modelValue","options"])]),t("div",ge,[t("div",ke,[n(L,{label:"Ativo",description:"HABILITA ESTE ITEM PARA NOVOS PLANOS","model-value":o.value.status==="ATIVO","onUpdate:modelValue":e[8]||(e[8]=l=>o.value.status=l?"ATIVO":"INATIVO")},null,8,["model-value"])])]),i.value?(x(),B("div",ye,[t("div",he,[t("p",Ve,C(i.value),1)])])):_("",!0)])]),t("div",we,[t("div",Ce,[e[13]||(e[13]=t("span",{class:"text-[10px] font-black uppercase tracking-widest text-slate-500"}," Itens cadastrados ",-1)),n(s,{type:"button",variant:"ghost",size:"sm",class:"!h-8 !rounded-xl !px-3 text-[10px] font-black uppercase tracking-widest",loading:g.value,onClick:h,disabled:!d.value},{default:c(()=>[...e[12]||(e[12]=[b(" Atualizar ",-1)])]),_:1},8,["loading","disabled"])]),n(G,{columns:F,rows:D.value,loading:g.value,"empty-text":"Nenhum item encontrado."},{"cell-status":c(({row:l})=>[n(H,{value:l.status},null,8,["value"])]),"cell-acoes":c(({row:l})=>[t("div",Ie,[w(v)("plano_corte.editar")?(x(),I(s,{key:0,type:"button",variant:"ghost",size:"sm",class:"!h-8 !rounded-xl !px-3 text-[10px] font-black uppercase tracking-widest",onClick:K=>j(l)},{default:c(()=>[...e[14]||(e[14]=[b(" Editar ",-1)])]),_:1},8,["onClick"])):_("",!0),w(v)("plano_corte.excluir")?(x(),I(s,{key:1,type:"button",variant:"danger",size:"sm",class:"!h-8 !rounded-xl !px-3 text-[10px] font-black uppercase tracking-widest",loading:E.value===l.id,onClick:K=>R(l)},{default:c(()=>[...e[15]||(e[15]=[b(" Excluir ",-1)])]),_:1},8,["loading","onClick"])):_("",!0)])]),_:1},8,["rows","loading"])])])]),_:1})])}}};export{Ee as default};
//# sourceMappingURL=index-DYYHruhx.js.map
