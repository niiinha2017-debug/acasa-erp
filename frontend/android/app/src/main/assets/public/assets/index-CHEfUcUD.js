import{y as H,f,g as v,P as u,j as Q,i as J,r as w,c,o as i,b as e,k as K,E as W,d as $,w as X,v as Z,u as d,m as S,A as m,l as tt,t as r,e as B,F as R,n as T,p as et,Q as j,s as N,q as st}from"./index-CH22lQIC.js";const at={class:"w-full max-w-[1200px] mx-auto space-y-4 animate-page-in"},ot={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-2"},rt={class:"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto"},lt={class:"relative w-full sm:w-56"},nt={class:"grid grid-cols-2 lg:grid-cols-4 gap-3"},it={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},ct={class:"text-xl font-black text-slate-800"},dt={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},ut={class:"text-xl font-black text-slate-800"},pt={class:"p-4 rounded-xl bg-white border border-slate-200 shadow-sm"},mt={class:"text-xl font-black text-slate-800"},xt={class:"p-4 rounded-xl bg-emerald-50 border border-emerald-200 shadow-sm"},bt={class:"text-xl font-black text-emerald-700"},vt={class:"rounded-xl border border-slate-200 bg-white overflow-hidden shadow-sm"},_t={class:"py-1"},gt={class:"text-sm font-bold text-slate-800 block truncate"},ft={class:"flex items-center gap-2 mt-0.5"},ht={class:"text-[8px] font-bold text-slate-400"},kt={class:"scale-90"},yt={class:"text-sm font-bold text-slate-800 tabular-nums"},wt={class:"text-xs font-bold text-slate-600"},St={class:"flex justify-end gap-1"},Nt=["onClick"],Ct=["onClick"],Ft={class:"grid grid-cols-12 gap-4"},$t={class:"col-span-12 md:col-span-8"},Bt={key:0,class:"space-y-2"},Dt={class:"min-w-0"},Et={class:"text-xs font-black uppercase truncate"},Mt={class:"text-[10px] font-bold text-slate-400 uppercase"},Rt={class:"text-sm font-black text-slate-800 tabular-nums"},Tt={key:1,class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},jt={class:"col-span-12 md:col-span-4"},Vt={key:0,class:"space-y-2"},It={class:"text-xs font-black uppercase truncate"},Lt={class:"text-sm font-black text-slate-800 tabular-nums"},Ot={key:1,class:"text-xs font-bold text-slate-400 uppercase tracking-wider"},Ut={class:"border-t border-slate-200"},qt={__name:"index",setup(zt){const D=H(),_=f([]),C=f(!1),h=f(""),k=f(1),F=f(10),V=[{key:"fornecedor",label:"Fornecedor",width:"35%"},{key:"tipo_compra",label:"Tipo",width:"12%"},{key:"status",label:"Status",align:"center",width:"10%"},{key:"valor_total",label:"Valor",align:"right",width:"18%"},{key:"data_compra",label:"Data",align:"center",width:"15%"},{key:"acoes",label:"",align:"right",width:"10%"}];async function I(){C.value=!0;try{const s=await j.listar(),t=(s==null?void 0:s.data)??s;_.value=(Array.isArray(t)?t:[]).sort((o,l)=>l.id-o.id)}catch{N.error("Erro ao carregar compras.")}finally{C.value=!1}}function E(s){const t=s==null?void 0:s.fornecedor;return(t==null?void 0:t.nome_fantasia)||(t==null?void 0:t.razao_social)||`Fornecedor #${s.fornecedor_id}`}const L=v(()=>{const s=(k.value-1)*F.value;return x.value.slice(s,s+F.value)});function M(s){if(!s)return"";const t=String(s);return t.includes("T")?t.split("T")[0]:t}function O(s){const t=String(s||"").match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return"";const[,o,l,p]=t;return`${p}/${l}/${o}`}function U(s){const o=M(s).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!o)return null;const l=Number(o[1]),p=Number(o[2]),g=Number(o[3]);return new Date(l,p-1,g)}const x=v(()=>{const s=String(h.value||"").toLowerCase().trim();return s?_.value.filter(t=>{const o=M(t.data_compra),l=o,p=O(o),g=u.date(t.data_compra)||"",a=Number((t==null?void 0:t.valor_total)||0),b=isFinite(a)?a.toFixed(2):"",y=isFinite(a)?a.toLocaleString("pt-BR",{minimumFractionDigits:2}):"",n=isFinite(a)?u.currency(a):"";return[t.id,t.venda_id,E(t),t.status,t.tipo_compra,g,p,l,a,b,y,n].some(G=>String(G??"").toLowerCase().includes(s))}):_.value}),z=v(()=>x.value.reduce((s,t)=>s+Number(t.valor_total||0),0)),A=v(()=>x.value.filter(s=>s.tipo_compra==="INSUMOS").reduce((s,t)=>s+Number(t.valor_total||0),0)),P=v(()=>x.value.filter(s=>s.tipo_compra!=="INSUMOS").reduce((s,t)=>s+Number(t.valor_total||0),0)),q=v(()=>{const s=new Date().getMonth(),t=new Date().getFullYear();return x.value.filter(o=>{const l=U(o.data_compra);return l&&l.getMonth()===s&&l.getFullYear()===t}).reduce((o,l)=>o+Number(l.valor_total||0),0)});async function Y(s){if(!S("compras.excluir"))return N.error("Acesso negado.");if(await st.show("Excluir Compra","Esta aÃ§Ã£o nÃ£o pode ser desfeita. Deseja continuar?"))try{await j.remover(s),_.value=_.value.filter(o=>o.id!==s),N.success("Compra removida com sucesso!")}catch{N.error("Erro ao excluir registro.")}}return Q(h,()=>{k.value=1}),J(I),(s,t)=>{const o=w("Button"),l=w("StatusBadge"),p=w("Table"),g=w("TablePagination");return i(),c("div",at,[e("div",ot,[t[5]||(t[5]=K('<div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center"><i class="pi pi-shopping-cart text-lg"></i></div><div><h1 class="text-lg font-black text-slate-800 uppercase tracking-tight">Compras</h1><p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Entradas e rateios</p></div></div>',1)),e("div",rt,[e("div",lt,[t[3]||(t[3]=e("i",{class:"pi pi-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"},null,-1)),X(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),type:"text",placeholder:"Buscar...",class:"w-full pl-9 pr-3 h-10 bg-white border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-brand-primary/10 focus:border-brand-primary outline-none transition-all"},null,512),[[Z,h.value]])]),d(S)("compras.criar")?(i(),W(o,{key:0,variant:"primary",size:"md",class:"!h-10 !rounded-xl !px-4 text-xs font-black uppercase tracking-wider",onClick:t[1]||(t[1]=a=>d(D).push("/compras/novo"))},{default:m(()=>[...t[4]||(t[4]=[e("i",{class:"pi pi-plus mr-1.5 text-[10px]"},null,-1),tt(" Nova ",-1)])]),_:1})):$("",!0)])]),e("div",nt,[e("div",it,[t[6]||(t[6]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400"},"Total",-1)),e("p",ct,r(d(u).currency(z.value)),1)]),e("div",dt,[t[7]||(t[7]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400"},"Estoque",-1)),e("p",ut,r(d(u).currency(A.value)),1)]),e("div",pt,[t[8]||(t[8]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-slate-400"},"Vendas",-1)),e("p",mt,r(d(u).currency(P.value)),1)]),e("div",xt,[t[9]||(t[9]=e("p",{class:"text-[9px] font-black uppercase tracking-[0.15em] text-emerald-600"},"Este MÃªs",-1)),e("p",bt,r(d(u).currency(q.value)),1)])]),e("div",vt,[B(p,{columns:V,rows:L.value,loading:C.value,"empty-text":"Nenhuma compra encontrada.",boxed:!1,expandable:!0},{"cell-fornecedor":m(({row:a})=>[e("div",_t,[e("span",gt,r(E(a)),1),e("div",ft,[e("span",{class:et(["text-[8px] font-black px-1.5 py-0.5 rounded border",a.tipo_compra==="INSUMOS"?"bg-blue-50 text-blue-600 border-blue-100":"bg-amber-50 text-amber-600 border-amber-100"])},r(a.tipo_compra==="INSUMOS"?"ðŸ“¦":`ðŸŽ¯ #${a.venda_id}`),3),e("span",ht," #"+r(a.id),1)])])]),"cell-status":m(({row:a})=>[e("div",kt,[B(l,{value:a.status||"RASCUNHO"},null,8,["value"])])]),"cell-valor_total":m(({row:a})=>[e("span",yt,r(d(u).currency(a.valor_total)),1)]),"cell-data_compra":m(({row:a})=>[e("span",wt,r(d(u).date(a.data_compra)),1)]),"cell-acoes":m(({row:a})=>[e("div",St,[d(S)("compras.editar")?(i(),c("button",{key:0,onClick:b=>d(D).push(`/compras/${a.id}`),class:"w-8 h-8 rounded-lg bg-slate-100 text-slate-500 hover:bg-brand-primary hover:text-white transition-all flex items-center justify-center"},[...t[10]||(t[10]=[e("i",{class:"pi pi-pencil text-xs"},null,-1)])],8,Nt)):$("",!0),d(S)("compras.excluir")?(i(),c("button",{key:1,onClick:b=>Y(a.id),class:"w-8 h-8 rounded-lg bg-red-50 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center"},[...t[11]||(t[11]=[e("i",{class:"pi pi-trash text-xs"},null,-1)])],8,Ct)):$("",!0)])]),"row-expand":m(({row:a})=>{var b,y;return[e("div",Ft,[e("div",$t,[t[12]||(t[12]=e("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2"}," Itens ",-1)),(b=a.itens)!=null&&b.length?(i(),c("div",Bt,[(i(!0),c(R,null,T(a.itens,n=>(i(),c("div",{key:n.id,class:"flex items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-3"},[e("div",Dt,[e("div",Et,r(n.nome_produto),1),e("div",Mt,r(Number(n.quantidade))+" "+r(n.unidade)+" â€¢ R$ "+r(Number(n.valor_unitario).toLocaleString("pt-br",{minimumFractionDigits:2})),1)]),e("div",Rt," R$ "+r(Number(n.valor_total).toLocaleString("pt-br",{minimumFractionDigits:2})),1)]))),128))])):(i(),c("div",Tt," Sem itens. "))]),e("div",jt,[t[13]||(t[13]=e("div",{class:"text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2"}," Rateio ",-1)),(y=a.rateios)!=null&&y.length?(i(),c("div",Vt,[(i(!0),c(R,null,T(a.rateios,n=>(i(),c("div",{key:n.id,class:"flex items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-3"},[e("div",It,r(n.nome_ambiente),1),e("div",Lt," R$ "+r(Number(n.valor_alocado).toLocaleString("pt-br",{minimumFractionDigits:2})),1)]))),128))])):(i(),c("div",Ot," Sem rateio. "))])])]}),_:1},8,["rows","loading"]),e("div",Ut,[B(g,{page:k.value,"onUpdate:page":t[2]||(t[2]=a=>k.value=a),"page-size":F.value,total:x.value.length},null,8,["page","page-size","total"])])])])}}};export{qt as default};
//# sourceMappingURL=index-CHEfUcUD.js.map
