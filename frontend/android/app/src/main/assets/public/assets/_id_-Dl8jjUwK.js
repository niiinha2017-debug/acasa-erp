import{x as $,y as Z,f as R,h as W,g as c,j as S,i as Y,m as k,s as u,r as E,c as T,o as A,e as d,A as ee,b as s,E as _,H as P,p as L,d as v,t as ae,u as f,W as le,U as oe,a2 as te,a1 as M,a3 as se,q as ne}from"./index-CH22lQIC.js";import{F as re}from"./formas-pagamento-BeF-njRO.js";const U={FABRICA:{CUSTO_FIXO:[{key:"AGUA",label:"Ãgua"},{key:"ENERGIA",label:"Energia"},{key:"INTERNET",label:"Internet"},{key:"SEGURANCA",label:"SeguranÃ§a / Monitoramento"},{key:"LIMPEZA",label:"Limpeza"},{key:"DEPRECIACAO_MAQUINAS",label:"DepreciaÃ§Ã£o de MÃ¡quinas"},{key:"SEGURO_MAQUINAS",label:"Seguro de MÃ¡quinas"}],CUSTO_VARIAVEL:[{key:"COMBUSTIVEL",label:"CombustÃ­vel"},{key:"MANUTENCAO",label:"ManutenÃ§Ã£o"},{key:"MATERIA_PRIMA",label:"MatÃ©ria-prima (MDF/Madeira/Chapas)"},{key:"FERRAGENS",label:"Ferragens"},{key:"INSUMOS_PRODUCAO",label:"Insumos de ProduÃ§Ã£o (Cola/Lixa/Parafuso)"},{key:"FERRAMENTAS_CONSUMO",label:"Ferramentas de Consumo (Broca/Disco/LÃ¢mina)"},{key:"TERCEIRIZACAO",label:"TerceirizaÃ§Ã£o (Vidro/Pintura/Usinagem)"},{key:"EMBALAGEM",label:"Embalagem / ProteÃ§Ã£o"},{key:"FRETE_ENTREGA",label:"Frete / Entrega"},{key:"INSTALACAO_MONTAGEM",label:"InstalaÃ§Ã£o / Montagem (Custo)"},{key:"PEDAGIO",label:"PedÃ¡gio"},{key:"ALIMENTACAO",label:"AlimentaÃ§Ã£o (Operacional)"}],DESPESA_FIXA:[{key:"SALARIO",label:"SalÃ¡rio"},{key:"PRO_LABORE",label:"PrÃ³-labore"},{key:"CONTABILIDADE",label:"Contabilidade"},{key:"SISTEMAS",label:"Sistemas / Assinaturas"},{key:"SERVICOS_BANCARIOS",label:"ServiÃ§os BancÃ¡rios (Mensalidade)"},{key:"SEGUROS",label:"Seguros"}],DESPESA_VARIAVEL:[{key:"TAXAS",label:"Taxas"},{key:"NOTAS",label:"Notas / Impostos"},{key:"UNIFORME_EPI",label:"Uniforme / EPI"},{key:"TREINAMENTO",label:"Treinamento / Cursos"},{key:"MARKETING",label:"Marketing / AnÃºncios"},{key:"MATERIAL_ESCRITORIO",label:"Material de EscritÃ³rio"},{key:"MANUTENCAO_PREDIAL",label:"ManutenÃ§Ã£o Predial"},{key:"MULTAS_JUROS",label:"Multas / Juros"},{key:"OUTROS",label:"Outros"}]},LOJA:{CUSTO_FIXO:[{key:"AGUA",label:"Ãgua"},{key:"ENERGIA",label:"Energia"},{key:"INTERNET",label:"Internet"},{key:"SEGURANCA",label:"SeguranÃ§a / Monitoramento"},{key:"LIMPEZA",label:"Limpeza"}],CUSTO_VARIAVEL:[{key:"COMBUSTIVEL",label:"CombustÃ­vel"},{key:"COMISSOES",label:"ComissÃµes (Venda/Arquiteto/Projetista)"},{key:"TAXAS_VENDA",label:"Taxas de Venda (CartÃ£o/IntermediaÃ§Ã£o)"},{key:"DESLOCAMENTO",label:"Deslocamento"},{key:"POS_VENDA",label:"PÃ³s-venda (AssistÃªncia / Garantia)"}],DESPESA_FIXA:[{key:"SALARIO",label:"SalÃ¡rio"},{key:"PRO_LABORE",label:"PrÃ³-labore"},{key:"CONTABILIDADE",label:"Contabilidade"},{key:"SISTEMAS",label:"Sistemas / Assinaturas"},{key:"SERVICOS_BANCARIOS",label:"ServiÃ§os BancÃ¡rios (Mensalidade)"},{key:"SEGUROS",label:"Seguros"}],DESPESA_VARIAVEL:[{key:"TAXAS",label:"Taxas"},{key:"NOTAS",label:"Notas / Impostos"},{key:"MARKETING",label:"Marketing / AnÃºncios"},{key:"MATERIAL_ESCRITORIO",label:"Material de EscritÃ³rio"},{key:"ALIMENTACAO",label:"AlimentaÃ§Ã£o (Operacional)"},{key:"TREINAMENTO",label:"Treinamento / Cursos"},{key:"MULTAS_JUROS",label:"Multas / Juros"},{key:"OUTROS",label:"Outros"}]}},ie=[{key:"EM_ABERTO",label:"Em aberto"},{key:"VENCIDO",label:"Vencido"},{key:"PAGO",label:"Pago"},{key:"CANCELADO",label:"Cancelado"}],ce=[{key:"FABRICA",label:"ðŸ­ FÃ¡brica"},{key:"LOJA",label:"ðŸª Loja"}],ue=[{key:"JUROS",label:"Juros"},{key:"OUTROS",label:"Outras Receitas"}],de=[{key:"NUBANK_PJ",label:"NUBANK PJ"},{key:"ITAU",label:"ITAÃš"},{key:"SANTANDER",label:"SANTANDER"},{key:"SANTANDER_FABRICA",label:"SANTANDER FÃBRICA"},{key:"CAIXA_ECONOMICA",label:"CAIXA ECONÃ”MICA"},{key:"C6_BANK",label:"C6 BANK"}],pe=[{key:"NUBANK_PJ",label:"NUBANK PJ"},{key:"SANTANDER",label:"SANTANDER"},{key:"SANTANDER_FABRICA",label:"SANTANDER FÃBRICA"},{key:"C6_BANK",label:"C6 BANK"},{key:"ITAU",label:"ITAÃš"},{key:"CAIXA_ECONOMICA",label:"CAIXA ECONÃ”MICA"}],me=[{key:"CONTA_CORRENTE",label:"Conta Corrente"},{key:"CONTA_POUPANCA",label:"Conta PoupanÃ§a"}],Ae={class:"page-container"},be={class:"p-6 relative"},ye={class:"space-y-2"},Ee={class:"inline-flex w-full md:w-[420px] rounded-2xl border border-slate-200 bg-white p-1"},ke={class:"space-y-5"},_e={class:"grid grid-cols-12 gap-4 items-end"},ve={class:"col-span-12 md:col-span-4"},Se={class:"h-11 px-4 rounded-2xl border border-slate-200 bg-slate-50 flex items-center text-slate-700 font-black uppercase tracking-[0.15em]"},fe={class:"col-span-12 md:col-span-4"},Oe={class:"relative"},Ie=["value"],Ce={class:"flex items-center justify-end gap-3"},Te={__name:"[id]",setup(Ne){const B=$(),O=Z(),I=R(!1),p=R(!1),V=R([]),C=()=>new Date().toISOString().slice(0,10),a=W({tipo_movimento:"SAIDA",funcionario_id:null,categoria:null,classificacao:null,unidade:null,local:"",valor_total:0,forma_pagamento:null,quantidade_parcelas:1,status:"EM_ABERTO",data_vencimento:C(),data_pagamento:"",data_registro:C(),conta_bancaria_key:null,conta_bancaria_tipo_key:null,cartao_credito_key:null}),b=c(()=>{var e;const l=(e=B.params)==null?void 0:e.id;return l?Number(l):null}),m=c(()=>!!b.value),N=["PIX","TRANSFERENCIA","CHEQUE","BOLETO"],x=c(()=>N.includes(a.forma_pagamento)),K=c(()=>a.forma_pagamento==="CREDITO"),y=l=>Array.isArray(l)?l.map(e=>({label:e.label,value:e.key})):l&&typeof l=="object"?Object.values(l).flat().map(e=>({label:e.label,value:e.key})):[],F=c(()=>y(ce)),w=c(()=>y(re)),G=c(()=>y(ie)),h=c(()=>y(de)),J=c(()=>y(me)),X=c(()=>y(pe)),D=c(()=>{if(a.tipo_movimento==="ENTRADA")return(ue||[]).map(n=>({label:n.label,value:n.key,classificacaoKey:"RECEITA_OPERACIONAL"}));if(!a.unidade)return[];const l=U==null?void 0:U[a.unidade];if(!l)return[];const e=[];return Object.entries(l).forEach(([n,r])=>{(r||[]).forEach(t=>{e.push({label:t.label,value:t.key,classificacaoKey:n})})}),e}),q=c(()=>a.classificacao?String(a.classificacao).replace(/_/g," "):"-");S(()=>a.categoria,l=>{if(!l)return;const e=D.value.find(n=>n.value===l);e&&(a.classificacao=e.classificacaoKey)},{immediate:!0}),S([()=>a.tipo_movimento,()=>a.unidade],()=>{I.value||(a.categoria=null,a.classificacao=null)}),S(()=>a.status,l=>{l!=="PAGO"&&(a.data_pagamento="")}),S(()=>a.forma_pagamento,l=>{N.includes(l)||(a.conta_bancaria_key=null,a.conta_bancaria_tipo_key=null),l!=="CREDITO"&&(a.cartao_credito_key=null)});async function j(){var l,e,n;p.value=!0;try{const r=await te.select();if(V.value=Array.isArray(r==null?void 0:r.data)?r.data:[],m.value){const{data:t}=await M.buscar(b.value);I.value=!0,Object.assign(a,{...t,valor_total:Number(t.valor_total)||0,quantidade_parcelas:Number(t.quantidade_parcelas)||1,data_vencimento:((l=t.data_vencimento)==null?void 0:l.slice(0,10))||"",data_pagamento:((e=t.data_pagamento)==null?void 0:e.slice(0,10))||"",data_registro:((n=t.data_registro)==null?void 0:n.slice(0,10))||C()}),setTimeout(()=>{I.value=!1},150)}}catch{u.error("Erro ao carregar dados")}finally{p.value=!1}}async function z(){const l=m.value?"despesas.editar":"despesas.criar";if(!k(l))return u.error("Acesso negado.");if(!a.categoria)return u.info("Selecione a categoria");if(N.includes(a.forma_pagamento)){if(!a.conta_bancaria_key)return u.info("Selecione o banco/conta");if(!a.conta_bancaria_tipo_key)return u.info("Selecione o tipo da conta")}if(a.forma_pagamento==="CREDITO"&&!a.cartao_credito_key)return u.info("Selecione o cartÃ£o de crÃ©dito");p.value=!0;try{const e={...JSON.parse(JSON.stringify(a)),local:se(a.local),valor_total:String(a.valor_total),quantidade_parcelas:Number(a.quantidade_parcelas)};await M.salvar(b.value,e),u.success(m.value?"Atualizado com sucesso!":"LanÃ§amento criado!"),O.push("/despesas")}catch{u.error("Erro ao salvar lanÃ§amento")}finally{p.value=!1}}async function H(l){var n,r;if(!k("despesas.excluir"))return u.error("Acesso negado.");if(l&&(l.preventDefault(),l.stopPropagation()),!(!b.value||!await ne.show("Excluir LanÃ§amento?","Esta aÃ§Ã£o nÃ£o pode ser desfeita."))){p.value=!0;try{await M.remover(Number(b.value)),u.success("Registro excluÃ­do!"),O.push("/despesas")}catch(t){console.log("[DELETE] erro bruto:",t);const i=(r=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:r.message,g=Array.isArray(i)?i.join(" | "):i||(t==null?void 0:t.message)||"Erro ao excluir";u.error(g)}finally{p.value=!1}}}return Y(async()=>{const l=m.value?"despesas.editar":"despesas.criar";if(!k(l)){u.error("Acesso negado."),O.push("/despesas");return}await j()}),(l,e)=>{const n=E("PageHeader"),r=E("Loading"),t=E("Input"),i=E("SearchInput"),g=E("Button"),Q=E("Card");return A(),T("div",Ae,[d(Q,{shadow:!0,class:"overflow-hidden border-none"},{default:ee(()=>[d(n,{title:m.value?`Editar LanÃ§amento #${b.value}`:"Novo LanÃ§amento",subtitle:"Despesa / Receita operacional",icon:"pi pi-wallet",backTo:"/despesas",class:"bg-slate-50/50 border-b border-slate-100"},null,8,["title"]),s("div",be,[p.value?(A(),_(r,{key:0})):(A(),T("form",{key:1,class:"space-y-6",onSubmit:P(z,["prevent"])},[s("section",ye,[e[16]||(e[16]=s("div",{class:"text-[11px] font-black uppercase tracking-[0.2em] text-slate-400"}," Tipo de movimento ",-1)),s("div",Ee,[s("button",{type:"button",onClick:e[0]||(e[0]=o=>a.tipo_movimento="SAIDA"),class:L(["flex-1 h-9 rounded-xl text-[12px] font-black uppercase tracking-[0.2em] transition",a.tipo_movimento==="SAIDA"?"bg-red-600 text-white":"text-slate-600 hover:bg-slate-50"])}," Despesa ",2),s("button",{type:"button",onClick:e[1]||(e[1]=o=>a.tipo_movimento="ENTRADA"),class:L(["flex-1 h-9 rounded-xl text-[12px] font-black uppercase tracking-[0.2em] transition",a.tipo_movimento==="ENTRADA"?"bg-emerald-600 text-white":"text-slate-600 hover:bg-slate-50"])}," Receita ",2)])]),e[20]||(e[20]=s("div",{class:"h-px bg-slate-100"},null,-1)),s("section",ke,[s("div",_e,[d(t,{class:"col-span-12",modelValue:a.local,"onUpdate:modelValue":e[2]||(e[2]=o=>a.local=o),label:"DescriÃ§Ã£o",placeholder:"Ex: ALUGUEL, SALÃRIO, VENDA"},null,8,["modelValue"]),d(i,{class:"col-span-12 md:col-span-4",modelValue:a.unidade,"onUpdate:modelValue":e[3]||(e[3]=o=>a.unidade=o),mode:"select",label:"Unidade",placeholder:"Selecione",options:F.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"]),d(i,{class:"col-span-12 md:col-span-4",modelValue:a.categoria,"onUpdate:modelValue":e[4]||(e[4]=o=>a.categoria=o),mode:"select",label:"Categoria *",placeholder:"Selecione",options:D.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"]),s("div",ve,[e[17]||(e[17]=s("div",{class:"text-[11px] font-black uppercase tracking-[0.2em] text-slate-400 mb-2"}," ClassificaÃ§Ã£o ",-1)),s("div",Se,ae(q.value||"-"),1)]),s("div",fe,[e[19]||(e[19]=s("label",{class:"block text-[11px] font-black uppercase tracking-[0.2em] text-slate-400 mb-2"}," Valor * ",-1)),s("div",Oe,[e[18]||(e[18]=s("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-black"}," R$ ",-1)),s("input",{value:f(oe)(a.valor_total),onInput:e[5]||(e[5]=o=>a.valor_total=f(le)(o.target.value)),type:"text",inputmode:"numeric",placeholder:"0,00",class:"w-full h-11 pl-12 pr-4 rounded-2xl border border-slate-200 bg-white text-base font-black text-slate-800 focus:outline-none focus:ring-2 focus:ring-brand-primary/40 focus:border-brand-primary/60"},null,40,Ie)])]),d(i,{class:"col-span-12 md:col-span-4",modelValue:a.forma_pagamento,"onUpdate:modelValue":e[6]||(e[6]=o=>a.forma_pagamento=o),mode:"select",label:"Forma de pagamento",placeholder:"Selecione",options:w.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"]),x.value?(A(),_(i,{key:0,class:"col-span-12 md:col-span-4",modelValue:a.conta_bancaria_key,"onUpdate:modelValue":e[7]||(e[7]=o=>a.conta_bancaria_key=o),mode:"select",label:"Banco/Conta *",placeholder:"Selecione",options:h.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"])):v("",!0),x.value?(A(),_(i,{key:1,class:"col-span-12 md:col-span-4",modelValue:a.conta_bancaria_tipo_key,"onUpdate:modelValue":e[8]||(e[8]=o=>a.conta_bancaria_tipo_key=o),mode:"select",label:"Tipo da conta *",placeholder:"Selecione",options:J.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"])):v("",!0),K.value?(A(),_(i,{key:2,class:"col-span-12 md:col-span-4",modelValue:a.cartao_credito_key,"onUpdate:modelValue":e[9]||(e[9]=o=>a.cartao_credito_key=o),mode:"select",label:"CartÃ£o de crÃ©dito *",placeholder:"Selecione",options:X.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"])):v("",!0),d(t,{class:"col-span-12 md:col-span-4",modelValue:a.quantidade_parcelas,"onUpdate:modelValue":e[10]||(e[10]=o=>a.quantidade_parcelas=o),modelModifiers:{number:!0},type:"number",label:"Parcelas",placeholder:"1",forceUpper:!1,min:"1",max:"60"},null,8,["modelValue"]),d(i,{class:"col-span-12 md:col-span-4",modelValue:a.status,"onUpdate:modelValue":e[11]||(e[11]=o=>a.status=o),mode:"select",label:"Status",placeholder:"Selecione",options:G.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"]),d(i,{class:"col-span-12 md:col-span-8",modelValue:a.funcionario_id,"onUpdate:modelValue":e[12]||(e[12]=o=>a.funcionario_id=o),mode:"select",label:"ResponsÃ¡vel",placeholder:"Selecione",options:V.value,labelKey:"label",valueKey:"value"},null,8,["modelValue","options"]),d(t,{class:"col-span-12 md:col-span-4",modelValue:a.data_registro,"onUpdate:modelValue":e[13]||(e[13]=o=>a.data_registro=o),type:"date",label:"Data do registro",forceUpper:!1},null,8,["modelValue"]),d(t,{class:"col-span-12 md:col-span-4",modelValue:a.data_vencimento,"onUpdate:modelValue":e[14]||(e[14]=o=>a.data_vencimento=o),type:"date",label:"Data do vencimento",forceUpper:!1},null,8,["modelValue"]),d(t,{class:"col-span-12 md:col-span-4",modelValue:a.data_pagamento,"onUpdate:modelValue":e[15]||(e[15]=o=>a.data_pagamento=o),type:"date",label:"Data do pagamento",forceUpper:!1,disabled:a.status!=="PAGO"},null,8,["modelValue","disabled"])])]),e[21]||(e[21]=s("div",{class:"h-px bg-slate-100"},null,-1)),s("div",Ce,[m.value&&f(k)("despesas.excluir")?(A(),T("button",{key:0,type:"button",onClick:P(H,["stop","prevent"]),class:"bg-red-600 text-white h-11 px-6 rounded-2xl font-black uppercase tracking-widest text-[12px] hover:bg-red-700 transition"}," Excluir ")):v("",!0),f(k)(m.value?"despesas.editar":"despesas.criar")?(A(),_(g,{key:1,class:"min-w-[140px]",type:"submit",variant:"primary",loading:p.value,label:m.value?"Salvar":"Criar"},null,8,["loading","label"])):v("",!0)])],32))])]),_:1})])}}};export{Te as default};
//# sourceMappingURL=_id_-Dl8jjUwK.js.map
